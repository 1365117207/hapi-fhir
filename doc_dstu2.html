
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2015-05-08
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>FHIR DSTU2 Support - HAPI FHIR</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta name="author" content="James Agnew" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/bootswatch.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />


		<link href="./css/lightbox.css" rel="stylesheet" />

		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
<script src="syntaxhighlighter/shCore.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushJScript.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushJava.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushBash.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushXml.js" type="text/javascript"></script>
<link rel="stylesheet" href="syntaxhighlighter/shCore.css" type="text/css"/>
<link rel="stylesheet" href="syntaxhighlighter/shThemeDefault.css" type="text/css"/>
<link rel="shortcut icon" href="https://github.com/jamesagnew/hapi-fhir/images/favicon.png"/>
<link rel="stylesheet" href="hapi.css" type="text/css"/>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"/>
	</head>

	<body class="page-doc_dstu2 project-hapi-fhir" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="./"><span class="color-highlight">HAPI</span> FHIR</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="download.html"  title="Download"><i class="fa fa-download"></i> Download</a></li>
							<li ><a href="https://github.com/jamesagnew/hapi-fhir/" title="GitHub Project"  class="externalLink"><i class="fa fa-github"></i> GitHub Project</a></li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-book"></i>&nbsp;Documentation&nbsp;<b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="docindex.html" title="Documentation Index">Documentation Index</a></li>
									<li ><a href="doc_intro.html" title="Introduction">Introduction</a></li>
									<li class="active"><a href="" title="Note on DSTU2 Support / FHIR Versions">Note on DSTU2 Support / FHIR Versions</a></li>
									<li class="dropdown-submenu ">
										<a href="doc_fhirobjects.html" title="The Data Model">The Data Model</a>
										<ul class="dropdown-menu">
											<li ><a href="doc_fhirobjects.html" title="Working with Resources">Working with Resources</a></li>
											<li ><a href="doc_resource_references.html" title="Resource References">Resource References</a></li>
											<li ><a href="doc_extensions.html" title="Profiles & Extensions">Profiles & Extensions</a></li>
											<li ><a href="doc_tags.html" title="Tags">Tags</a></li>
											<li ><a href="doc_validation.html" title="Validation">Validation</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu ">
										<a href="doc_rest_client.html" title="RESTful Client">RESTful Client</a>
										<ul class="dropdown-menu">
											<li ><a href="doc_rest_client.html" title="Fluent/Generic Client">Fluent/Generic Client</a></li>
											<li ><a href="doc_rest_client_annotation.html" title="Annotation Client">Annotation Client</a></li>
											<li ><a href="doc_rest_client_interceptor.html" title="Interceptors (client)">Interceptors (client)</a></li>
											<li ><a href="doc_rest_client_http_config.html" title="Client HTTP Configuration">Client HTTP Configuration</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu ">
										<a href="doc_rest_server.html" title="RESTful Server">RESTful Server</a>
										<ul class="dropdown-menu">
											<li ><a href="doc_rest_server.html" title="Using RESTful Server">Using RESTful Server</a></li>
											<li ><a href="doc_rest_operations.html" title="RESTful Operations">RESTful Operations</a></li>
											<li ><a href="doc_narrative.html" title="Narrative Generator">Narrative Generator</a></li>
											<li ><a href="doc_cors.html" title="CORS Support">CORS Support</a></li>
											<li ><a href="doc_rest_server_interceptor.html" title="Interceptors (server)">Interceptors (server)</a></li>
											<li ><a href="doc_server_tester.html" title="Web Testing UI">Web Testing UI</a></li>
										</ul>
									</li>
									<li ><a href="doc_logging.html" title="Logging">Logging</a></li>
									<li ><a href="doc_rest_etag.html" title="ETags">ETags</a></li>
									<li ><a href="doc_jpa.html" title="JPA/Database Server">JPA/Database Server</a></li>
									<li ><a href="doc_android.html" title="Android Support">Android Support</a></li>
									<li class="dropdown-submenu ">
										<a href="apidocs/index.html" title="JavaDocs">JavaDocs</a>
										<ul class="dropdown-menu">
											<li ><a href="apidocs/index.html" title="Core API">Core API</a></li>
											<li ><a href="apidocs-dstu/index.html" title="Model API (DSTU1)">Model API (DSTU1)</a></li>
											<li ><a href="apidocs-dstu2/index.html" title="Model API (DSTU2)">Model API (DSTU2)</a></li>
											<li ><a href="apidocs-jpaserver/index.html" title="JPA Server API">JPA Server API</a></li>
										</ul>
									</li>
									<li ><a href="doc_tinder.html" title="Maven Plugin (hapi-tinder-plugin)">Maven Plugin (hapi-tinder-plugin)</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-support"></i>&nbsp;Get Help&nbsp;<b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="https://groups.google.com/d/forum/hapi-fhir" title="Google Group" class="externalLink">Google Group</a></li>
									<li ><a href="https://github.com/jamesagnew/hapi-fhir/issues" title="Issue Tracker" class="externalLink">Issue Tracker</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Test Server <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="http://fhirtest.uhn.ca" title="Public Test Server" class="externalLink">Public Test Server</a></li>
									<li ><a href="doc_vagrant.html" title="Vagrant Private Test Server">Vagrant Private Test Server</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="./" id="bannerLeft"><img src="images/hapi_fhir_banner.png" alt='"'HAPI'"' /></a>
				</div>
				<div class="pull-right">
					<a href="./" id="bannerRight"><img src="images/hapi_fhir_banner_right.png" alt='"'FHIR'"' /></a>
				</div>
			</div>
		</div>
	</div>
		<div>
			<ul class="breadcrumb">
				<li><a href="index.html" title="HAPI FHIR">HAPI FHIR</a></li>
				<li  class="divider">/</li>
			<li><a href="docindex.html" title="Documentation">Documentation</a></li>
			<li  class="divider">/</li>
				<li>FHIR DSTU2 Support</li>
				<li class="publishDate version-date pull-right">Last Published: 2015-05-08</li>
				<li class="divider pull-right">|</li>
				<li class="projectVersion version-date pull-right">Version: 1.1-SNAPSHOT</li>
			</ul>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="section"> 
 <div class="page-header">
  <h2 id="Working_with_DSTU2">Working with DSTU2</h2>
 </div> 
 <p> Although DSTU2 has not yet been balloted and finalized by HL7, there are several proposed changes which have been incorporated into the current <a class="externalLink" href="http://hl7-fhir.github.io/">Continuous Integration Builds</a> of the FHIR specification itself and many (if not most) of these changes will end up in the final DSTU2 specification which is expected to be released in mid-2015. </p> 
 <p> The most interesting changes to DSTU2 include: </p> 
 <ul> 
  <li> New <a class="externalLink" href="http://hl7-fhir.github.io/resource.html">&quot;id&quot; and &quot;meta&quot;</a> elements which are present on all resources and explicitly state the resource's ID, version, tags, and a few other things. All of these concepts had previously existed in FHIR but were not a part of the resource body itself (rather they lived in URLs and HTTP headers outside of the payload) </li> 
  <li> A new <a class="externalLink" href="http://hl7-fhir.github.io/bundle.html">Bundle</a> format which is no longer based on Atom. The new format does resemble the Atom format so it will not be unfamiliar to anyone who is used to DSTU1 bundles but it has a few differences. On a conceptual level FHIR now thinks of Bundles as resources themselves, so the new bundle also gains the meta element described above. </li> 
  <li> <s>In </s><a class="externalLink" href="http://hl7-fhir.github.io/json.html"><s>JSON encoding</s></a><s>, the encoding of extensions has changed a bit, so that extensions on non-primitive elements now appear with the extension URL as the JSON key, instead of being a value in an object called &quot;extension&quot;. See the JSON documentation to see how this new style looks.</s> This change was reverted by HL7. </li> 
  <li> A number of new resources have been added, and some existing resources have changed. One particularly visible (and non-backwards-compatible) change is that Patient.gender has changed from a CodeableConcept to a Code. While this new type is much more intuitive (having multiple codings attached to a single gender field is confusing) it does mean that existing DSTU1 Patient resources will not parse correctly as DSTU2 resources if they include a gender. </li> 
 </ul> 
 <div class="section"> 
  <h3 id="Supporting_DSTU2_In_your_Applications">Supporting DSTU2 In your Applications</h3> 
  <p> As of HAPI FHIR 0.9, support for DSTU2 has been added to the library. Although upgrading existing applications from DSTU1 to DSTU2 will not be painless, we have tried as much as possible to make it easy. </p> 
  <p> First, support for DSTU2 capabilities has been added in a second optional dependency JAR which you must add to your classpath. This JAR is called <tt>hapi-structures-dstu2-[version].jar</tt>. See the <a href="./download.html">download page</a> for information on adding this JAR. </p> 
  <p> The FHIR version you are targeting is a property of the <a class="externalLink" href="http://jamesagnew.github.io/hapi-fhir/apidocs/ca/uhn/fhir/context/FhirContext.html">FhirContext</a>. This means that if you use a FhirContext instance that is configured for DSTU2, any parsers, clients, servers, etc. which use that context will be operating in DSTU2 mode. </p> 
  <p> To create a DSTU2 context, simply use the &quot;forDstu2&quot; factory method on the FhirContext class: </p> 
  <div class="source"> 
   <pre>// Create a DSTU2 context, which will use DSTU2 semantics
FhirContext ctx = FhirContext.forDstu2();

// This parser supports DSTU2
IParser parser = ctx.newJsonParser();

// This client supports DSTU2
IGenericClient client = ctx.newRestfulGenericClient(&quot;http://fhirtest.uhn.ca/baseDstu2&quot;);
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="DSTU2_Servers">DSTU2 Servers</h3> 
  <p> To support DSTU2 in your server, simply set the FhirContext in the server to be one configured for DSTU2. </p> 
  <div class="source"> 
   <pre>   public class MyServer extends RestfulServer
   {

      @Override
      protected void initialize() throws ServletException {

         // In your initialize method, assign a DSTU2 FhirContext. This
         // is all that is required in order to put the server
         // into DSTU2 mode
         setFhirContext(FhirContext.forDstu2());
         
         // Then set resource providers as normal, and do any other
         // configuration you need to do.
         setResourceProviders(resourceProviderList);
         
      }
      
   }
</pre> 
  </div> 
  <p> Note that it is possible to share your resource provider classes between servers supporting DSTU1 and servers supporting DSTU2 (including in the same WAR instance on the same web server). This should make the process of upgrading your server to the latest version of FHIR a bit easier. </p> 
 </div> 
 <div class="section"> 
  <h3 id="New_Bundle_Format">New Bundle Format</h3> 
  <p> In FHIR DSTU2, the Atom specification for Bundles has been dropped in favour of a new Bundle format that is a native FHIR resource. In order to support this change, a new Bundle structure class has been added to the resource structures in the DSTU2 structures JAR <a href="./apidocs-dstu2/ca/uhn/fhir/model/dstu2/resource/Bundle.html">here</a>. </p> 
  <p> If you are working with Bundles directly in your application, it is recommended to migrate to this new bundle structure. The &quot;old&quot; <a href="./apidocs/ca/uhn/fhir/model/api/Bundle.html">Bundle</a> class will work, but the new one is generated from the FHIR specification so it is better aligned to the spec in terms of method names, JavaDocs, etc. </p> 
  <p> Because the new bundle type is a resource like any other resource, you should parse and encode it using the <tt><a href="./apidocs/ca/uhn/fhir/parser/IParser.html#parseResourcejava.lang.Class20java.lang.String">parseResource</a></tt> and <tt>encodeResource</tt> methods instead of the previously used <tt>parseBundle</tt> and <tt>encodeBundle</tt>. </p> 
 </div> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#Working_with_DSTU2" title="Working with DSTU2">Working with DSTU2 <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Supporting_DSTU2_In_your_Applications" title="Supporting DSTU2 In your Applications">Supporting DSTU2 In your Applications</a>
		<li><a href="#DSTU2_Servers" title="DSTU2 Servers">DSTU2 Servers</a>
		<li><a href="#New_Bundle_Format" title="New Bundle Format">New Bundle Format</a>
				<li class="divider"></li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">HAPI FHIR</li>
						<li >
							<a href="index.html" title="Home">Home</a>
						</li>
						<li >
							<a href="download.html"  title="Download"><i class="fa fa-download"></i> Download</a>
						</li>
						<li >
							<a href="changes-report.html" title="Changelog">Changelog</a>
						</li>
						<li >
							<a href="license.html" title="License">License</a>
						</li>
						<li class="nav-header">Test Server</li>
						<li >
							<a href="http://fhirtest.uhn.ca" title="Public Test Server" class="externalLink">Public Test Server</a>
						</li>
						<li >
							<a href="doc_vagrant.html" title="Vagrant Private Test Server">Vagrant Private Test Server</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Using HAPI</li>
						<li >
							<a href="docindex.html" title="Documentation Index">Documentation Index</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">JavaDocs</li>
						<li >
							<a href="apidocs/index.html" title="Core API">Core API</a>
						</li>
						<li >
							<a href="apidocs-dstu/index.html" title="Model API (DSTU1)">Model API (DSTU1)</a>
						</li>
						<li >
							<a href="apidocs-dstu2/index.html" title="Model API (DSTU2)">Model API (DSTU2)</a>
						</li>
						<li class="nav-header">JXR</li>
						<li >
							<a href="xref-base/index.html" title="Core">Core</a>
						</li>
						<li >
							<a href="xref-jpaserver/index.html" title="JPA Server">JPA Server</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Get Help</li>
						<li >
							<a href="https://groups.google.com/d/forum/hapi-fhir" title="Google Group" class="externalLink">Google Group</a>
						</li>
						<li >
							<a href="https://github.com/jamesagnew/hapi-fhir/issues" title="Issue Tracker" class="externalLink">Issue Tracker</a>
						</li>
						<li class="nav-header">Maven Reports</li>
						<li >
							<a href="team-list.html" title="Project Developers">Project Developers</a>
						</li>
						<li >
							<a href="surefire-report.html" title="Unit Test Report">Unit Test Report</a>
						</li>
						<li >
							<a href="findbugs.html" title="FindBugs">FindBugs</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote>HAPI FHIR is a Java implementation of the HL7 FHIR
				(Fast Healthcare Interoperable Resources) specification.
				This project is open source (licensed under the Apache Software
				License 2.0) and 100% free to use.<br/><br/>
				<a href="https://github.com/jamesagnew/hapi-fhir"><img src="./images/github-logo-mini.png" alt="Hosted on GitHub" border="0"/></a>
				<br/>
				Star us and we will love you!<br />
				<iframe src="http://ghbtns.com/github-btn.html?user=jamesagnew&repo=hapi-fhir&type=star&count=true" frameborder="0" scrolling="0" width="100px" height="20px"></iframe></blockquote>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2014-2015 <a href="http://www.uhn.ca">University Health Network</a>. All Rights Reserved.</p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.min.js"></script>
	<script src="./js/reflow-scroll.js"></script>

	<script src="./js/reflow-skin.js"></script>

	<script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/^\s*\&lt\;/)) {
				pre.className = 'brush: xml';
			} else if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>
                </body >
</html>