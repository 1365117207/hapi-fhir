<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-07-29 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="James Agnew" />
    <meta name="Date-Revision-yyyymmdd" content="20140729" />
    <meta http-equiv="Content-Language" content="en" />
    <title>HAPI - 
		Extensions - HAPI FHIR</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

                          
        
<script src="syntaxhighlighter/shCore.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushJScript.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushJava.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushBash.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushXml.js" type="text/javascript"></script>
                      
        
<link rel="stylesheet" type="text/css" href="syntaxhighlighter/shCore.css"/>
                      
        
<link rel="stylesheet" type="text/css" href="syntaxhighlighter/shThemeDefault.css"/>
                      
        
<link rel="shortcut icon" href="http://hl7api.sourceforge.net/images/favicon.png"/>
                      
        
<link rel="stylesheet" type="text/css" href="hapi.css"/>
          
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="./" id="bannerLeft">
                                                                                                <img src="images/hapi_fhir_banner.png"  alt="HAPI"/>
                </a>
                      </div>
        <div class="pull-right">                                <a href="./" id="bannerRight">
                                                                                                <img src="images/hapi_fhir_banner_right.png"  alt="FHIR"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-07-29
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 0.5
                      </li>
                      
                
                    
      
                                    
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://www.uhn.ca/" class="externalLink" title="University Health Network">
        University Health Network</a>
      </li>

  
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://hl7.org/" class="externalLink" title="hl7.org">
        hl7.org</a>
      </li>

  
    <li class="pull-right">
                      <a href="https://github.com/jamesagnew/hapi-fhir/" class="externalLink" title="GitHub Page">
        GitHub Page</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Welcome</li>
                              
      <li>
  
                          <a href="index.html" title="Welcome">
          <i class="none"></i>
        Welcome</a>
            </li>
                
      <li>
  
                          <a href="download.html" title="Download">
          <i class="none"></i>
        Download</a>
            </li>
                
      <li>
  
                          <a href="doc_upgrading.html" title="Upgrade Guide">
          <i class="none"></i>
        Upgrade Guide</a>
            </li>
                
      <li>
  
                          <a href="changes-report.html" title="Changelog">
          <i class="none"></i>
        Changelog</a>
            </li>
                              <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="doc_intro.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                
      <li>
  
                          <a href="doc_fhirobjects.html" title="The Data Model">
          <i class="none"></i>
        The Data Model</a>
            </li>
                
      <li>
  
                          <a href="doc_rest_server.html" title="RESTful Server">
          <i class="none"></i>
        RESTful Server</a>
            </li>
                
      <li>
  
                          <a href="doc_rest_client.html" title="RESTful Client">
          <i class="none"></i>
        RESTful Client</a>
            </li>
                
      <li>
  
                          <a href="doc_rest_operations.html" title="RESTful Operations">
          <i class="none"></i>
        RESTful Operations</a>
            </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>Extensions</a>
          </li>
                
      <li>
  
                          <a href="doc_narrative.html" title="Narrative Generator">
          <i class="none"></i>
        Narrative Generator</a>
            </li>
                
      <li>
  
                          <a href="doc_logging.html" title="Logging">
          <i class="none"></i>
        Logging</a>
            </li>
                
      <li>
  
                          <a href="doc_tinder.html" title="Tinder Plugin">
          <i class="none"></i>
        Tinder Plugin</a>
            </li>
                              <li class="nav-header">Community</li>
                              
      <li>
  
                          <a href="https://groups.google.com/d/forum/hapi-fhir" class="externalLink" title="Google Group">
          <i class="none"></i>
        Google Group</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/jamesagnew/hapi-fhir/issues" class="externalLink" title="Issue Tracker">
          <i class="none"></i>
        Issue Tracker</a>
            </li>
                              <li class="nav-header">JavaDocs</li>
                              
      <li>
  
                          <a href="apidocs/index.html" title="API Documentation">
          <i class="none"></i>
        API Documentation</a>
            </li>
                
      <li>
  
                          <a href="xref/index.html" title="JXR">
          <i class="none"></i>
        JXR</a>
            </li>
                              <li class="nav-header">Reports</li>
                              
      <li>
  
                          <a href="team-list.html" title="Developers">
          <i class="none"></i>
        Developers</a>
            </li>
                
      <li>
  
                          <a href="surefire-report.html" title="Unit Test Report">
          <i class="none"></i>
        Unit Test Report</a>
            </li>
                
      <li>
  
                          <a href="findbugs.html" title="FindBugs">
          <i class="none"></i>
        FindBugs</a>
            </li>
                
      <li>
  
                          <a href="license.html" title="License">
          <i class="none"></i>
        License</a>
            </li>
                
      <li>
  
                          <a href="http://sourceforge.net/p/hl7api/fhircode/ci/master/tree/" class="externalLink" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="hl7api.sourceforge.net/hapi-fhir/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="https://sourceforge.net/projects/hl7api/" title="Hosted on SourceForge.net" class="builtBy">
        <img class="builtBy"  alt="Hosted on SourceForge.net" src="http://sflogo.sourceforge.net/sflogo.php?group_id=38899&type=2"    />
      </a>
                                                                                                          <a href="http://maven.apache.org" title="Built with Maven 2" class="builtBy">
        <img class="builtBy"  alt="Built with Maven 2" src="images/logos/maven-feather.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            

	

		<div class="section">
<h2>Adding Extensions<a name="Adding_Extensions"></a></h2>
			
			
			
<ul>
<li><a href="#Adding_Extensions">Adding Extensions</a></li>
<li><a href="#Undeclared_Extensions">Undeclared Extensions</a>
<ul>
<li><a href="#Sub-Extensions">Sub-Extensions</a></li>
<li><a href="#Retrieving_Extension_Values">Retrieving Extension Values</a></li></ul></li>
<li><a href="#Custom_Resource_Types">Custom Resource Types</a>
<ul>
<li><a href="#Documentation">Documentation</a></li></ul></li></ul>
			
			
<p>
				Extensions are a key part of the FHIR specification, providing a standardized
				way of placing additional data in a resource. 
			</p>

		</div>
		
		
<div class="section">
<h2>Undeclared Extensions<a name="Undeclared_Extensions"></a></h2>
			
			
<p>
				All HAPI FHIR Resource objects support &quot;undeclared extensions&quot;,
				which are arbitrary extensions you can add.
			</p>
			
				
				
			
<div class="source">
<pre>// Create an example patient
Patient patient = new Patient();
patient.addIdentifier(IdentifierUseEnum.OFFICIAL, &quot;urn:example&quot;, &quot;7000135&quot;, null);

// Create an extension
ExtensionDt ext = new ExtensionDt();
ext.setModifier(false);
ext.setUrl(&quot;http://example.com/extensions#someext&quot;);
ext.setValue(new DateTimeDt(&quot;2011-01-02T11:13:15&quot;));

// Add the extension to the resource
patient.addUndeclaredExtension(ext);
</pre></div>
			
			
<p>
				Undeclared extensions can also be added to datatypes (composite or primitive).
			</p>
			
				
				
			
<div class="source">
<pre>HumanNameDt name = patient.addName();
name.addFamily().setValue(&quot;Shmoe&quot;);
StringDt given = name.addGiven();
given.setValue(&quot;Joe&quot;);
ExtensionDt ext2 = new ExtensionDt(false, &quot;http://examples.com#moreext&quot;, new StringDt(&quot;Hello&quot;));
given.addUndeclaredExtension(ext2);
</pre></div>
			
			
<div class="section">
<h3>Sub-Extensions<a name="Sub-Extensions"></a></h3>

				
<p>
					Extensions may also have child extensions as their content, instead
					of a datatype. This is done by adding a child undeclared extension to the
					parent extension.
				</p>
				
					
					
				
<div class="source">
<pre>Patient patient = new Patient();
	
ExtensionDt parent = new ExtensionDt(false, &quot;http://example.com#parent&quot;);
patient.addUndeclaredExtension(parent);

ExtensionDt child1 = new ExtensionDt(false, &quot;http://example.com#childOne&quot;, new StringDt(&quot;value1&quot;));
parent.addUndeclaredExtension(child1);

ExtensionDt child2 = new ExtensionDt(false, &quot;http://example.com#childTwo&quot;, new StringDt(&quot;value1&quot;));
parent.addUndeclaredExtension(child2);
</pre></div>
			
			</div>

			
<div class="section">
<h3>Retrieving Extension Values<a name="Retrieving_Extension_Values"></a></h3>

				
<p>
					HAPI provides a few ways of getting data back out of
					an extension value (i.e. from a received resource):
				</p>
				
					
					
				
<div class="source">
<pre>// Get all extensions (modifier or not) for a given URL
List&lt;ExtensionDt&gt; resourceExts = patient.getUndeclaredExtensionsByUrl(&quot;http://fooextensions.com#exts&quot;);

// Get all non-modifier extensions regardless of URL
List&lt;ExtensionDt&gt; nonModExts = patient.getUndeclaredExtensions();

//Get all non-modifier extensions regardless of URL
List&lt;ExtensionDt&gt; modExts = patient.getUndeclaredModifierExtensions();
</pre></div>
			
			</div>
			
		</div>
		
		
<div class="section">
<h2>Custom Resource Types<a name="Custom_Resource_Types"></a></h2>
			
				
<p>
					The most elegant way of adding extensions to a resource is through the
					use of custom fields. The following example shows a custom type which
					extends the FHIR Patient resource definition through two extensions.
				</p>
				
				
					
					
				
<div class="source">
<pre>import java.util.ArrayList;
import java.util.List;

import ca.uhn.fhir.model.api.annotation.Child;
import ca.uhn.fhir.model.api.annotation.Description;
import ca.uhn.fhir.model.api.annotation.Extension;
import ca.uhn.fhir.model.api.annotation.ResourceDef;
import ca.uhn.fhir.model.dstu.resource.Patient;
import ca.uhn.fhir.model.primitive.DateTimeDt;
import ca.uhn.fhir.model.primitive.StringDt;
import ca.uhn.fhir.util.ElementUtil;

/**
 * Definition class for adding extensions to the built-in
 * Patient resource type.
 */
@ResourceDef(name=&quot;Patient&quot;)
public class MyPatient extends Patient {

	/**
	 * Each extension is defined in a field. Any valid HAPI Data Type
	 * can be used for the field type. Note that the [name=&quot;&quot;] attribute
	 * in the @Child annotation needs to match the name for the bean accessor
	 * and mutator methods.
	 */
	@Child(name=&quot;petName&quot;)	
	@Extension(url=&quot;http://example.com/dontuse#petname&quot;, definedLocally=false, isModifier=false)
	@Description(shortDefinition=&quot;The name of the patient's favourite pet&quot;)
	private StringDt myPetName;

	/**
	 * The second example extension uses a List type to provide
	 * repeatable values. Note that a [max=] value has been placed in
	 * the @Child annotation.
	 * 
	 * Note also that this extension is a modifier extension
	 */
	@Child(name=&quot;importantDates&quot;, max=Child.MAX_UNLIMITED)	
	@Extension(url=&quot;http://example.com/dontuse#importantDates&quot;, definedLocally=false, isModifier=true)
	@Description(shortDefinition=&quot;Some dates of note for this patient&quot;)
	private List&lt;DateTimeDt&gt; myImportantDates;

	/**
	 * It is important to override the isEmpty() method, adding a check for any
	 * newly added fields. 
	 */
	@Override
	public boolean isEmpty() {
		return super.isEmpty() &amp;&amp; ElementUtil.isEmpty(myPetName, myImportantDates);
	}
	
	/********
	 * Accessors and mutators follow
	 * 
	 * IMPORTANT:
	 * Each extension is required to have an getter/accessor and a stter/mutator. 
	 * You are highly recommended to create getters which create instances if they
	 * do not already exist, since this is how the rest of the HAPI FHIR API works. 
	 ********/
	
	/** Getter for important dates */
	public List&lt;DateTimeDt&gt; getImportantDates() {
		if (myImportantDates==null) {
			myImportantDates = new ArrayList&lt;DateTimeDt&gt;();
		}
		return myImportantDates;
	}

	/** Getter for pet name */
	public StringDt getPetName() {
		if (myPetName == null) {
			myPetName = new StringDt();
		}
		return myPetName;
	}

	/** Setter for important dates */
	public void setImportantDates(List&lt;DateTimeDt&gt; theImportantDates) {
		myImportantDates = theImportantDates;
	}

	/** Setter for pet name */
	public void setPetName(StringDt thePetName) {
		myPetName = thePetName;
	}

}
</pre></div>

				
<p>
					Using this custom type is as simple as instantiating the type
					and working with the new fields.
				</p>
				
				
					
					
				
<div class="source">
<pre>MyPatient patient = new MyPatient();
patient.setPetName(new StringDt(&quot;Fido&quot;));
patient.getImportantDates().add(new DateTimeDt(&quot;2010-01-02&quot;));
patient.getImportantDates().add(new DateTimeDt(&quot;2014-01-26T11:11:11&quot;));

patient.addName().addFamily(&quot;Smith&quot;).addGiven(&quot;John&quot;).addGiven(&quot;Quincy&quot;).addSuffix(&quot;Jr&quot;);

IParser p = new FhirContext().newXmlParser().setPrettyPrint(true);
String messageString = p.encodeResourceToString(patient);

System.out.println(messageString);
</pre></div>
			
				
<p>
					This example produces the following output:
				</p>
				
				
<div class="source">
<pre>&lt;Patient xmlns=&quot;http://hl7.org/fhir&quot;&gt;
   &lt;modifierExtension url=&quot;http://example.com/dontuse#importantDates&quot;&gt;
      &lt;valueDateTime value=&quot;2010-01-02&quot;/&gt;
   &lt;/modifierExtension&gt;
   &lt;modifierExtension url=&quot;http://example.com/dontuse#importantDates&quot;&gt;
      &lt;valueDateTime value=&quot;2014-01-26T11:11:11&quot;/&gt;
   &lt;/modifierExtension&gt;
   &lt;extension url=&quot;http://example.com/dontuse#petname&quot;&gt;
      &lt;valueString value=&quot;Fido&quot;/&gt;
   &lt;/extension&gt;
   &lt;name&gt;
      &lt;family value=&quot;Smith&quot;/&gt;
      &lt;given value=&quot;John&quot;/&gt;
      &lt;given value=&quot;Quincy&quot;/&gt;
      &lt;suffix value=&quot;Jr&quot;/&gt;
   &lt;/name&gt;
&lt;/Patient&gt;</pre></div>
			
				
<p>
					Parsing messages using your new custom type is equally simple.
					These types can also be used as method return types in clients
					and servers.
				</p>
			
				
					
					
				
<div class="source">
<pre>IParser parser = new FhirContext().newXmlParser();
MyPatient newPatient = parser.parseResource(MyPatient.class, messageString);
</pre></div>

			
<div class="section">
<h3>Documentation<a name="Documentation"></a></h3>
				
				
<p>
					Note in the example above the use of the <tt>@Description</tt>
					annotation on the extension fields. This documentation is important,
					as the FHIR Server will automatically add it to the generated Profile
					resources which are exported by the server.  
				</p>
				
				
<p>
					These bits of documentation will then be re-added to any automatically
					generated clients built using <a href="./doc_tinder.html">Tinder</a>
					against your server.
				</p>
				
				
<p>
					The following is a snippet from the generated Profile resource
					which is automatically created by a HAPI RESTful server using
					your new type. (Don't worry if this part doens't make sense to you
					yet, this is an advanced feature)
				</p>
				
				
<div class="source">
<pre>&lt;element&gt;
   &lt;path value=&quot;Patient.extension&quot;/&gt;
   &lt;name value=&quot;extension&quot;/&gt;
   &lt;slicing&gt;
      &lt;discriminator value=&quot;url&quot;/&gt;
      &lt;ordered value=&quot;false&quot;/&gt;
      &lt;rules value=&quot;open&quot;/&gt;
   &lt;/slicing&gt;
   &lt;definition&gt;
      &lt;type&gt;
         &lt;code value=&quot;Extension&quot;/&gt;
      &lt;/type&gt;
   &lt;/definition&gt;
&lt;/element&gt;
&lt;element&gt;
   &lt;path value=&quot;Patient.extension&quot;/&gt;
   &lt;name value=&quot;extension&quot;/&gt;
   &lt;definition&gt;
      &lt;short value=&quot;The name of the patient's favourite pet&quot;/&gt;
      &lt;min value=&quot;0&quot;/&gt;
      &lt;max value=&quot;1&quot;/&gt;
      &lt;type&gt;
         &lt;code value=&quot;Extension&quot;/&gt;
         &lt;profile value=&quot;http://example.com/dontuse#petname&quot;/&gt;
      &lt;/type&gt;
      &lt;isModifier value=&quot;false&quot;/&gt;
   &lt;/definition&gt;
&lt;/element&gt;
&lt;element&gt;
   &lt;path value=&quot;Patient.modifierExtension&quot;/&gt;
   &lt;name value=&quot;modifierExtension&quot;/&gt;
   &lt;slicing&gt;
      &lt;discriminator value=&quot;url&quot;/&gt;
      &lt;ordered value=&quot;false&quot;/&gt;
      &lt;rules value=&quot;open&quot;/&gt;
   &lt;/slicing&gt;
   &lt;definition&gt;
      &lt;type&gt;
         &lt;code value=&quot;Extension&quot;/&gt;
      &lt;/type&gt;
   &lt;/definition&gt;
&lt;/element&gt;
&lt;element&gt;
   &lt;path value=&quot;Patient.modifierExtension&quot;/&gt;
   &lt;name value=&quot;modifierExtension&quot;/&gt;
   &lt;definition&gt;
      &lt;short value=&quot;Some dates of note for the patient&quot;/&gt;
      &lt;min value=&quot;0&quot;/&gt;
      &lt;max value=&quot;*&quot;/&gt;
      &lt;type&gt;
         &lt;code value=&quot;Extension&quot;/&gt;
         &lt;profile value=&quot;http://example.com/dontuse#importantDates&quot;/&gt;
      &lt;/type&gt;
      &lt;isModifier value=&quot;true&quot;/&gt;
   &lt;/definition&gt;
&lt;/element&gt;</pre></div>	
				
			</div>
			
		</div>
			
	


                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2014
                        <a href="http://www.uhn.ca">University Health Network</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        <script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>
                </body >
</html>