<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-06-25 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="James Agnew" />
    <meta name="Date-Revision-yyyymmdd" content="20140625" />
    <meta http-equiv="Content-Language" content="en" />
    <title>HAPI - 
		Narrative Generation - HAPI FHIR</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

                          
        
<script src="syntaxhighlighter/shCore.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushJScript.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushJava.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushBash.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushXml.js" type="text/javascript"></script>
                      
        
<link rel="stylesheet" type="text/css" href="syntaxhighlighter/shCore.css"/>
                      
        
<link rel="stylesheet" type="text/css" href="syntaxhighlighter/shThemeDefault.css"/>
                      
        
<link rel="shortcut icon" href="http://hl7api.sourceforge.net/images/favicon.png"/>
                      
        
<link rel="stylesheet" type="text/css" href="hapi.css"/>
          
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="./" id="bannerLeft">
                                                                                                <img src="images/hapi_fhir_banner.png"  alt="HAPI"/>
                </a>
                      </div>
        <div class="pull-right">                                <a href="./" id="bannerRight">
                                                                                                <img src="images/hapi_fhir_banner_right.png"  alt="FHIR"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-06-25
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 0.4-SNAPSHOT
                      </li>
                      
                
                    
      
                                    
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://www.uhn.ca/" class="externalLink" title="University Health Network">
        University Health Network</a>
      </li>

  
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://hl7.org/" class="externalLink" title="hl7.org">
        hl7.org</a>
      </li>

  
    <li class="pull-right">
                      <a href="https://sourceforge.net/projects/hl7api/" class="externalLink" title="Sourceforge Project Page">
        Sourceforge Project Page</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Welcome</li>
                              
      <li>
  
                          <a href="index.html" title="Welcome">
          <i class="none"></i>
        Welcome</a>
            </li>
                
      <li>
  
                          <a href="download.html" title="Download">
          <i class="none"></i>
        Download</a>
            </li>
                              <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="doc_intro.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                
      <li>
  
                          <a href="doc_fhirobjects.html" title="The Data Model">
          <i class="none"></i>
        The Data Model</a>
            </li>
                
      <li>
  
                          <a href="doc_rest_server.html" title="RESTful Server">
          <i class="none"></i>
        RESTful Server</a>
            </li>
                
      <li>
  
                          <a href="doc_rest_client.html" title="RESTful Client">
          <i class="none"></i>
        RESTful Client</a>
            </li>
                
      <li>
  
                          <a href="doc_rest_operations.html" title="RESTful Operations">
          <i class="none"></i>
        RESTful Operations</a>
            </li>
                
      <li>
  
                          <a href="doc_extensions.html" title="Extensions">
          <i class="none"></i>
        Extensions</a>
            </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>Narrative Generator</a>
          </li>
                
      <li>
  
                          <a href="doc_tinder.html" title="Tinder Plugin">
          <i class="none"></i>
        Tinder Plugin</a>
            </li>
                              <li class="nav-header">JavaDocs</li>
                              
      <li>
  
                          <a href="apidocs/index.html" title="API Documentation">
          <i class="none"></i>
        API Documentation</a>
            </li>
                
      <li>
  
                          <a href="xref/index.html" title="JXR">
          <i class="none"></i>
        JXR</a>
            </li>
                              <li class="nav-header">Reports</li>
                              
      <li>
  
                          <a href="team-list.html" title="Developers">
          <i class="none"></i>
        Developers</a>
            </li>
                
      <li>
  
                          <a href="surefire-report.html" title="Unit Test Report">
          <i class="none"></i>
        Unit Test Report</a>
            </li>
                
      <li>
  
                          <a href="findbugs.html" title="FindBugs">
          <i class="none"></i>
        FindBugs</a>
            </li>
                
      <li>
  
                          <a href="license.html" title="License">
          <i class="none"></i>
        License</a>
            </li>
                
      <li>
  
                          <a href="http://sourceforge.net/p/hl7api/fhircode/ci/master/tree/" class="externalLink" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="hl7api.sourceforge.net/hapi-fhir/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="https://sourceforge.net/projects/hl7api/" title="Hosted on SourceForge.net" class="builtBy">
        <img class="builtBy"  alt="Hosted on SourceForge.net" src="http://sflogo.sourceforge.net/sflogo.php?group_id=38899&type=2"    />
      </a>
                                                                                                          <a href="http://maven.apache.org" title="Built with Maven 2" class="builtBy">
        <img class="builtBy"  alt="Built with Maven 2" src="images/logos/maven-feather.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            

	

		<div class="section">
<h2>Narrative Generation<a name="Narrative_Generation"></a></h2>
			
			
			
<ul>
<li><a href="#Narrative_Generation">Narrative Generation</a></li>
<li><a href="#Automatic_Narrative_Generartion">Automatic Narrative Generartion</a>
<ul>
<li><a href="#A_Simple_Example">A Simple Example</a></li>
<li><a href="#Built-in_Narrative_Templates">Built-in Narrative Templates</a></li></ul></li>
<li><a href="#Creating_your_own_Templates">Creating your own Templates</a></li></ul>
			
			
<p>
				HAPI provides a several ways to add 
				<a class="externalLink" href="http://hl7.org/implement/standards/fhir/narrative.html">Narrative Text</a>
				to your encoded messages.
			</p>

			
<p>
				The simplest way is to simply place the narrative text directly in the resource
				via the 
				<a href="./apidocs/ca/uhn/fhir/model/api/IResource.html#getText">getText()</a>
				method. 
			</p>

			
				
				
			
<div class="source">
<pre>Patient pat = new Patient();
pat.getText().setStatus(NarrativeStatusEnum.GENERATED);
pat.getText().setDiv(&quot;&lt;div&gt;This is the narrative text&lt;br/&gt;this is line 2&lt;/div&gt;&quot;);
</pre></div>

		</div>			

		
<div class="section">
<h2>Automatic Narrative Generartion<a name="Automatic_Narrative_Generartion"></a></h2>
		
			
<p>
				HAPI also comes with a built-in mechanism for automatically generating
				narratives based on your resources.
			</p>
			
			
<p>
				<b>Warning: </b> This built-in capability is a work in progress, and does not cover
				every type of resource or even every attribute in any resource. You should test it
				and configure it for your particular use cases.
			</p>
			
			
<p>
				HAPI's built-in narrative generation uses the 
				<a class="externalLink" href="http://www.thymeleaf.org/">Thymeleaf</a> library
				for templating narrative texts. Thymeleaf provides a simple
				XHTML-based syntax which is easy to use and 
				meshes well with the HAPI-FHIR model objects.
			</p>
			
			
<div class="section">
<h3>A Simple Example<a name="A_Simple_Example"></a></h3>
			
				
<p>
					Activating HAPI's built-in narrative generator is as simple
					as calling 
					<a href="./apidocs/ca/uhn/fhir/context/FhirContext.html#setNarrativeGeneratorca.uhn.fhir.narrative.INarrativeGenerator">setNarrativeGenerator</a>.
				</p>

				
					
					
				
<div class="source">
<pre>Patient patient = new Patient();
patient.addIdentifier(&quot;urn:foo&quot;, &quot;7000135&quot;);
patient.addName().addFamily(&quot;Smith&quot;).addGiven(&quot;John&quot;).addGiven(&quot;Edward&quot;);
patient.addAddress().addLine(&quot;742 Evergreen Terrace&quot;).setCity(&quot;Springfield&quot;).setState(&quot;ZZ&quot;);

FhirContext ctx = new FhirContext();

// Use the narrative generator
ctx.setNarrativeGenerator(new DefaultThymeleafNarrativeGenerator());

// Encode the output, including the narrative
String output = ctx.newJsonParser().setPrettyPrint(true).encodeResourceToString(patient);
System.out.println(output);
</pre></div>
				
				
<p>
				...which produces the following output:
				</p>
				
				
<div class="source">
<pre>&lt;Patient xmlns=&quot;http://hl7.org/fhir&quot;&gt;
   &lt;text&gt;
      &lt;status value=&quot;generated&quot;/&gt;
      &lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
         &lt;div class=&quot;hapiHeaderText&quot;&gt; John Edward &lt;b&gt;SMITH &lt;/b&gt;&lt;/div&gt;
         &lt;table class=&quot;hapiPropertyTable&quot;&gt;
            &lt;tbody&gt;
               &lt;tr&gt;&lt;td&gt;Identifier&lt;/td&gt;&lt;td&gt;7000135&lt;/td&gt;&lt;/tr&gt;
               &lt;tr&gt;&lt;td&gt;Address&lt;/td&gt;&lt;td&gt;&lt;span&gt;742 Evergreen Terrace&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Springfield&lt;/span&gt; &lt;span&gt;ZZ&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;
            &lt;/tbody&gt;
         &lt;/table&gt;
      &lt;/div&gt;
   &lt;/text&gt;
   &lt;!-- .... snip ..... --&gt;
&lt;/Patient&gt;</pre></div>
			
			</div>
		
			
<div class="section">
<h3>Built-in Narrative Templates<a name="Built-in_Narrative_Templates"></a></h3>
			
				
<p>
					HAPI currently only comes with built-in support for
					a few resource types. Our intention is that people enhance these 
					templates and create new ones, and share these back with us so that
					we can continue to build out the library. To see the current
					template library, see the source repository 
					<a class="externalLink" href="http://sourceforge.net/p/hl7api/fhircode/ci/master/tree/hapi-fhir-base/src/main/resources/ca/uhn/fhir/narrative/">here</a>.
				</p>

				
<p>
					Note that these templates expect a few specific CSS definitions
					to be present in your site's CSS file. See the 
					<a class="externalLink" href="http://sourceforge.net/p/hl7api/fhircode/ci/master/tree/hapi-fhir-base/src/main/resources/ca/uhn/fhir/narrative/narrative.css">narrative CSS</a>
					to see these. 
				</p>
			
			</div>
			
		</div>
		
		
<div class="section">
<h2>Creating your own Templates<a name="Creating_your_own_Templates"></a></h2>
		
			
<p>
				To use your own templates for narrative generation,
				simply create one or more templates, using the Thymeleaf
				HTML based syntax. 
			</p>
		
			
				
			
<div class="source">
<pre>&lt;div&gt;
	&lt;!-- 
	Normal Thymeleaf tags apply. Here, we loop through each of the 
	identifiers that the practitioner has, and create a DIV tag for
	each one, with the text &quot;Identifier: [value]&quot;
	--&gt;
	&lt;div th:each=&quot;identifier : ${resource.identifier}&quot; th:text=&quot;'Identifier: ' + ${identifier.value}&quot;&gt;&lt;/div&gt;
	
	&lt;!-- 
	HAPI also defines a custom tag attribute, th:narrative=&quot;value&quot;, 
	which is used to render a datatype into more HTML. In the example
	below, the value of ${resource.name} (which is the name property
	of the Practitioner resource, a HumanName datatype instance)
	is rendered, and its contents placed in a DIV tag. That DIV tag is
	then given a .nameElement CSS style.
	 --&gt;
	&lt;h1&gt;Name&lt;/h1&gt;
	&lt;div th:narrative=&quot;${resource.name}&quot; class=&quot;nameElement&quot;&gt;&lt;/div&gt;
	
	&lt;h1&gt;Address&lt;/h1&gt;
	&lt;div th:narrative=&quot;${resource.address}&quot;&gt;&lt;/div&gt;


&lt;/div&gt;
</pre></div>

			
<p>
				Then create a properties file which describes your
				templates. In this properties file, each resource to 
				be defined has a pair or properties. 
			</p>
						
			
<p>
				The first (name.class) defines the class name of the resource to define a 
				template for. The second (name.narrative) defines the path/classpath to the
				template file. The format of this path is <tt>file:/path/foo.html</tt> or  <tt>classpath:/com/classpath/foo.html</tt>
			</p>
			
			
<div class="source">
<pre># Two property lines in the file per template
practitioner.class=ca.uhn.fhir.model.dstu.resource.Practitioner
practitioner.narrative=file:src/test/resources/narrative/Practitioner.html

observation.class=ca.uhn.fhir.model.dstu.resource.Observation
observation.narrative=file:src/test/resources/narrative/Observation.html

# etc...</pre></div>

			
<p>
				You may also override/define behaviour for datatypes. These datatype narrative
				definitions will be used as content within <tt>th:narrative</tt> blocks
				in resource templates. See the example resource template above for an example.
			</p>
			  
			
<div class="source">
<pre># datatypes use the same format as resources
humanname.class=ca.uhn.fhir.model.dstu.composite.HumanNameDt
humanname.narrative=classpath:ca/uhn/fhir/narrative/HumanNameDt.html</pre></div>
		
			
<p>
				Finally, use the 
				<a href="./apidocs/ca/uhn/fhir/narrative/CustomThymeleafNarrativeGenerator.html">CustomThymeleafNarrativeGenerator</a> 
				and provide it
				to the FhirContext.
			</p>

			
				
				
			
<div class="source">
<pre>String propFile = &quot;classpath:/com/foo/customnarrative.properties&quot;;
CustomThymeleafNarrativeGenerator gen = new CustomThymeleafNarrativeGenerator(propFile);

FhirContext ctx = new FhirContext();
ctx.setNarrativeGenerator(gen);
</pre></div>
		
		</div>
		
	


                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2014
                        <a href="http://www.uhn.ca">University Health Network</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        <script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'sourceforge.net');
  ga('send', 'pageview');

</script>
                </body >
</html>