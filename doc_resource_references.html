<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-11-20 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="James Agnew" />
    <meta name="Date-Revision-yyyymmdd" content="20141120" />
    <meta http-equiv="Content-Language" content="en" />
    <title>HAPI &#x2013; Resource References - HAPI FHIR</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

                          
        
<script src="syntaxhighlighter/shCore.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushJScript.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushJava.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushBash.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushXml.js" type="text/javascript"></script>
                      
        
<link rel="stylesheet" type="text/css" href="syntaxhighlighter/shCore.css"/>
                      
        
<link rel="stylesheet" type="text/css" href="syntaxhighlighter/shThemeDefault.css"/>
                      
        
<link rel="shortcut icon" href="https://github.com/jamesagnew/hapi-fhir/images/favicon.png"/>
                      
        
<link rel="stylesheet" type="text/css" href="hapi.css"/>
          
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://jamesagnew.github.io/hapi-fhir/" id="bannerLeft">
                                                                                                <img src="images/hapi_fhir_banner.png"  alt="HAPI"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="http://jamesagnew.github.io/hapi-fhir/" id="bannerRight">
                                                                                                <img src="images/hapi_fhir_banner_right.png"  alt="FHIR"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-11-20
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 0.8-SNAPSHOT
                      </li>
                      
                
                    
      
                                    
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://www.uhn.ca/" class="externalLink" title="University Health Network">
        University Health Network</a>
      </li>

  
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://hl7.org/" class="externalLink" title="hl7.org">
        hl7.org</a>
      </li>

  
    <li class="pull-right">
                      <a href="https://github.com/jamesagnew/hapi-fhir/" class="externalLink" title="GitHub Page">
        GitHub Page</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Welcome</li>
                              
      <li>
  
                          <a href="index.html" title="Welcome">
          <i class="none"></i>
        Welcome</a>
            </li>
                
      <li>
  
                          <a href="download.html" title="Download">
          <i class="none"></i>
        Download</a>
            </li>
                
      <li>
  
                          <a href="doc_upgrading.html" title="Upgrade Guide">
          <i class="none"></i>
        Upgrade Guide</a>
            </li>
                
      <li>
  
                          <a href="changes-report.html" title="Changelog">
          <i class="none"></i>
        Changelog</a>
            </li>
                              <li class="nav-header">Test Server</li>
                              
      <li>
  
                          <a href="http://fhirtest.uhn.ca" class="externalLink" title="Public Test Server">
          <i class="none"></i>
        Public Test Server</a>
            </li>
                
      <li>
  
                          <a href="doc_vagrant.html" title="Vagrant (Private) Test Server">
          <i class="none"></i>
        Vagrant (Private) Test Server</a>
            </li>
                              <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="doc_intro.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                                                                                                                            
      <li>
  
                          <a href="doc_fhirobjects.html" title="The Data Model">
          <i class="icon-chevron-down"></i>
        The Data Model</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="doc_extensions.html" title="Profiles & Extensions">
          <i class="none"></i>
        Profiles & Extensions</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><i class="none"></i>Resource References</a>
          </li>
                    
      <li>
  
                          <a href="doc_tags.html" title="Tags">
          <i class="none"></i>
        Tags</a>
            </li>
                    
      <li>
  
                          <a href="doc_validation.html" title="Validation">
          <i class="none"></i>
        Validation</a>
            </li>
              </ul>
        </li>
                                                            
      <li>
  
                          <a href="doc_rest_client.html" title="RESTful Client">
          <i class="icon-chevron-down"></i>
        RESTful Client</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="doc_rest_client_interceptor.html" title="Interceptors (client)">
          <i class="none"></i>
        Interceptors (client)</a>
            </li>
              </ul>
        </li>
                                                                                                                                    
      <li>
  
                          <a href="doc_rest_server.html" title="RESTful Server">
          <i class="icon-chevron-down"></i>
        RESTful Server</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="doc_rest_operations.html" title="RESTful Operations">
          <i class="none"></i>
        RESTful Operations</a>
            </li>
                    
      <li>
  
                          <a href="doc_narrative.html" title="Narrative Generator">
          <i class="none"></i>
        Narrative Generator</a>
            </li>
                    
      <li>
  
                          <a href="doc_cors.html" title="CORS Support">
          <i class="none"></i>
        CORS Support</a>
            </li>
                    
      <li>
  
                          <a href="doc_rest_server_interceptor.html" title="Interceptors (server)">
          <i class="none"></i>
        Interceptors (server)</a>
            </li>
                    
      <li>
  
                          <a href="doc_server_tester.html" title="Web Testing UI">
          <i class="none"></i>
        Web Testing UI</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="doc_logging.html" title="Logging">
          <i class="none"></i>
        Logging</a>
            </li>
                
      <li>
  
                          <a href="doc_tinder.html" title="Tinder Plugin">
          <i class="none"></i>
        Tinder Plugin</a>
            </li>
                              <li class="nav-header">Community</li>
                              
      <li>
  
                          <a href="https://groups.google.com/d/forum/hapi-fhir" class="externalLink" title="Google Group">
          <i class="none"></i>
        Google Group</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/jamesagnew/hapi-fhir/issues" class="externalLink" title="Issue Tracker">
          <i class="none"></i>
        Issue Tracker</a>
            </li>
                              <li class="nav-header">JavaDocs</li>
                              
      <li>
  
                          <a href="apidocs/index.html" title="Core API">
          <i class="none"></i>
        Core API</a>
            </li>
                
      <li>
  
                          <a href="apidocs-dstu/index.html" title="Model API (DSTU1)">
          <i class="none"></i>
        Model API (DSTU1)</a>
            </li>
                
      <li>
  
                          <a href="apidocs-dev/index.html" title="Model API (DEV)">
          <i class="none"></i>
        Model API (DEV)</a>
            </li>
                
      <li>
  
                          <a href=".https://github.com/jamesagnew/hapi-fhir" class="externalLink" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
                              <li class="nav-header">Reports</li>
                              
      <li>
  
                          <a href="team-list.html" title="Developers">
          <i class="none"></i>
        Developers</a>
            </li>
                
      <li>
  
                          <a href="surefire-report.html" title="Unit Test Report">
          <i class="none"></i>
        Unit Test Report</a>
            </li>
                
      <li>
  
                          <a href="findbugs.html" title="FindBugs">
          <i class="none"></i>
        FindBugs</a>
            </li>
                
      <li>
  
                          <a href="license.html" title="License">
          <i class="none"></i>
        License</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/jamesagnew/hapi-fhir" class="externalLink" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="hl7api.sourceforge.net/hapi-fhir/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                         <a href="https://github.com/jamesagnew/hapi-fhir" title="Hosted on GitHub" class="builtBy">
        <img class="builtBy"  alt="Hosted on GitHub" src="images/github-logo-mini.png"    />
      </a>
                                                                                                          <a href="http://maven.apache.org" title="Built with Maven 3" class="builtBy">
        <img class="builtBy"  alt="Built with Maven 3" src="images/maven-logo-mini.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            

	

		<!-- The body of the document contains a number of sections -->
		<div class="section">
<h2><a name="Resource_References"></a>Resource References</h2>
			
			
			
<ul>
<li><a href="#Resource_References">Resource References</a></li>
<li><a href="#References_in_Client_Code">References in Client Code</a></li>
<li><a href="#References_in_Server_Code">References in Server Code</a>
<ul>
<li><a href="#Handling_Includes__include_in_a_Bundle">Handling Includes (_include) in a Bundle</a></li>
<li><a href="#Contained_Resources">Contained Resources</a></li></ul></li></ul>
			
			
<p>
				Resource references are a key part of the HAPI FHIR model, 
				since almost any resource will have references to other resources
				within it.
			</p>			
			
			
<p>
				The <a class="externalLink" href="http://jamesagnew.github.io/hapi-fhir/apidocs/ca/uhn/fhir/model/dstu/composite/ResourceReferenceDt.html">ResourceReferenceDt</a>
				type is the datatype for references. This datatype has a number of properties which help 
				make working with FHIR simple.
			</p>
		
			
<p>
				The <tt>getReference()</tt> method returns an IdDt instance which contains the identity of the
				resource being referenced. This is the item which is most commonly populated when
				interacting with FHIR. For example, consider the following Patient resource, which 
				contains a reference to an Organization resource: 
			</p>
			
<div class="source">
<pre>&lt;Patient xmlns=&quot;http://hl7.org/fhir&quot;&gt;
   &lt;identifier&gt;
      &lt;system value=&quot;urn:mrns&quot;/&gt;
      &lt;value value=&quot;253345&quot;/&gt;
   &lt;/identifier&gt;
   &lt;managingOrganization&gt;
      &lt;reference value=&quot;Organization/112&quot;/&gt;
   &lt;/managingOrganization&gt;
&lt;/Patient&gt;</pre></div>
			
			
<p>
				Given a Patient resource obtained by invoking a client operation, a call to 
				<tt>IdDt ref = patient.getManagingOrganization().getReference();</tt>
				returns an instance of IdDt which contains the &quot;Organization/112&quot; reference.
			</p>
			
			
<p>
				ResourceReferenceDt also has a field for storing actual resource instances however,
				and this can be very useful.
			</p>
			

		</div>

		
<div class="section">
<h2><a name="References_in_Client_Code"></a>References in Client Code</h2>
		
			
<p>
				In client code, if a resource reference refers to a resource which was received as a
				part of the same response, <tt>getResource()</tt> will be populated with the 
				actual resource. This can happen because either the resource was received as a 
				contained resource, or the resource was received as a separate resource in a bundle.
			</p>
			
		</div>

		
<div class="section">
<h2><a name="References_in_Server_Code"></a>References in Server Code</h2>
		
			
<p>
				In server code, you will often want to return a resource which contains
				a link to another resource. Generally these &quot;linked&quot; resources are
				not actually included in the response, but rather a link to the
				resource is included and the client may request that resource directly
				(by ID) if it is needed.  
			</p>
			
			
<p>
				The following example shows a Patient resource being created which will have a
				link to its managing organization when encoded from a server:
			</p>
			
<div class="source">
<pre>Patient patient = new Patient();
patient.setId(&quot;Patient/1333&quot;);
patient.addIdentifier(&quot;urn:mrns&quot;, &quot;253345&quot;);
patient.getManagingOrganization().setReference(&quot;Organization/124362&quot;);</pre></div>
			
			
<div class="section">
<h3><a name="Handling_Includes__include_in_a_Bundle"></a>Handling Includes (_include) in a Bundle</h3>
				
				
<p>
					Your server code may also wish to add additional resource to a bundle
					being returned (e.g. because of an _include directive in the client's request).
				</p>
				
				
<p>
					To do this, you can implement your server method to simply return 
					<tt>List&lt;IResource&gt;</tt> and then simply add your extra resources to
					the list. Another technique however, is to populate the reference as shown
					in the example below, but ensure that the referenced resource has an ID set.
				</p>
			
				
<p>
					In the following example, the Organization resource has an ID set, so it will not
					be contained but will rather appear as a distinct entry in any returned
					bundles. Both resources are added to a bundle, which will then have
					two entries:
				</p>
				
<div class="source">
<pre>// Create an organization
Organization org = new Organization();
org.setId(&quot;Organization/65546&quot;);
org.getName().setValue(&quot;Contained Test Organization&quot;);

// Create a patient
Patient patient = new Patient();
patient.setId(&quot;Patient/1333&quot;);
patient.addIdentifier(&quot;urn:mrns&quot;, &quot;253345&quot;);
patient.getManagingOrganization().setResource(org);

// Create a list containing both resources. In a server method, you might just
// return this list, but here we will create a bundle to encode.
List&lt;IResource&gt; resources = new ArrayList&lt;IResource&gt;();
resources.add(org);
resources.add(patient);		

// Create a bundle with both
Bundle b = Bundle.withResources(resources, ourCtx, &quot;http://example.com/base&quot;);

// Encode the buntdle
String encoded = ourCtx.newXmlParser().setPrettyPrint(true).encodeBundleToString(b);
System.out.println(encoded);</pre></div>

				
<p>
					This will give the following output:
				</p>
				
<div class="source">
<pre>&lt;feed xmlns=&quot;http://www.w3.org/2005/Atom&quot;&gt;
   &lt;entry&gt;
      &lt;title&gt;Organization Organization/65546&lt;/title&gt;
      &lt;id&gt;http://example.com/base/Organization/65546&lt;/id&gt;
      &lt;published&gt;2014-10-14T09:22:54-04:00&lt;/published&gt;
      &lt;link rel=&quot;self&quot; href=&quot;http://example.com/base/Organization/65546&quot;/&gt;
      &lt;content type=&quot;text/xml&quot;&gt;
         &lt;Organization xmlns=&quot;http://hl7.org/fhir&quot;&gt;
            &lt;name value=&quot;Contained Test Organization&quot;/&gt;
         &lt;/Organization&gt;
      &lt;/content&gt;
   &lt;/entry&gt;
   &lt;entry&gt;
      &lt;title&gt;Patient Patient/1333&lt;/title&gt;
      &lt;id&gt;http://example.com/base/Patient/1333&lt;/id&gt;
      &lt;published&gt;2014-10-14T09:22:54-04:00&lt;/published&gt;
      &lt;link rel=&quot;self&quot; href=&quot;http://example.com/base/Patient/1333&quot;/&gt;
      &lt;content type=&quot;text/xml&quot;&gt;
         &lt;Patient xmlns=&quot;http://hl7.org/fhir&quot;&gt;
            &lt;identifier&gt;
               &lt;system value=&quot;urn:mrns&quot;/&gt;
               &lt;value value=&quot;253345&quot;/&gt;
            &lt;/identifier&gt;
            &lt;managingOrganization&gt;
               &lt;reference value=&quot;Organization/65546&quot;/&gt;
            &lt;/managingOrganization&gt;
         &lt;/Patient&gt;
      &lt;/content&gt;
   &lt;/entry&gt;
&lt;/feed&gt;</pre></div>
		
			</div>
			
			
<div class="section">
<h3><a name="Contained_Resources"></a>Contained Resources</h3>
				
				
<p>
					On the other hand, if the linked resource
					does not have an ID set, the linked resource will
					be included in the returned bundle as a &quot;contained&quot; resource. In this
					case, HAPI itself will define a local reference ID (e.g. &quot;#1&quot;).
				</p>
				
<div class="source">
<pre>// Create an organization, note that the organization does not have an ID
Organization org = new Organization();
org.getName().setValue(&quot;Contained Test Organization&quot;);

// Create a patient
Patient patient = new Patient();
patient.setId(&quot;Patient/1333&quot;);
patient.addIdentifier(&quot;urn:mrns&quot;, &quot;253345&quot;);

// Put the organization as a reference in the patient resource
patient.getManagingOrganization().setResource(org);

String encoded = ourCtx.newXmlParser().setPrettyPrint(true).encodeResourceToString(patient);
System.out.println(encoded);</pre></div>
				
				
<p>
					This will give the following output:
				</p>
				
<div class="source">
<pre>&lt;Patient xmlns=&quot;http://hl7.org/fhir&quot;&gt;
   &lt;contained&gt;
      &lt;Organization xmlns=&quot;http://hl7.org/fhir&quot; id=&quot;1&quot;&gt;
         &lt;name value=&quot;Contained Test Organization&quot;/&gt;
      &lt;/Organization&gt;
   &lt;/contained&gt;
   &lt;identifier&gt;
      &lt;system value=&quot;urn:mrns&quot;/&gt;
      &lt;value value=&quot;253345&quot;/&gt;
   &lt;/identifier&gt;
   &lt;managingOrganization&gt;
      &lt;reference value=&quot;#1&quot;/&gt;
   &lt;/managingOrganization&gt;
&lt;/Patient&gt;</pre></div>
				
			</div>
			
			
<p>
				Note that you may also &quot;contain&quot; resources manually in your own code if you 
				prefer. The following example show how to do this:
			</p>
			
				
				
			
<div class="source">
<pre>      // Create an organization, and give it a local ID
      Organization org = new Organization();
      org.setId(&quot;#localOrganization&quot;);
      org.getName().setValue(&quot;Contained Test Organization&quot;);

      // Create a patient
      Patient patient = new Patient();
      patient.setId(&quot;Patient/1333&quot;);
      patient.addIdentifier(&quot;urn:mrns&quot;, &quot;253345&quot;);

      // Set the reference, and manually add the contained resource
      patient.getManagingOrganization().setReference(&quot;#localOrganization&quot;);
      patient.getContained().getContainedResources().add(org);

      String encoded = ourCtx.newXmlParser().setPrettyPrint(true).encodeResourceToString(patient);
      System.out.println(encoded);
</pre></div>
						
						
						
		</div>
		
		
	


                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2014
                        <a href="http://www.uhn.ca">University Health Network</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        <script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>
                </body >
</html>