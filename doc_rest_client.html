<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-07-13 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="James Agnew" />
    <meta name="Date-Revision-yyyymmdd" content="20140713" />
    <meta http-equiv="Content-Language" content="en" />
    <title>HAPI - 
		RESTful Client - HAPI FHIR</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

                          
        
<script src="syntaxhighlighter/shCore.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushJScript.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushJava.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushBash.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushXml.js" type="text/javascript"></script>
                      
        
<link rel="stylesheet" type="text/css" href="syntaxhighlighter/shCore.css"/>
                      
        
<link rel="stylesheet" type="text/css" href="syntaxhighlighter/shThemeDefault.css"/>
                      
        
<link rel="shortcut icon" href="http://hl7api.sourceforge.net/images/favicon.png"/>
                      
        
<link rel="stylesheet" type="text/css" href="hapi.css"/>
          
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="./" id="bannerLeft">
                                                                                                <img src="images/hapi_fhir_banner.png"  alt="HAPI"/>
                </a>
                      </div>
        <div class="pull-right">                                <a href="./" id="bannerRight">
                                                                                                <img src="images/hapi_fhir_banner_right.png"  alt="FHIR"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-07-13
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 0.4
                      </li>
                      
                
                    
      
                                    
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://www.uhn.ca/" class="externalLink" title="University Health Network">
        University Health Network</a>
      </li>

  
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://hl7.org/" class="externalLink" title="hl7.org">
        hl7.org</a>
      </li>

  
    <li class="pull-right">
                      <a href="https://github.com/jamesagnew/hapi-fhir/" class="externalLink" title="GitHub Page">
        GitHub Page</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Welcome</li>
                              
      <li>
  
                          <a href="index.html" title="Welcome">
          <i class="none"></i>
        Welcome</a>
            </li>
                
      <li>
  
                          <a href="download.html" title="Download">
          <i class="none"></i>
        Download</a>
            </li>
                
      <li>
  
                          <a href="changes-report.html" title="Changelog">
          <i class="none"></i>
        Changelog</a>
            </li>
                              <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="doc_intro.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                
      <li>
  
                          <a href="doc_fhirobjects.html" title="The Data Model">
          <i class="none"></i>
        The Data Model</a>
            </li>
                
      <li>
  
                          <a href="doc_rest_server.html" title="RESTful Server">
          <i class="none"></i>
        RESTful Server</a>
            </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>RESTful Client</a>
          </li>
                
      <li>
  
                          <a href="doc_rest_operations.html" title="RESTful Operations">
          <i class="none"></i>
        RESTful Operations</a>
            </li>
                
      <li>
  
                          <a href="doc_extensions.html" title="Extensions">
          <i class="none"></i>
        Extensions</a>
            </li>
                
      <li>
  
                          <a href="doc_narrative.html" title="Narrative Generator">
          <i class="none"></i>
        Narrative Generator</a>
            </li>
                
      <li>
  
                          <a href="doc_tinder.html" title="Tinder Plugin">
          <i class="none"></i>
        Tinder Plugin</a>
            </li>
                              <li class="nav-header">JavaDocs</li>
                              
      <li>
  
                          <a href="apidocs/index.html" title="API Documentation">
          <i class="none"></i>
        API Documentation</a>
            </li>
                
      <li>
  
                          <a href="xref/index.html" title="JXR">
          <i class="none"></i>
        JXR</a>
            </li>
                              <li class="nav-header">Reports</li>
                              
      <li>
  
                          <a href="team-list.html" title="Developers">
          <i class="none"></i>
        Developers</a>
            </li>
                
      <li>
  
                          <a href="surefire-report.html" title="Unit Test Report">
          <i class="none"></i>
        Unit Test Report</a>
            </li>
                
      <li>
  
                          <a href="findbugs.html" title="FindBugs">
          <i class="none"></i>
        FindBugs</a>
            </li>
                
      <li>
  
                          <a href="license.html" title="License">
          <i class="none"></i>
        License</a>
            </li>
                
      <li>
  
                          <a href="http://sourceforge.net/p/hl7api/fhircode/ci/master/tree/" class="externalLink" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="hl7api.sourceforge.net/hapi-fhir/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="https://sourceforge.net/projects/hl7api/" title="Hosted on SourceForge.net" class="builtBy">
        <img class="builtBy"  alt="Hosted on SourceForge.net" src="http://sflogo.sourceforge.net/sflogo.php?group_id=38899&type=2"    />
      </a>
                                                                                                          <a href="http://maven.apache.org" title="Built with Maven 2" class="builtBy">
        <img class="builtBy"  alt="Built with Maven 2" src="images/logos/maven-feather.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            

	

		<!-- The body of the document contains a number of sections -->
		<div class="section">
<h2>Creating a RESTful Client<a name="Creating_a_RESTful_Client"></a></h2>

			
			
<ul>
<li><a href="#Creating_a_RESTful_Client">Creating a RESTful Client</a></li>
<li><a href="#The_Generic_Client">The Generic Client</a>
<ul>
<li><a href="#SearchQuery">Search/Query</a></li></ul></li>
<li><a href="#The_Annotation-Driven_Client">The Annotation-Driven Client</a>
<ul>
<li><a href="#Defining_A_Restful_Client_Interface">Defining A Restful Client Interface</a></li>
<li><a href="#Instantiate_the_Client">Instantiate the Client</a></li>
<li><a href="#A_Complete_Example">A Complete Example</a></li></ul></li>
<li><a href="#Configuring_the_Client">Configuring the Client</a>
<ul>
<li><a href="#HTTP_Basic_Authorization">HTTP Basic Authorization</a></li>
<li><a href="#Configuring_Encoding_JSONXML">Configuring Encoding (JSON/XML)</a></li></ul></li></ul>

			
<p>
				HAPI provides a built-in mechanism for connecting to FHIR RESTful
				servers.
				The HAPI RESTful client is designed to be easy to set up and
				to allow strong
				compile-time type checking wherever possible.
			</p>

			
<p>
				There are two types of clients provided by HAPI: Generic and Annotation-driven.
				The generic client (introduced in HAPI-FHIR 0.3) is much simpler to create
				and generally provides the faster way to get started. The annotation-driven
				client is more powerful and can rely on code generation to give better
				compile-time checking. 
			</p>

		</div>
		
		
<div class="section">
<h2>The Generic Client<a name="The_Generic_Client"></a></h2>
		
			
<p>
				Creating a generic client simply requires you to create an instance of
				<tt>FhirContext</tt> and use that to instantiate a client.
			</p>			
			
<p>
				The following example shows how to create a client, and a few operations which
				can be performed.
			</p>
			
			
				
				
			
<div class="source">
<pre>FhirContext ctx = new FhirContext();
String serverBase = &quot;http://fhir.healthintersections.com.au/open&quot;;
IGenericClient client = ctx.newRestfulGenericClient(serverBase);

// Read a patient
Patient patient = client.read(Patient.class, &quot;1&quot;);

// Change the patient and update it to the server
patient.getNameFirstRep().getFamilyFirstRep().setValue(&quot;Jones&quot;);
client.update(&quot;1&quot;, patient);

// Return the version history for that patient
Bundle versions = client.history(Patient.class, &quot;1&quot;,null,null);
</pre></div>
			
			
<p> 
				<b>Performance Tip: </b> Note that FhirContext is an expensive object to create,
				so you should try to keep an instance around for the lifetime of your application. It
				is thread-safe so it can be passed as needed. Client instances, on the other hand, 
				are very inexpensive to create so you can create a new one for each request if needed 
				(although there is no requirement to do so, clients are reusable and thread-safe as well).  
			</p>
			
			
<div class="section">
<h3>Search/Query<a name="SearchQuery"></a></h3>
			
				
<p>
					The generic client supports queries using a fluent interface
					which is inspired by the fantastic 
					<a class="externalLink" href="http://ewoutkramer.github.io/fhir-net-api/client-search.html">.NET FHIR API</a>.
					The fluent interface allows you to construct powerful queries by chaining
					method calls together, leading to highly readable code. It also allows
					you to take advantage of intellisense/code completion in your favourite
					IDE.
				</p>
				
				
<p>
					The following example shows how to query using this interface:
				</p>

				
					
					
				
<div class="source">
<pre>Bundle response = client.search()
  .forResource(Patient.class)
  .where(Patient.BIRTHDATE.beforeOrEquals().day(&quot;2011-01-01&quot;))
  .and(Patient.PROVIDER.hasChainedProperty(Organization.NAME.matches().value(&quot;Health&quot;)))
  .andLogRequestAndResponse(true)
  .execute();
</pre></div>
				
			</div>			
			
		</div>
		
		
<div class="section">
<h2>The Annotation-Driven Client<a name="The_Annotation-Driven_Client"></a></h2>

			
<p>
				The design of the annotation-driven client
				is intended to be similar to that of
				JAX-WS, so users of that
				specification should be comfortable with
				this one. It uses a user-defined interface containing special
				annotated methods which HAPI binds to calls against a server.
			</p>

			
<div class="section">
<h3>Defining A Restful Client Interface<a name="Defining_A_Restful_Client_Interface"></a></h3>

				
<p>
					The first step in creating a FHIR RESTful Client is to define a
					restful client interface.
				</p>

				
<p>
					A restful client interface class must extend the
					<a href="./apidocs/ca/uhn/fhir/rest/client/api/IRestfulClient.html">IRestfulClient</a>
					interface,
					and will contain one or more methods which have been
					annotated with special annotations indicating which RESTful
					operation
					that method supports. Below is a simple example of a
					resource provider
					which supports the
					<a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#read">read</a>
					operation (i.e. retrieve a single resource by ID) as well as the
					<a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#search">search</a>
					operation (i.e. find any resources matching a given criteria) for a
					specific
					search criteria.
				</p>

				
<p>
					You may notice that this interface looks a lot like the Resource
					Provider
					which is defined for use by the RESTful server. In fact, it
					supports all
					of the same annotations and is essentially identical,
					other than the
					fact that for a client you must use an interface but for a server you
					must use a concrete class with method implementations.
				</p>

				
					
					
				
<div class="source">
<pre>Error during retrieving content skip as ignoreDownloadError activated.</pre></div>

				
<p>
					You will probably want to add more methods
					to your client interface.
					See
					<a href="./doc_rest_operations.html">RESTful Operations</a>
					for
					lots more examples of how to add methods for various operations.
				</p>

			</div>

			
<div class="section">
<h3>Instantiate the Client<a name="Instantiate_the_Client"></a></h3>

				
<p>
					Once your client interface is created, all that is left is to
					create a FhirContext and instantiate the client and you are
					ready to
					start using it.
				</p>

				
					
					
				
<div class="source">
<pre>public static void main(String[] args) {
   FhirContext ctx = new FhirContext();
   String serverBase = &quot;http://foo.com/fhirServerBase&quot;;
   
   // Create the client
   IRestfulClient client = ctx.newRestfulClient(IRestfulClient.class, serverBase);
   
   // Try the client out! This method will invoke the server
   List&lt;Patient&gt; patients = client.getPatient(new StringDt(&quot;SMITH&quot;));
   
}
</pre></div>

			</div>

			
<div class="section">
<h3>A Complete Example<a name="A_Complete_Example"></a></h3>
	
				
<p>
					The following is a complete example showing a RESTful client
					using
					HAPI FHIR.
				</p>
	
				
					
					
				
<div class="source">
<pre>import java.io.IOException;
import java.util.List;

import ca.uhn.fhir.context.FhirContext;
import ca.uhn.fhir.model.dstu.composite.IdentifierDt;
import ca.uhn.fhir.model.dstu.composite.ResourceReferenceDt;
import ca.uhn.fhir.model.dstu.resource.Organization;
import ca.uhn.fhir.model.dstu.resource.Patient;
import ca.uhn.fhir.rest.annotation.RequiredParam;
import ca.uhn.fhir.rest.annotation.Search;
import ca.uhn.fhir.rest.client.api.IRestfulClient;

public class CompleteExampleClient {

	/**
	 * This is a simple client interface. It can have many methods
	 * for various searches but in this case it has only 1.
	 */
	public static interface ClientInterface extends IRestfulClient
	{ 
	 
		/**
		 * This is translated into a URL similar to the following:
		 * http://fhir.healthintersections.com.au/open/Patient?identifier=urn:oid:1.2.36.146.595.217.0.1%7C12345 
		 */
		@Search
		List&lt;Patient&gt; findPatientsForMrn(@RequiredParam(name=Patient.SP_IDENTIFIER) IdentifierDt theIdentifier);
		
	}

	/**
	 * The main method here will directly call an open FHIR server
	 * and retrieve a list of resources matching a given criteria,
	 * then load a linked resource.
	 */
	public static void main(String[] args) throws IOException {
		
		// Create a client factory
		FhirContext ctx = new FhirContext();
		
		//Create the client
		String serverBase = &quot;http://fhir.healthintersections.com.au/open&quot;;
		ClientInterface client = ctx.newRestfulClient(ClientInterface.class, serverBase);
		
		// Invoke the client to search for patient
		List&lt;Patient&gt; patients = client.findPatientsForMrn(new IdentifierDt(&quot;urn:oid:1.2.36.146.595.217.0.1&quot;, &quot;12345&quot;));
		
		System.out.println(&quot;Found &quot;+ patients.size() + &quot; patients&quot;);
		
		// Print a value from the loaded resource
		Patient patient = patients.get(0);
		System.out.println(&quot;Patient Last Name: &quot; + patient.getName().get(0).getFamily().get(0).getValue());
		
		// Load a referenced resource
		ResourceReferenceDt managingRef = patient.getManagingOrganization();
		Organization org = (Organization) managingRef.loadResource(client);
		
		// Print organization name
		System.out.println(org.getName().getValue());
		
	}

}
</pre></div>
				
			</div>
			
		</div>

		
<div class="section">
<h2>Configuring the Client<a name="Configuring_the_Client"></a></h2>

			
<p>
				RESTful clients (both Generic and Annotation-Driven) use 
				<a class="externalLink" href="http://hc.apache.org/httpcomponents-client-ga/">Apache HTTP Client</a>
				as a provider. The Apache HTTP Client is very powerful and extremely flexible, 
				but can be confusing at first to configure, because of the low-level approach that
				the library uses. 
			</p>

			
<p>
				In many cases, the default configuration should suffice. However, if you require anything
				more sophisticated (username/password, HTTP proxy settings, etc.) you will need
				to configure the underlying client. 
			</p>
			
			
<p>
				The underlying client configuration is provided by setting an
				<a href="./apidocs/ca/uhn/fhir/rest/client/IRestfulClientFactory.html#setHttpClientorg.apache.http.client.HttpClient">HttpClient</a>
				on the RestfulClientFactory. 
			</p>

			
<div class="section">
<h3>HTTP Basic Authorization<a name="HTTP_Basic_Authorization"></a></h3>

				
<p>
					The following example shows how to configure your client to
					use a specific username and password in every request.
				</p>

				
					
					
				
<div class="source">
<pre>// Create a context and get the client factory so it can be configured
FhirContext ctx = new FhirContext();
IRestfulClientFactory clientFactory = ctx.getRestfulClientFactory();

// Create an HTTP Client Builder
HttpClientBuilder builder = HttpClientBuilder.create();

// This interceptor adds HTTP username/password to every request 
String username = &quot;foobar&quot;;
String password = &quot;boobear&quot;;
builder.addInterceptorFirst(new HttpBasicAuthInterceptor(username, password));

// Use the new HTTP client builder
clientFactory.setHttpClient(builder.build());

// This factory is applied to both styles of client
IPatientClient annotationClient = ctx.newRestfulClient(IPatientClient.class, &quot;http://localhost:9999/fhir&quot;);
IGenericClient genericClient = ctx.newRestfulGenericClient(&quot;http://localhost:9999/fhir&quot;);
</pre></div>

			</div>

			
<div class="section">
<h3>Configuring Encoding (JSON/XML)<a name="Configuring_Encoding_JSONXML"></a></h3>

				
<p>
					Restful client interfaces that you create will also extend
					the interface 
					<a href="./apidocs/ca/uhn/fhir/rest/client/api/IRestfulClient.html">IRestfulClient</a>,
					which comes with some helpful methods for configuring the way that
					the client will interact with the server.
				</p>
				
<p>
					The following snippet shows how to configure the cliet to explicitly 
					request JSON or XML responses, and how to request &quot;pretty printed&quot; responses
					on servers that support this (HAPI based servers currently).				
				</p>
				
				
					
					
				
<div class="source">
<pre>//Create a client
FhirContext ctx = new FhirContext();
IPatientClient client = ctx.newRestfulClient(IPatientClient.class, &quot;http://localhost:9999/&quot;);

// Request JSON encoding from the server (_format=json)
client.setEncoding(EncodingEnum.JSON);

// Request pretty printing from the server (_pretty=true)
client.setPrettyPrint(true);
</pre></div>

			</div>

		</div>

	


                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2014
                        <a href="http://www.uhn.ca">University Health Network</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        <script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'sourceforge.net');
  ga('send', 'pageview');

</script>
                </body >
</html>