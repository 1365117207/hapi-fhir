<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-08-20 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="James Agnew" />
    <meta name="Date-Revision-yyyymmdd" content="20140820" />
    <meta http-equiv="Content-Language" content="en" />
    <title>HAPI &#x2013; RESTful Client - HAPI FHIR</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

                          
        
<script src="syntaxhighlighter/shCore.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushJScript.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushJava.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushBash.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushXml.js" type="text/javascript"></script>
                      
        
<link rel="stylesheet" type="text/css" href="syntaxhighlighter/shCore.css"/>
                      
        
<link rel="stylesheet" type="text/css" href="syntaxhighlighter/shThemeDefault.css"/>
                      
        
<link rel="shortcut icon" href="http://hl7api.sourceforge.net/images/favicon.png"/>
                      
        
<link rel="stylesheet" type="text/css" href="hapi.css"/>
          
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://hl7api.sourceforge.net/hapi-fhir/" id="bannerLeft">
                                                                                                <img src="images/hapi_fhir_banner.png"  alt="HAPI"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="http://hl7api.sourceforge.net/hapi-fhir/" id="bannerRight">
                                                                                                <img src="images/hapi_fhir_banner_right.png"  alt="FHIR"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-08-20
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 0.6-SNAPSHOT
                      </li>
                      
                
                    
      
                                    
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://www.uhn.ca/" class="externalLink" title="University Health Network">
        University Health Network</a>
      </li>

  
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://hl7.org/" class="externalLink" title="hl7.org">
        hl7.org</a>
      </li>

  
    <li class="pull-right">
                      <a href="https://github.com/jamesagnew/hapi-fhir/" class="externalLink" title="GitHub Page">
        GitHub Page</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Welcome</li>
                              
      <li>
  
                          <a href="index.html" title="Welcome">
          <i class="none"></i>
        Welcome</a>
            </li>
                
      <li>
  
                          <a href="download.html" title="Download">
          <i class="none"></i>
        Download</a>
            </li>
                
      <li>
  
                          <a href="doc_upgrading.html" title="Upgrade Guide">
          <i class="none"></i>
        Upgrade Guide</a>
            </li>
                
      <li>
  
                          <a href="changes-report.html" title="Changelog">
          <i class="none"></i>
        Changelog</a>
            </li>
                              <li class="nav-header">Test Server</li>
                              
      <li>
  
                          <a href="http://fhirtest.uhn.ca" class="externalLink" title="Public Test Server">
          <i class="none"></i>
        Public Test Server</a>
            </li>
                              <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="doc_intro.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                                                                                                
      <li>
  
                          <a href="doc_fhirobjects.html" title="The Data Model">
          <i class="icon-chevron-down"></i>
        The Data Model</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="doc_extensions.html" title="Extensions">
          <i class="none"></i>
        Extensions</a>
            </li>
                    
      <li>
  
                          <a href="doc_resource_references.html" title="Resource References">
          <i class="none"></i>
        Resource References</a>
            </li>
                    
      <li>
  
                          <a href="doc_tags.html" title="Tags">
          <i class="none"></i>
        Tags</a>
            </li>
              </ul>
        </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>RESTful Client</a>
          </li>
                                                                                                                  
      <li>
  
                          <a href="doc_rest_server.html" title="RESTful Server">
          <i class="icon-chevron-down"></i>
        RESTful Server</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="doc_rest_operations.html" title="RESTful Operations">
          <i class="none"></i>
        RESTful Operations</a>
            </li>
                    
      <li>
  
                          <a href="doc_narrative.html" title="Narrative Generator">
          <i class="none"></i>
        Narrative Generator</a>
            </li>
                    
      <li>
  
                          <a href="doc_cors.html" title="CORS Support">
          <i class="none"></i>
        CORS Support</a>
            </li>
                    
      <li>
  
                          <a href="doc_server_tester.html" title="Web Testing UI">
          <i class="none"></i>
        Web Testing UI</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="doc_logging.html" title="Logging">
          <i class="none"></i>
        Logging</a>
            </li>
                
      <li>
  
                          <a href="doc_tinder.html" title="Tinder Plugin">
          <i class="none"></i>
        Tinder Plugin</a>
            </li>
                              <li class="nav-header">Community</li>
                              
      <li>
  
                          <a href="https://groups.google.com/d/forum/hapi-fhir" class="externalLink" title="Google Group">
          <i class="none"></i>
        Google Group</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/jamesagnew/hapi-fhir/issues" class="externalLink" title="Issue Tracker">
          <i class="none"></i>
        Issue Tracker</a>
            </li>
                              <li class="nav-header">JavaDocs</li>
                              
      <li>
  
                          <a href="apidocs/index.html" title="API Documentation">
          <i class="none"></i>
        API Documentation</a>
            </li>
                
      <li>
  
                          <a href="xref/index.html" title="JXR">
          <i class="none"></i>
        JXR</a>
            </li>
                              <li class="nav-header">Reports</li>
                              
      <li>
  
                          <a href="team-list.html" title="Developers">
          <i class="none"></i>
        Developers</a>
            </li>
                
      <li>
  
                          <a href="surefire-report.html" title="Unit Test Report">
          <i class="none"></i>
        Unit Test Report</a>
            </li>
                
      <li>
  
                          <a href="findbugs.html" title="FindBugs">
          <i class="none"></i>
        FindBugs</a>
            </li>
                
      <li>
  
                          <a href="license.html" title="License">
          <i class="none"></i>
        License</a>
            </li>
                
      <li>
  
                          <a href="http://sourceforge.net/p/hl7api/fhircode/ci/master/tree/" class="externalLink" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="jamesagnew.github.io/hapi-fhir/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="https://sourceforge.net/projects/hl7api/" title="Hosted on SourceForge.net" class="builtBy">
        <img class="builtBy"  alt="Hosted on SourceForge.net" src="http://sflogo.sourceforge.net/sflogo.php?group_id=38899&type=2"    />
      </a>
                                                                                                          <a href="http://maven.apache.org" title="Built with Maven 2" class="builtBy">
        <img class="builtBy"  alt="Built with Maven 2" src="images/logos/maven-feather.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            

	

		<!-- The body of the document contains a number of sections -->
		<div class="section">
<h2><a name="Creating_a_RESTful_Client"></a>Creating a RESTful Client</h2>

			
			
<ul>
<li><a href="#Creating_a_RESTful_Client">Creating a RESTful Client</a></li>
<li><a href="#The_Generic_Client">The Generic Client</a>
<ul>
<li><a href="#Fluent_Operations">Fluent Operations</a></li>
<li><a href="#Type_-_SearchQuery">Type - Search/Query</a>
<ul>
<li><a href="#Search_-_Multi-valued_Parameters_ANYOR">Search - Multi-valued Parameters (ANY/OR)</a></li>
<li><a href="#Search_-_Multi-valued_Parameters_ALLAND">Search - Multi-valued Parameters (ALL/AND)</a></li>
<li><a href="#Search_-_Paging">Search - Paging</a></li>
<li><a href="#Search_-_Composite_Parameters">Search - Composite Parameters</a></li>
<li><a href="#Search_-_Other_Query_Options">Search - Other Query Options</a></li>
<li><a href="#Search_-_Using_HTTP_POST_or_GET_with__search">Search - Using HTTP POST or GET with _search</a></li></ul></li>
<li><a href="#Type_-_Create">Type - Create</a></li>
<li><a href="#Instance_-_Delete">Instance - Delete</a></li>
<li><a href="#Instance_-_Update">Instance - Update</a></li>
<li><a href="#Server_-_Conformance">Server - Conformance</a></li>
<li><a href="#Server_-_Transaction">Server - Transaction</a></li></ul></li>
<li><a href="#The_Annotation-Driven_Client">The Annotation-Driven Client</a>
<ul>
<li><a href="#Defining_A_Restful_Client_Interface">Defining A Restful Client Interface</a></li>
<li><a href="#Instantiate_the_Client">Instantiate the Client</a></li>
<li><a href="#Configuring_Encoding_JSONXML">Configuring Encoding (JSON/XML)</a></li>
<li><a href="#A_Complete_Example">A Complete Example</a></li></ul></li>
<li><a href="#Configuring_the_Client">Configuring the Client</a>
<ul>
<li><a href="#Interceptors">Interceptors</a></li>
<li><a href="#HTTP_Basic_Authorization">HTTP Basic Authorization</a></li>
<li><a href="#Logging_Requests_and_Responses">Logging Requests and Responses</a></li>
<li><a href="#Configuring_an_HTTP_Proxy">Configuring an HTTP Proxy</a></li></ul></li></ul>

			
<p>
				HAPI provides a built-in mechanism for connecting to FHIR RESTful
				servers.
				The HAPI RESTful client is designed to be easy to set up and
				to allow strong
				compile-time type checking wherever possible.
			</p>

			
<p>
				There are two types of clients provided by HAPI: Generic and Annotation-driven.
				The generic client (introduced in HAPI-FHIR 0.3) is much simpler to create
				and generally provides the faster way to get started. The annotation-driven
				client can rely on code generation and static binding to specific operations to 
				give better	compile-time checking against servers with a specific set of capabilities
				exposed. 
			</p>

		</div>
		
		
<div class="section">
<h2><a name="The_Generic_Client"></a>The Generic Client</h2>
		
			
<p>
				Creating a generic client simply requires you to create an instance of
				<tt>FhirContext</tt> and use that to instantiate a client.
			</p>			
			
<p>
				The following example shows how to create a client, and a few operations which
				can be performed.
			</p>
			
			
				
				
			
<div class="source">
<pre>FhirContext ctx = new FhirContext();
String serverBase = &quot;http://fhirtest.uhn.ca/base&quot;;
IGenericClient client = ctx.newRestfulGenericClient(serverBase);

// Perform a search
Bundle results = client.search()
      .forResource(Patient.class)
      .where(Patient.FAMILY.matches().value(&quot;duck&quot;))
      .execute();

System.out.println(&quot;Found &quot; + results.size() + &quot; patients named 'duck'&quot;);
</pre></div>
			
			
<p> 
				<b>Performance Tip: </b> Note that FhirContext is an expensive object to create,
				so you should try to keep an instance around for the lifetime of your application. It
				is thread-safe so it can be passed as needed. Client instances, on the other hand, 
				are very inexpensive to create so you can create a new one for each request if needed 
				(although there is no requirement to do so, clients are reusable and thread-safe as well).  
			</p>

			
<div class="section">
<h3><a name="Fluent_Operations"></a>Fluent Operations</h3>
				
<p>
					The generic client supports queries using a fluent interface
					which is inspired by the fantastic 
					<a class="externalLink" href="http://ewoutkramer.github.io/fhir-net-api/client-search.html">.NET FHIR API</a>.
					The fluent interface allows you to construct powerful queries by chaining
					method calls together, leading to highly readable code. It also allows
					you to take advantage of intellisense/code completion in your favourite
					IDE.
				</p>
				
<p>
					Note that most fluent operations end with an <tt>execute()</tt>
					statement which actually performs the invocation. You may also invoke
					several configuration operations just prior to the execute() statement,
					such as <tt>encodedJson()</tt> or <tt>encodedXml()</tt>.
				</p>
			</div>
						
			
<div class="section">
<h3><a name="Type_-_SearchQuery"></a>Type - Search/Query</h3>
				
				
<p>
					Searching for resources is probably the most common initial scenario for
					client applications, so we'll start the demonstration there.
				</p>
				
<p>
					The following example shows how to query using the generic client:
				</p>
				
					
					
				
<div class="source">
<pre>Bundle response = client.search()
  .forResource(Patient.class)
  .where(Patient.BIRTHDATE.beforeOrEquals().day(&quot;2011-01-01&quot;))
  .and(Patient.PROVIDER.hasChainedProperty(Organization.NAME.matches().value(&quot;Health&quot;)))
  .execute();
</pre></div>
				
				
<div class="section">
<h4><a name="Search_-_Multi-valued_Parameters_ANYOR"></a>Search - Multi-valued Parameters (ANY/OR)</h4>
				
<p>
					To search for a set of possible values where <b>ANY</b> should be matched, 
					you can provide multiple values to a parameter, as shown in the example below.
					This leads to a URL resembling <tt>?family=Smith,Smyth</tt> 
				</p>
				
					
					
				
<div class="source">
<pre>response = client.search()
   .forResource(Patient.class)
   .where(Patient.FAMILY.matches().values(&quot;Smith&quot;, &quot;Smyth&quot;))
   .execute();
</pre></div>

				</div>
<div class="section">
<h4><a name="Search_-_Multi-valued_Parameters_ALLAND"></a>Search - Multi-valued Parameters (ALL/AND)</h4>
				
<p>
					To search for a set of possible values where <b>ALL</b> should be matched,
					you can provide multiple instances of a marameter, as shown in the example below.
					This leads to a URL resembling <tt>?address=Toronto&amp;address=Ontario&amp;address=Canada</tt> 
				</p>
				
					
					
				
<div class="source">
<pre>response = client.search()
   .forResource(Patient.class)
   .where(Patient.FAMILY.matches().values(&quot;Smith&quot;, &quot;Smyth&quot;))
   .execute();
</pre></div>

				</div>
<div class="section">
<h4><a name="Search_-_Paging"></a>Search - Paging</h4>
				
<p>
					If the server supports paging results, the client has a page method
					which can be used to load subsequent pages.
				</p>
				
					
					
				
<div class="source">
<pre>if (response.getLinkNext().isEmpty() == false) {

   // load next page
   Bundle nextPage = client.loadPage()
      .next(response)
      .execute();
}
</pre></div>
				
				</div>
<div class="section">
<h4><a name="Search_-_Composite_Parameters"></a>Search - Composite Parameters</h4>
				
<p>
					If a composite parameter is being searched on, the parameter
					takes a &quot;left&quot; and &quot;right&quot; operand, each of which is
					a parameter from the resource being seached. The following example shows the
					syntax.
				</p>
				
					
					
				
<div class="source">
<pre>response = client.search()
   .forResource(&quot;Observation&quot;)
   .where(Observation.NAME_VALUE_DATE
      .withLeft(Observation.NAME.exactly().code(&quot;FOO$BAR&quot;))
      .withRight(Observation.VALUE_DATE.exactly().day(&quot;2001-01-01&quot;))
      )
   .execute();
</pre></div>
				
				</div>
<div class="section">
<h4><a name="Search_-_Other_Query_Options"></a>Search - Other Query Options</h4>
				
<p>
					The fluent search also has methods for sorting, limiting, specifying
					JSON encoding, etc.
				</p>
				
					
					
				
<div class="source">
<pre>response = client.search()
   .forResource(Patient.class)
   .encodedJson()
   .where(Patient.BIRTHDATE.beforeOrEquals().day(&quot;2012-01-22&quot;))
   .and(Patient.BIRTHDATE.after().day(&quot;2011-01-01&quot;))
   .include(Patient.INCLUDE_MANAGINGORGANIZATION)
   .sort().ascending(Patient.BIRTHDATE)
   .sort().descending(Patient.NAME)
   .limitTo(123)
   .execute();
</pre></div>

				</div>
<div class="section">
<h4><a name="Search_-_Using_HTTP_POST_or_GET_with__search"></a>Search - Using HTTP POST or GET with _search</h4>
				
<p>
					The FHIR specification allows several styles of search (HTTP POST, a GET with _search at the end of the URL, etc.)
					The <tt>usingStyle()</tt> method controls which style to use. By default, GET style is used
					unless the client detects that the request would result in a very long URL (over 8000 chars) in which
					case the client automatically switches to POST.
				</p>
				
					
					
				
<div class="source">
<pre>response = client.search()
   .forResource(&quot;Patient&quot;)
   .where(Patient.NAME.matches().value(&quot;Tester&quot;))
   .usingStyle(SearchStyleEnum.POST)
   .execute();
</pre></div>
				
			</div></div>			

			
<div class="section">
<h3><a name="Type_-_Create"></a>Type - Create</h3>
				
<p>
					The following example shows how to perform a create
					operation using the generic client:
				</p>
				
					
					
				
<div class="source">
<pre>Patient patient = new Patient();
// ..populate the patient object..
patient.addIdentifier(&quot;urn:system&quot;, &quot;12345&quot;);
patient.addName().addFamily(&quot;Smith&quot;).addGiven(&quot;John&quot;);

// Invoke the server create method (and send pretty-printed JSON encoding to the server
// instead of the default which is non-pretty printed XML)
client.create()
   .resource(patient)
   .prettyPrint()
   .encodedJson()
   .execute();
</pre></div>
			</div>			

			
<div class="section">
<h3><a name="Instance_-_Delete"></a>Instance - Delete</h3>
				
<p>
					The following example shows how to perform a delete
					operation using the generic client:
				</p>
				
					
					
				
<div class="source">
<pre>// Retrieve the server's conformance statement and print its description
OperationOutcome outcome = client.delete()
   .resourceById(new IdDt(&quot;Patient&quot;, &quot;1234&quot;))
   .execute();

// outcome may be null if the server didn't return one
if (outcome != null) {
   System.out.println(outcome.getIssueFirstRep().getDetails().getValue());
}
</pre></div>
			</div>			

			
<div class="section">
<h3><a name="Instance_-_Update"></a>Instance - Update</h3>
				
<p>
					Updating a resource is similar to creating one, except that
					an ID must be supplied since you are updating a previously
					existing resource instance.
				</p>
				
<p>
					The following example shows how to perform an update
					operation using the generic client:
				</p>
				
					
					
				
<div class="source">
<pre>Patient patient = new Patient();
// ..populate the patient object..
patient.addIdentifier(&quot;urn:system&quot;, &quot;12345&quot;);
patient.addName().addFamily(&quot;Smith&quot;).addGiven(&quot;John&quot;);

// To update a resource, it should have an ID set (if the resource object
// comes from the results of a previous read or search, it will already
// have one though) 
patient.setId(&quot;Patient/123&quot;);

// Invoke the server create method (and send pretty-printed JSON encoding to the server
// instead of the default which is non-pretty printed XML)
client.update()
   .resource(patient)
   .execute();
</pre></div>
			</div>			

			
<div class="section">
<h3><a name="Server_-_Conformance"></a>Server - Conformance</h3>
				
<p>
					To retrieve the server's conformance statement, simply call the <tt>conformance()</tt>
					method as shown below.
				</p>
				
					
					
				
<div class="source">
<pre>// Retrieve the server's conformance statement and print its description
Conformance conf = client.conformance();
System.out.println(conf.getDescription().getValue());
</pre></div>
			</div>			
			
			
<div class="section">
<h3><a name="Server_-_Transaction"></a>Server - Transaction</h3>
				
<p>
					The following example shows how to execute a transaction using the generic client:
				</p>
				
					
					
				
<div class="source">
<pre>List&lt;IResource&gt; resources = new ArrayList&lt;IResource&gt;();
// .. populate this list - note that you can also pass in a populated Bundle if you want to create one manually ..

List&lt;IResource&gt; response = client.transaction()
  .withResources(resources)
  .execute();
</pre></div>
			</div>			
			
		</div>
		
		
<div class="section">
<h2><a name="The_Annotation-Driven_Client"></a>The Annotation-Driven Client</h2>

			
<p>
				HAPI also provides a second style of client, called the <b>annotation-driven</b> client.
			</p>

			
<p>
				The design of the annotation-driven client
				is intended to be similar to that of
				JAX-WS, so users of that
				specification should be comfortable with
				this one. It uses a user-defined interface containing special
				annotated methods which HAPI binds to calls against a server.
			</p>

			
<p>
				The annotation-driven client is particularly useful if you have a server that
				exposes a set of specific operations (search parameter combinations, named queries, etc.)
				and you want to let developers have a stongly/statically typed interface to that
				server.
			</p>
			
<p>
				There is no difference in terms of capability between the two styles of 
				client. There is simply a difference in programming style and complexity. It
				is probably safe to say that the generic client is easier to use and leads to
				more readable code, at the expense of not giving any visibility into the 
				specific capabilities of the server you are interacting with.  
			</p>
			
			
<div class="section">
<h3><a name="Defining_A_Restful_Client_Interface"></a>Defining A Restful Client Interface</h3>

				
<p>
					The first step in creating an annotation-driven client is to define a
					restful client interface.
				</p>

				
<p>
					A restful client interface class must extend the
					<a href="./apidocs/ca/uhn/fhir/rest/client/api/IRestfulClient.html">IRestfulClient</a>
					interface,
					and will contain one or more methods which have been
					annotated with special annotations indicating which RESTful
					operation
					that method supports. Below is a simple example of a
					resource provider
					which supports the
					<a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#read">read</a>
					operation (i.e. retrieve a single resource by ID) as well as the
					<a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#search">search</a>
					operation (i.e. find any resources matching a given criteria) for a
					specific
					search criteria.
				</p>

				
<p>
					You may notice that this interface looks a lot like the Resource
					Provider
					which is defined for use by the RESTful server. In fact, it
					supports all
					of the same annotations and is essentially identical,
					other than the
					fact that for a client you must use an interface but for a server you
					must use a concrete class with method implementations.
				</p>

				
					
					
				
<div class="source">
<pre>/**
 * All RESTful clients must be an interface which extends IBasicClient
 */
public interface IRestfulClient extends IBasicClient {

	/**
	 * The &quot;@Read&quot; annotation indicates that this method supports the
	 * read operation. Read operations should return a single resource
	 * instance. 
	 * 
	 * @param theId
	 *    The read operation takes one parameter, which must be of type
	 *    IdDt and must be annotated with the &quot;@Read.IdParam&quot; annotation.
	 * @return 
	 *    Returns a resource matching this identifier, or null if none exists.
	 */
	@Read()
	public Patient getResourceById(@IdParam IdDt theId);

	/**
	 * The &quot;@Search&quot; annotation indicates that this method supports the 
	 * search operation. You may have many different method annotated with 
	 * this annotation, to support many different search criteria. This
	 * example searches by family name.
	 * 
	 * @param theIdentifier
	 *    This operation takes one parameter which is the search criteria. It is
	 *    annotated with the &quot;@Required&quot; annotation. This annotation takes one argument,
	 *    a string containing the name of the search criteria. The datatype here
	 *    is StringDt, but there are other possible parameter types depending on the
	 *    specific search criteria.
	 * @return
	 *    This method returns a list of Patients. This list may contain multiple
	 *    matching resources, or it may also be empty.
	 */
	@Search()
	public List&lt;Patient&gt; getPatient(@RequiredParam(name = Patient.SP_FAMILY) StringDt theFamilyName);

}
</pre></div>

				
<p>
					You will probably want to add more methods
					to your client interface.
					See
					<a href="./doc_rest_operations.html">RESTful Operations</a>
					for
					lots more examples of how to add methods for various operations.
				</p>

			</div>

			
<div class="section">
<h3><a name="Instantiate_the_Client"></a>Instantiate the Client</h3>

				
<p>
					Once your client interface is created, all that is left is to
					create a FhirContext and instantiate the client and you are
					ready to
					start using it.
				</p>

				
					
					
				
<div class="source">
<pre>public static void main(String[] args) {
   FhirContext ctx = new FhirContext();
   String serverBase = &quot;http://foo.com/fhirServerBase&quot;;
   
   // Create the client
   IRestfulClient client = ctx.newRestfulClient(IRestfulClient.class, serverBase);
   
   // Try the client out! This method will invoke the server
   List&lt;Patient&gt; patients = client.getPatient(new StringDt(&quot;SMITH&quot;));
   
}
</pre></div>

			</div>

			
<div class="section">
<h3><a name="Configuring_Encoding_JSONXML"></a>Configuring Encoding (JSON/XML)</h3>

				
<p>
					Restful client interfaces that you create will also extend
					the interface 
					<a href="./apidocs/ca/uhn/fhir/rest/client/api/IRestfulClient.html">IRestfulClient</a>,
					which comes with some helpful methods for configuring the way that
					the client will interact with the server.
				</p>
				
<p>
					The following snippet shows how to configure the cliet to explicitly 
					request JSON or XML responses, and how to request &quot;pretty printed&quot; responses
					on servers that support this (HAPI based servers currently).				
				</p>
				
				
					
					
				
<div class="source">
<pre>         // Create a client
         FhirContext ctx = new FhirContext();
         IPatientClient client = ctx.newRestfulClient(IPatientClient.class, &quot;http://localhost:9999/&quot;);

         // Request JSON encoding from the server (_format=json)
         client.setEncoding(EncodingEnum.JSON);

         // Request pretty printing from the server (_pretty=true)
         client.setPrettyPrint(true);
</pre></div>

			</div>
			
			
<div class="section">
<h3><a name="A_Complete_Example"></a>A Complete Example</h3>
	
				
<p>
					The following is a complete example showing a RESTful client
					using
					HAPI FHIR.
				</p>
	
				
					
					
				
<div class="source">
<pre>import java.io.IOException;
import java.util.List;

import ca.uhn.fhir.context.FhirContext;
import ca.uhn.fhir.model.dstu.composite.IdentifierDt;
import ca.uhn.fhir.model.dstu.composite.ResourceReferenceDt;
import ca.uhn.fhir.model.dstu.resource.Organization;
import ca.uhn.fhir.model.dstu.resource.Patient;
import ca.uhn.fhir.rest.annotation.RequiredParam;
import ca.uhn.fhir.rest.annotation.Search;
import ca.uhn.fhir.rest.client.api.IRestfulClient;

public class CompleteExampleClient {

   /**
    * This is a simple client interface. It can have many methods for various
    * searches but in this case it has only 1.
    */
   public static interface ClientInterface extends IRestfulClient {

      /**
       * This is translated into a URL similar to the following:
       * http://fhir.healthintersections.com.au/open/Patient?identifier=urn:oid:1.2.36.146.595.217.0.1%7C12345
       */
      @Search
      List&lt;Patient&gt; findPatientsForMrn(@RequiredParam(name = Patient.SP_IDENTIFIER) IdentifierDt theIdentifier);

   }

   /**
    * The main method here will directly call an open FHIR server and retrieve a
    * list of resources matching a given criteria, then load a linked resource.
    */
   public static void main(String[] args) throws IOException {

      // Create a client factory
      FhirContext ctx = new FhirContext();

      // Create the client
      String serverBase = &quot;http://fhir.healthintersections.com.au/open&quot;;
      ClientInterface client = ctx.newRestfulClient(ClientInterface.class, serverBase);

      // Invoke the client to search for patient
      List&lt;Patient&gt; patients = client.findPatientsForMrn(new IdentifierDt(&quot;urn:oid:1.2.36.146.595.217.0.1&quot;, &quot;12345&quot;));

      System.out.println(&quot;Found &quot; + patients.size() + &quot; patients&quot;);

      // Print a value from the loaded resource
      Patient patient = patients.get(0);
      System.out.println(&quot;Patient Last Name: &quot; + patient.getName().get(0).getFamily().get(0).getValue());

      // Load a referenced resource
      ResourceReferenceDt managingRef = patient.getManagingOrganization();
      Organization org = (Organization) managingRef.loadResource(client);

      // Print organization name
      System.out.println(org.getName().getValue());

   }

}
</pre></div>
				
			</div>
			
		</div>

		
<div class="section">
<h2><a name="Configuring_the_Client"></a>Configuring the Client</h2>

			
<p>
				RESTful clients (both Generic and Annotation-Driven) use 
				<a class="externalLink" href="http://hc.apache.org/httpcomponents-client-ga/">Apache HTTP Client</a>
				as a provider. The Apache HTTP Client is very powerful and extremely flexible, 
				but can be confusing at first to configure, because of the low-level approach that
				the library uses. 
			</p>

			
<p>
				In many cases, the default configuration should suffice. However, if you require anything
				more sophisticated (username/password, HTTP proxy settings, etc.) you will need
				to configure the underlying client. 
			</p>
			
			
<p>
				The underlying client configuration is provided by accessing the
				<a href="./apidocs/ca/uhn/fhir/rest/client/IRestfulClientFactory.html">IRestfulClientFactory</a>
				class from the FhirContext.
			</p>

			
<div class="section">
<h3><a name="Interceptors"></a>Interceptors</h3>
			
				
<p>
					Both generic clients and annotation-driven clients support
					<a href="./apidocs/ca/uhn/fhir/rest/client/IClientInterceptor.html">Client Interceptors</a>,
					which may be registered in order to provide specific behaviour to each
					client request.
				</p>
				
				
<p>
					The following section shows some sample interceptors which may be used.
				</p>
			
			</div>

			
<div class="section">
<h3><a name="HTTP_Basic_Authorization"></a>HTTP Basic Authorization</h3>

				
<p>
					The following example shows how to configure your client to
					use a specific username and password in every request.
				</p>

				
					
					
				
<div class="source">
<pre>      // Create a context and get the client factory so it can be configured
      FhirContext ctx = new FhirContext();
      IRestfulClientFactory clientFactory = ctx.getRestfulClientFactory();

      // Create an HTTP basic auth interceptor
      String username = &quot;foobar&quot;;
      String password = &quot;boobear&quot;;
      BasicAuthInterceptor authInterceptor = new BasicAuthInterceptor(username, password);

      // Register the interceptor with your client (either style)
      IPatientClient annotationClient = ctx.newRestfulClient(IPatientClient.class, &quot;http://localhost:9999/fhir&quot;);
      annotationClient.registerInterceptor(authInterceptor);

      IGenericClient genericClient = ctx.newRestfulGenericClient(&quot;http://localhost:9999/fhir&quot;);
      annotationClient.registerInterceptor(authInterceptor);
</pre></div>

			</div>

			<a name="req_resp_logging"></a>
			
<div class="section">
<h3><a name="Logging_Requests_and_Responses"></a>Logging Requests and Responses</h3>

				
<p>
					An interceptor is provided with HAPI FHIR which can be used to
					log every transaction. The interceptor can be configured to be extremely
					verbose (logging entire transactions including HTTP headers and payload bodies) 
					or simply to log request URLs.
				</p>

				
					
					
				
<div class="source">
<pre>         // Create a context and get the client factory so it can be configured
         FhirContext ctx = new FhirContext();
         IRestfulClientFactory clientFactory = ctx.getRestfulClientFactory();

         // Create a logging interceptor
         LoggingInterceptor loggingInterceptor = new LoggingInterceptor();

         // Optionally you may configure the interceptor (by default only
         // summary info is logged)
         loggingInterceptor.setLogRequestSummary(true);
         loggingInterceptor.setLogRequestBody(true);

         // Register the interceptor with your client (either style)
         IPatientClient annotationClient = ctx.newRestfulClient(IPatientClient.class, &quot;http://localhost:9999/fhir&quot;);
         annotationClient.registerInterceptor(loggingInterceptor);

         IGenericClient genericClient = ctx.newRestfulGenericClient(&quot;http://localhost:9999/fhir&quot;);
         genericClient.registerInterceptor(loggingInterceptor);
</pre></div>

			</div>

			
<div class="section">
<h3><a name="Configuring_an_HTTP_Proxy"></a>Configuring an HTTP Proxy</h3>
			
				
<p>
					An HTTP proxy may be configured directly on the 
					restful client factory, as shown below.
				</p>
				
				
					
					
				
<div class="source">
<pre>         // Create a context and get the client factory so it can be configured
         FhirContext ctx = new FhirContext();
         IRestfulClientFactory clientFactory = ctx.getRestfulClientFactory();

         // Create a logging interceptor
         LoggingInterceptor loggingInterceptor = new LoggingInterceptor();

         // Optionally you may configure the interceptor (by default only
         // summary info is logged)
         loggingInterceptor.setLogRequestSummary(true);
         loggingInterceptor.setLogRequestBody(true);

         // Register the interceptor with your client (either style)
         IPatientClient annotationClient = ctx.newRestfulClient(IPatientClient.class, &quot;http://localhost:9999/fhir&quot;);
         annotationClient.registerInterceptor(loggingInterceptor);

         IGenericClient genericClient = ctx.newRestfulGenericClient(&quot;http://localhost:9999/fhir&quot;);
         genericClient.registerInterceptor(loggingInterceptor);
</pre></div>
			
			</div>

		</div>

	


                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2014
                        <a href="http://www.uhn.ca">University Health Network</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        <script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>
                </body >
</html>