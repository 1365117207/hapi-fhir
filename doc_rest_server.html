<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-08-16 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="James Agnew" />
    <meta name="Date-Revision-yyyymmdd" content="20140816" />
    <meta http-equiv="Content-Language" content="en" />
    <title>HAPI &#x2013; RESTful Server - HAPI FHIR</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

                          
        
<script src="syntaxhighlighter/shCore.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushJScript.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushJava.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushBash.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushXml.js" type="text/javascript"></script>
                      
        
<link rel="stylesheet" type="text/css" href="syntaxhighlighter/shCore.css"/>
                      
        
<link rel="stylesheet" type="text/css" href="syntaxhighlighter/shThemeDefault.css"/>
                      
        
<link rel="shortcut icon" href="http://hl7api.sourceforge.net/images/favicon.png"/>
                      
        
<link rel="stylesheet" type="text/css" href="hapi.css"/>
          
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://hl7api.sourceforge.net/hapi-fhir/" id="bannerLeft">
                                                                                                <img src="images/hapi_fhir_banner.png"  alt="HAPI"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="http://hl7api.sourceforge.net/hapi-fhir/" id="bannerRight">
                                                                                                <img src="images/hapi_fhir_banner_right.png"  alt="FHIR"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-08-16
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 0.6-SNAPSHOT
                      </li>
                      
                
                    
      
                                    
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://www.uhn.ca/" class="externalLink" title="University Health Network">
        University Health Network</a>
      </li>

  
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://hl7.org/" class="externalLink" title="hl7.org">
        hl7.org</a>
      </li>

  
    <li class="pull-right">
                      <a href="https://github.com/jamesagnew/hapi-fhir/" class="externalLink" title="GitHub Page">
        GitHub Page</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Welcome</li>
                              
      <li>
  
                          <a href="index.html" title="Welcome">
          <i class="none"></i>
        Welcome</a>
            </li>
                
      <li>
  
                          <a href="download.html" title="Download">
          <i class="none"></i>
        Download</a>
            </li>
                
      <li>
  
                          <a href="doc_upgrading.html" title="Upgrade Guide">
          <i class="none"></i>
        Upgrade Guide</a>
            </li>
                
      <li>
  
                          <a href="changes-report.html" title="Changelog">
          <i class="none"></i>
        Changelog</a>
            </li>
                              <li class="nav-header">Test Server</li>
                              
      <li>
  
                          <a href="http://fhirtest.uhn.ca" class="externalLink" title="Public Test Server">
          <i class="none"></i>
        Public Test Server</a>
            </li>
                              <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="doc_intro.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                                                                                                
      <li>
  
                          <a href="doc_fhirobjects.html" title="The Data Model">
          <i class="icon-chevron-down"></i>
        The Data Model</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="doc_extensions.html" title="Extensions">
          <i class="none"></i>
        Extensions</a>
            </li>
                    
      <li>
  
                          <a href="doc_resource_references.html" title="Resource References">
          <i class="none"></i>
        Resource References</a>
            </li>
                    
      <li>
  
                          <a href="doc_tags.html" title="Tags">
          <i class="none"></i>
        Tags</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="doc_rest_client.html" title="RESTful Client">
          <i class="none"></i>
        RESTful Client</a>
            </li>
                                                                                                                      
      <li class="active">
  
            <a href="#"><i class="icon-chevron-down"></i>RESTful Server</a>
                  <ul class="nav nav-list">
                    
      <li>
  
                          <a href="doc_rest_operations.html" title="RESTful Operations">
          <i class="none"></i>
        RESTful Operations</a>
            </li>
                    
      <li>
  
                          <a href="doc_narrative.html" title="Narrative Generator">
          <i class="none"></i>
        Narrative Generator</a>
            </li>
                    
      <li>
  
                          <a href="doc_cors.html" title="CORS Support">
          <i class="none"></i>
        CORS Support</a>
            </li>
                    
      <li>
  
                          <a href="doc_server_tester.html" title="Web Testing UI">
          <i class="none"></i>
        Web Testing UI</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="doc_logging.html" title="Logging">
          <i class="none"></i>
        Logging</a>
            </li>
                
      <li>
  
                          <a href="doc_tinder.html" title="Tinder Plugin">
          <i class="none"></i>
        Tinder Plugin</a>
            </li>
                              <li class="nav-header">Community</li>
                              
      <li>
  
                          <a href="https://groups.google.com/d/forum/hapi-fhir" class="externalLink" title="Google Group">
          <i class="none"></i>
        Google Group</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/jamesagnew/hapi-fhir/issues" class="externalLink" title="Issue Tracker">
          <i class="none"></i>
        Issue Tracker</a>
            </li>
                              <li class="nav-header">JavaDocs</li>
                              
      <li>
  
                          <a href="apidocs/index.html" title="API Documentation">
          <i class="none"></i>
        API Documentation</a>
            </li>
                
      <li>
  
                          <a href="xref/index.html" title="JXR">
          <i class="none"></i>
        JXR</a>
            </li>
                              <li class="nav-header">Reports</li>
                              
      <li>
  
                          <a href="team-list.html" title="Developers">
          <i class="none"></i>
        Developers</a>
            </li>
                
      <li>
  
                          <a href="surefire-report.html" title="Unit Test Report">
          <i class="none"></i>
        Unit Test Report</a>
            </li>
                
      <li>
  
                          <a href="findbugs.html" title="FindBugs">
          <i class="none"></i>
        FindBugs</a>
            </li>
                
      <li>
  
                          <a href="license.html" title="License">
          <i class="none"></i>
        License</a>
            </li>
                
      <li>
  
                          <a href="http://sourceforge.net/p/hl7api/fhircode/ci/master/tree/" class="externalLink" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="jamesagnew.github.io/hapi-fhir/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="https://sourceforge.net/projects/hl7api/" title="Hosted on SourceForge.net" class="builtBy">
        <img class="builtBy"  alt="Hosted on SourceForge.net" src="http://sflogo.sourceforge.net/sflogo.php?group_id=38899&type=2"    />
      </a>
                                                                                                          <a href="http://maven.apache.org" title="Built with Maven 2" class="builtBy">
        <img class="builtBy"  alt="Built with Maven 2" src="images/logos/maven-feather.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            

	

		<!-- The body of the document contains a number of sections -->
		<div class="section">
<h2><a name="Creating_a_RESTful_Server"></a>Creating a RESTful Server</h2>
			
			
			
<ul>
<li><a href="#Creating_a_RESTful_Server">Creating a RESTful Server</a>
<ul>
<li><a href="#Defining_Resource_Providers">Defining Resource Providers</a></li>
<li><a href="#Adding_more_Methods_Search_History_Create_etc.">Adding more Methods (Search, History, Create, etc.)</a></li>
<li><a href="#Create_a_Server">Create a Server</a></li>
<li><a href="#Plain_Providers_non-resource_specific">Plain Providers (non-resource specific)</a></li>
<li><a href="#Deploy">Deploy</a></li></ul></li>
<li><a href="#ConformanceMetadata_Statement">Conformance/Metadata Statement</a>
<ul>
<li><a href="#Enhancing_the_Generated_Conformance_Statement">Enhancing the Generated Conformance Statement</a></li></ul></li>
<li><a href="#Paging_Responses">Paging Responses</a>
<ul>
<li><a href="#Paging_Providers">Paging Providers</a></li>
<li><a href="#Bundle_Providers">Bundle Providers</a></li></ul></li>
<li><a href="#Common_Method_Parameters">Common Method Parameters</a>
<ul>
<li><a href="#Accessing_the_underlying_Servlet_RequestResponse">Accessing the underlying Servlet Request/Response</a></li></ul></li>
<li><a href="#Using_the_Server">Using the Server</a></li>
<li><a href="#Populating_Resource_Metadata">Populating Resource Metadata</a></li>
<li><a href="#A_Complete_Example">A Complete Example</a></li></ul>
			
			
<p>
				HAPI provides a built-in mechanism for adding FHIR's RESTful Server
				capabilities to your applications. The HAPI RESTful Server is Servlet
				based, so it should be easy to deploy to any of the many compliant
				containers that exist.					
			</p>

			
<p>
				Setup is mostly done using simple annotations, which means that it should
				be possible to create a FHIR compliant server quickly and easily.
			</p>
			
			<a name="resource_providers"></a>
			
<div class="section">
<h3><a name="Defining_Resource_Providers"></a>Defining Resource Providers</h3>
			
				
<p>
					The first step in creating a FHIR RESTful Server is to define one or
					more resource providers. A resource provider is a class which is 
					able to supply exactly one type of resource to be served up.
				</p>
				
				
<p>
					For example, if you wish to allow your server to serve up Patient, 
					Observation and Location resources, you will need three resource
					providers.
				</p>
				
				
<p>
					A Resource provider class must implement the 
					<a href="./apidocs/ca/uhn/fhir/rest/server/IResourceProvider.html">IResourceProvider</a> interface,
					and will contain one or more methods which have been
					annotated with special annotations indicating which RESTful operation
					that method supports. Below is a simple example of a resource provider
					which supports the
					<a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#read">read</a>
					operation (i.e. retrieve a single resource by ID) as well as the
					<a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#search">search</a>
					operation (i.e. find any resources matching a given criteria) for a specific
					search criteria.
				</p>
				
				
					
					
				
<div class="source">
<pre>/**
 * All resource providers must implement IResourceProvider
 */
public class RestfulPatientResourceProvider implements IResourceProvider {

	/**
	 * The getResourceType method comes from IResourceProvider, and must
	 * be overridden to indicate what type of resource this provider
	 * supplies.
	 */
	@Override
	public Class&lt;Patient&gt; getResourceType() {
		return Patient.class;
	}
	
	/**
	 * The &quot;@Read&quot; annotation indicates that this method supports the
	 * read operation. Read operations should return a single resource
	 * instance. 
	 * 
	 * @param theId
	 *    The read operation takes one parameter, which must be of type
	 *    IdDt and must be annotated with the &quot;@Read.IdParam&quot; annotation.
	 * @return 
	 *    Returns a resource matching this identifier, or null if none exists.
	 */
	@Read()
	public Patient getResourceById(@IdParam IdDt theId) {
		Patient patient = new Patient();
		patient.addIdentifier();
		patient.getIdentifier().get(0).setSystem(new UriDt(&quot;urn:hapitest:mrns&quot;));
		patient.getIdentifier().get(0).setValue(&quot;00002&quot;);
		patient.addName().addFamily(&quot;Test&quot;);
		patient.getName().get(0).addGiven(&quot;PatientOne&quot;);
		patient.setGender(AdministrativeGenderCodesEnum.F);
		return patient;
	}

	/**
	 * The &quot;@Search&quot; annotation indicates that this method supports the 
	 * search operation. You may have many different method annotated with 
	 * this annotation, to support many different search criteria. This
	 * example searches by family name.
	 * 
	 * @param theIdentifier
	 *    This operation takes one parameter which is the search criteria. It is
	 *    annotated with the &quot;@Required&quot; annotation. This annotation takes one argument,
	 *    a string containing the name of the search criteria. The datatype here
	 *    is StringDt, but there are other possible parameter types depending on the
	 *    specific search criteria.
	 * @return
	 *    This method returns a list of Patients. This list may contain multiple
	 *    matching resources, or it may also be empty.
	 */
	@Search()
	public List&lt;Patient&gt; getPatient(@RequiredParam(name = Patient.SP_FAMILY) StringDt theFamilyName) {
		Patient patient = new Patient();
		patient.addIdentifier();
		patient.getIdentifier().get(0).setUse(IdentifierUseEnum.OFFICIAL);
		patient.getIdentifier().get(0).setSystem(new UriDt(&quot;urn:hapitest:mrns&quot;));
		patient.getIdentifier().get(0).setValue(&quot;00001&quot;);
		patient.addName();
		patient.getName().get(0).addFamily(theFamilyName.getValue());
		patient.getName().get(0).addGiven(&quot;PatientOne&quot;);
		patient.getGender().setText(&quot;M&quot;);
		return Collections.singletonList(patient);
	}

}
</pre></div>

			</div>
			
<div class="section">
<h3><a name="Adding_more_Methods_Search_History_Create_etc."></a>Adding more Methods (Search, History, Create, etc.)</h3>

				
<p>
					You will probably wish to add more methods
					to your resource provider. See
					<a href="./doc_rest_operations.html">RESTful Operations</a> for
					lots more examples of how to add methods for various operations.
				</p>

			</div>

			
<div class="section">
<h3><a name="Create_a_Server"></a>Create a Server</h3>
			
				
<p>
					Once your resource providers are created, your next step is to
					define a server class. 
				</p>
				
				
<p>
					HAPI provides a class called
					<a href="./apidocs/ca/uhn/fhir/rest/server/RestfulServer.html">RestfulServer</a>, which
					is a specialized Java Servlet. To create a server, you simply create a class
					which extends RestfulServer as shown in the example below.
				</p>
				
				
					
					
				
<div class="source">
<pre>/**
 * In this example, we are using Servlet 3.0 annotations to define
 * the URL pattern for this servlet, but we could also
 * define this in a web.xml file.
 */
@WebServlet(urlPatterns= {&quot;/fhir/*&quot;}, displayName=&quot;FHIR Server&quot;)
public class ExampleRestfulServlet extends RestfulServer {

	private static final long serialVersionUID = 1L;

	/**
	 * Constructor
	 */
	public ExampleRestfulServlet() {
		/*
		 * The servlet defines any number of resource providers, and
		 * configures itself to use them by calling
		 * setResourceProviders()
		 */
		List&lt;IResourceProvider&gt; resourceProviders = new ArrayList&lt;IResourceProvider&gt;();
		resourceProviders.add(new RestfulPatientResourceProvider());
		resourceProviders.add(new RestfulObservationResourceProvider());
		setResourceProviders(resourceProviders);
	}
	
}
</pre></div>

				<a name="plain_providers"></a>
			</div>	
			
			<!-- NB there is an anchor for this section above -->
			
<div class="section">
<h3><a name="Plain_Providers_non-resource_specific"></a>Plain Providers (non-resource specific)</h3>
			
				
<p>
					Defining one provider per resource is a good strategy to keep 
					code readable and maintainable, but it is also possible to put
					methods for multiple resource types in a provider class. Providers
					which do not implement the 
					<a href="./apidocs/ca/uhn/fhir/rest/server/IResourceProvider.html">IResourceProvider</a> 
					(and therefore are not bound to one specific resource type) are known as
					<b>Plain Providers</b>.
				</p>
				
<p>
					A plain provider may implement any 
					<a href="./doc_rest_operations.html">RESTful operation</a>, but will generally
					need to explicitly state what type of resource it applies to. If the method directly
					returns a resource or a collection of resources (as in an 
					<a href="./doc_rest_operations.html#instance_read">instance read</a> or
					<a href="./doc_rest_operations.html#type_search">type search</a> operation)
					the resource type will be inferred automatically. If the method returns a
					<a href="./apidocs/ca/uhn/fhir/model/api/Bundle.html">Bundle</a>
					resource, it is necessary to explicitly specify the resource type
					in the method annotation. The following example shows this:
				</p>
				
					
					
				
<div class="source">
<pre>public class PlainProvider {

  /**
   * This method is a Patient search, but HAPI can not automatically
   * determine the resource type so it must be explicitly stated.
   */
  @Search(type=Patient.class)
  public Bundle searchForPatients(@RequiredParam(name=&quot;name&quot;) StringDt theName) {
    Bundle retVal = new Bundle();
    // perform search
    return retVal;
  }	
	
}
</pre></div>
			
				
<p>
					In addition, some methods are not resource specific. For example, the 
					<a href="./doc_rest_operations.html#history">system history</a> operation
					returns historical versions of <b>all resource types</b> on a server,
					so it needs to be defined in a plain provider.
				</p>
							
				
<p>
					Once you have defined your resource providers, they are passed to the 
					server in a similar way to the resource providers.
				</p>
				
					
					
				
<div class="source">
<pre>public class ExampleServlet extends RestfulServer {

  public ExampleServlet() {
    /*
     * Plain providers are passed to the server in the same way
     * as resource providers. You may pass both resource providers
     * and and plain providers to the same server if you like. 
     */
    List&lt;Object&gt; plainProviders=new ArrayList&lt;Object&gt;();
    plainProviders.add(new PlainProvider());
    setPlainProviders(plainProviders);
    
    List&lt;IResourceProvider&gt; resourceProviders = new ArrayList&lt;IResourceProvider&gt;();
    // ...add some resource providers...
    setResourceProviders(resourceProviders);
  }
	
}
</pre></div>
			
			</div>
			
			
<div class="section">
<h3><a name="Deploy"></a>Deploy</h3>
				
				
<p>
					Once you have created your resource providers and your restful server class,
					you can bundle these into a WAR file and you are ready to deploy to 
					any JEE container (Tomcat, Websphere, Glassfish, etc).
				</p>

				
<p>
					Bundling a servlet into a WAR file and deploying it to an application server
					is beyond the scope of this page, but there are many good tutorials on how
					to do this.
				</p>
			
			</div>
					
		</div>

		
<div class="section">
<h2><a name="ConformanceMetadata_Statement"></a>Conformance/Metadata Statement</h2>
		
			
<p>
				The HAPI FHIR RESTful Server will automatically export a 
				<a class="externalLink" href="http://hl7.org/implement/standards/fhir/conformance.html">conformance statement</a>, 
				as required by the
				<a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#conformance">FHIR Specification</a>.
			</p>
			
<p>
				This statement is automatically generated based on the various annotated methods which are 
				provided to	the server. This behaviour may be modified by creating a new class
				containing a method annotated with a
				<a href="doc_rest_operations.html#system_conformance">@Metadata Operation</a> 
				and then passing an instance of that class to the
				<a href="./apidocs/ca/uhn/fhir/rest/server/RestfulServer.html#setServerConformanceProviderjava.lang.Object">setServerConformanceProvider</a> method
				on your server.
			</p>
			
			
<div class="section">
<h3><a name="Enhancing_the_Generated_Conformance_Statement"></a>Enhancing the Generated Conformance Statement</h3>
			
				
<p>
					If you have a need to add your own content (special extensions, etc.) to your
					server's conformance statement, but still want to take advantage of HAPI's automatic
					conformance generation, you may wish to extend 
					<a class="externalLink" href="http://jamesagnew.github.io/hapi-fhir/apidocs/ca/uhn/fhir/rest/server/provider/ServerConformanceProvider.html">ServerConformanceProvider</a>.
				</p>

				
<p>
					In your own class extending this class, you can override the <tt>getServerConformance()</tt> method
					to provide your own implementation. In this method, call 
					<tt>super.getServerConformance()</tt> to obtain the built-in conformance statement and then
					add your own information to it.
				</p>
							
				
<p>
					Note that if you are adding items during each invocation you should be aware that by default the
					same instance is cached by ServerConformanceProvider. This can result in an ever-growing
					conformance statement. You must call <tt>setCache(false);</tt> in
					the constructor of your new conformance provider to avoid this behaviour.
				</p>
				
			</div>
			
		</div>

		
<div class="section">
<h2><a name="Paging_Responses"></a>Paging Responses</h2>
			
			
<p>
				The <b>Search</b> and <b>History</b> operations both return a bundle
				which contain zero or more resources. FHIR RESTful servers may optionaly
				support paging responses, meaning that (for example) if a search returns 500
				resources, the server can return a bundle containing only the first 20 and a link
				which will return the next 20, etc. 
			</p>
			
			
<p>
				By default, RESTful servers will not page, but will rather return all resources
				immediately in a single bundle. There are two complimentary parts to the paging support: paging
				prividers, and bundle providers. 
			</p>

			
<div class="section">
<h3><a name="Paging_Providers"></a>Paging Providers</h3>
			
				
<p>
					To support paging, a server must have an <tt>IPagingProvider</tt>
					implementation set. The paging provider is used to store resource
					return lists between incoming calls by clients.
				</p>
				
				
<p>
					A paging provider provides two key methods:
				</p>
				
<ul>
					
<li>
						<tt>storeResultList</tt>, which takes a bundle provider (see below)
						and stores it for later retrieval. This might be by simply keeping it
						in memory, but it might also store it on disk, in a database, etc. This
						method must return a textual ID which can be used to retrieve this
						list later.
					</li>
					
<li>
						<tt>retrieveResultList</tt>, which takes an ID obtained by a 
						previous call to <tt>storeResultList</tt> and returns the corresponding
						result list.
					</li>
				</ul> 
				
				
<p>
					Note that the IPagingProvider is intended to be simple and implementable and
					you are encouraged to provide your own implementations.
				</p>				

				
<p>
					The following example shows a server implementation with paging
					support.
				</p>
				
				
					
					
				
<div class="source">
<pre>public class PagingServer extends RestfulServer {

	public PagingServer() {
		
		/*
		 * Set the resource providers as always. Here we are using the paging
		 * provider from the example below, but it is not strictly neccesary
		 * to use a paging resource provider as well. If a normal resource 
		 * provider is used (one which returns List&lt;?&gt; instead of IBundleProvider)
		 * then the loaded resources will be stored by the IPagingProvider.
		 */
		setResourceProviders(new PagingPatientProvider());
		
		/*
		 * Set a paging provider. Here a simple in-memory implementation
		 * is used, but you may create your own. 
		 */
		FifoMemoryPagingProvider pp = new FifoMemoryPagingProvider(10);
		pp.setDefaultPageSize(10);
		pp.setMaximumPageSize(100);
		setPagingProvider(pp);
				
	}

}
</pre></div>
			
			</div>			
			
			
<div class="section">
<h3><a name="Bundle_Providers"></a>Bundle Providers</h3>

				
<p>
					If a server supports a paging provider, a further optimization is to
					also use a bundle provider. A bundle provider simply takes the place of
					the <tt>List&lt;IResource&gt;</tt> return type in your provider methods.				
				</p>
				
				
<p>
					When using a bundle provider however, the server will only request small sublists
					of resources as they are actually being returned. This allows servers to optimize
					by not loading all resources into memory until they are actually needed.
				</p>
				
				
<p>
					One implementation of a bundle provider is shown below. This provider example works
					by only keeping the resource IDs in memory, but there are other possible implementation
					strategies that would work as well.
				</p>
				
				
<p>
					Note that the IBundleProvider is intended to be simple and implementable and
					you are encouraged to provide your own implementations.
				</p>
				
				
					
					
				
<div class="source">
<pre>public class PagingPatientProvider implements IResourceProvider {

	/**
	 * Search for Patient resources matching a given family name 
	 */
	@Search
	public IBundleProvider search(@RequiredParam(name = Patient.SP_FAMILY) StringParam theFamily) {
		final InstantDt searchTime = InstantDt.withCurrentTime();
		final List&lt;String&gt; matchingResourceIds = findIdsByFamily(theFamily);

		return new IBundleProvider() {

			@Override
			public int size() {
				return matchingResourceIds.size();
			}

			@Override
			public List&lt;IResource&gt; getResources(int theFromIndex, int theToIndex) {
				int end = Math.max(theToIndex, matchingResourceIds.size() - 1);
				List&lt;String&gt; idsToReturn = matchingResourceIds.subList(theFromIndex, end);
				return loadResourcesByIds(idsToReturn);
			}

			@Override
			public InstantDt getPublished() {
				return searchTime;
			}
		};
	}

	/**
	 * Get a list of resource IDs which match a given family name
	 */
	private List&lt;String&gt; findIdsByFamily(StringParam theFamily) {
		// .. implement this search against the database ..
		return null;
	}

	/**
	 * Load a list of patient resources given their IDs
	 */
	private List&lt;IResource&gt; loadResourcesByIds(List&lt;String&gt; theFamily) {
		// .. implement this search against the database ..
		return null;
	}

	@Override
	public Class&lt;? extends IResource&gt; getResourceType() {
		return Patient.class;
	}

}
</pre></div>
			
			</div>
			
		</div>
			

		
<div class="section">
<h2><a name="Common_Method_Parameters"></a>Common Method Parameters</h2>
		
			
<p>
				Different RESTful methods will have different requirements
				in terms of the method parameters they require, as described
				in the <a href="./doc_rest_operations.html">RESTful Operations</a>
				page.
			</p>
		
			
<p>
				In addition, there are several parameters you may add
				in order to meet specific needs of your application.
			</p>
			
			
<div class="section">
<h3><a name="Accessing_the_underlying_Servlet_RequestResponse"></a>Accessing the underlying Servlet Request/Response</h3>
			
				
<p>
					In some cases, it may be useful to have access to the 
					underlying HttpServletRequest and/or HttpServletResponse
					objects. These may be added by simply adding one or both
					of these objects as method parameters.
				</p>
			
				
					
					
				
<div class="source">
<pre>@Search
public List&lt;Patient&gt; findPatients(
		@RequiredParam(name=&quot;foo&quot;) StringParam theParameter,
		HttpServletRequest theRequest, 
		HttpServletResponse theResponse) {
 List&lt;Patient&gt; retVal=new ArrayList&lt;Patient&gt;(); // populate this
 return retVal;
}
</pre></div>
			
			
			</div>
		
		</div>

		<!-- <section name="Security">
			
			<p>
				Naturally, security is a prime concern
			</p>
		
		</section> -->


		
<div class="section">
<h2><a name="Using_the_Server"></a>Using the Server</h2>
		
			
<p>
				Your RESTful server should now support the methods you have declared. Here are a
				few helpful tricks for interacting with the server:
			</p>
			
			
<p>
				<b>Pretty Printing:</b> The HAPI RESTful server supports a non-standard parameter called 
				<tt>_pretty</tt>, which can be used to request that responses be pretty-printed (indented for
				easy reading by humans) by setting the value to <tt>true</tt>. This can be useful in testing. An example URL for this might be:<br />
				<tt>http://example.com/fhir/Patient/_search?name=TESTING&amp;_pretty=true</tt>  
			</p>
		
		</div>
		
		
<div class="section">
<h2><a name="Populating_Resource_Metadata"></a>Populating Resource Metadata</h2>
		
			
<p>
				Server operations will often return a resource or a bundle of resources. These
				types will contain one or more resource instances, but also specify a set of 
				metadata describing that resource.   
			</p>
			
			
<p>
				For example, resources have a &quot;published&quot; and &quot;updated&quot; date, referring to 
				the date/time the resource was originally created and the date/time the 
				resource was last updated respectively. For operations which return a single
				resource, these values are returned via HTTP headers. For operations which
				return a bundle, these values are returned via elements within the 
				bundle's &quot;entry&quot; tag. 	
			</p>
			
			
<p>
				Bundles may also contain a set of links, such as an &quot;alternate&quot; link to
				a resource, or a &quot;search&quot; link.
			</p>
			
			
<p>
				Populating these metadata elements is done via the
				<tt><a class="externalLink" href="http://jamesagnew.github.io/hapi-fhir/apidocs/ca/uhn/fhir/model/api/IResource.html#getResourceMetadata()">IResource#getResourceMetadata()</a></tt>
				method. The following example shows how to set various metadata elements on 
				a resource being returned.
			</p>
			
				
				
			
<div class="source">
<pre>@Search
public List&lt;Patient&gt; getAllPatients() {
   ArrayList&lt;Patient&gt; retVal = new ArrayList&lt;Patient&gt;();
   
   // Create a patient to return
   Patient patient = new Patient();
   patient.setId(&quot;Patient/123&quot;);
   patient.addName().addFamily(&quot;Smith&quot;).addGiven(&quot;John&quot;);
   
   // Create a tag list and add it to the resource
   TagList tags = new TagList();
   tags.addTag(Tag.HL7_ORG_FHIR_TAG, &quot;http://foo/tag1.html&quot;, &quot;Some tag&quot;);
   tags.addTag(Tag.HL7_ORG_FHIR_TAG, &quot;http://foo/tag2.html&quot;, &quot;Another tag&quot;);
   ResourceMetadataKeyEnum.TAG_LIST.put(patient, tags);
   
   // Set some links (these can be provided as relative links or absolute)
   // and the server will convert to absolute as appropriate
   String linkAlternate = &quot;Patient/7736&quot;;
   ResourceMetadataKeyEnum.LINK_ALTERNATE.put(patient, linkAlternate);
   String linkSearch = &quot;Patient?name=smith&amp;name=john&quot;;
   ResourceMetadataKeyEnum.LINK_ALTERNATE.put(patient, linkSearch);
   
   // Set the published and updated dates
   InstantDt pubDate = new InstantDt(&quot;2011-02-22&quot;);
   ResourceMetadataKeyEnum.PUBLISHED.put(patient, pubDate);
   InstantDt updatedDate = new InstantDt(&quot;2014-07-12T11:22:27Z&quot;);
   ResourceMetadataKeyEnum.UPDATED.put(patient, updatedDate);
   
   // Set the resource title (note that if you are using HAPI's narrative
   // generation capability, the narrative generator will often create
   // useful titles automatically, and the server will create a default
   // title if none is provided)
   String title = &quot;Patient John SMITH&quot;;
   ResourceMetadataKeyEnum.TITLE.put(patient, title);
   
   return retVal;
}
</pre></div>
				
		</div>

		
<div class="section">
<h2><a name="A_Complete_Example"></a>A Complete Example</h2>
		
			
<p>
				A complete example showing how to implement a RESTful server can
				be found in our Git repo here:
				<a class="externalLink" href="http://sourceforge.net/p/hl7api/fhircode/ci/master/tree/restful-server-example/">http://sourceforge.net/p/hl7api/fhircode/ci/master/tree/restful-server-example/</a>
			</p>
			
			
<p>
				Hopefully this will be available as a separate download soon, but currently it may
				be used to demonstrate a fully working server project.
			</p>
			
		</div>
		
	


                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2014
                        <a href="http://www.uhn.ca">University Health Network</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        <script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>
                </body >
</html>