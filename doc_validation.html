<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-11-20 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="James Agnew" />
    <meta name="Date-Revision-yyyymmdd" content="20141120" />
    <meta http-equiv="Content-Language" content="en" />
    <title>HAPI &#x2013; Validation - HAPI FHIR</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

                          
        
<script src="syntaxhighlighter/shCore.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushJScript.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushJava.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushBash.js" type="text/javascript"></script>
                      
        
<script src="syntaxhighlighter/shBrushXml.js" type="text/javascript"></script>
                      
        
<link rel="stylesheet" type="text/css" href="syntaxhighlighter/shCore.css"/>
                      
        
<link rel="stylesheet" type="text/css" href="syntaxhighlighter/shThemeDefault.css"/>
                      
        
<link rel="shortcut icon" href="https://github.com/jamesagnew/hapi-fhir/images/favicon.png"/>
                      
        
<link rel="stylesheet" type="text/css" href="hapi.css"/>
          
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://jamesagnew.github.io/hapi-fhir/" id="bannerLeft">
                                                                                                <img src="images/hapi_fhir_banner.png"  alt="HAPI"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="http://jamesagnew.github.io/hapi-fhir/" id="bannerRight">
                                                                                                <img src="images/hapi_fhir_banner_right.png"  alt="FHIR"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-11-20
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 0.8-SNAPSHOT
                      </li>
                      
                
                    
      
                                    
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://www.uhn.ca/" class="externalLink" title="University Health Network">
        University Health Network</a>
      </li>

  
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://hl7.org/" class="externalLink" title="hl7.org">
        hl7.org</a>
      </li>

  
    <li class="pull-right">
                      <a href="https://github.com/jamesagnew/hapi-fhir/" class="externalLink" title="GitHub Page">
        GitHub Page</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Welcome</li>
                              
      <li>
  
                          <a href="index.html" title="Welcome">
          <i class="none"></i>
        Welcome</a>
            </li>
                
      <li>
  
                          <a href="download.html" title="Download">
          <i class="none"></i>
        Download</a>
            </li>
                
      <li>
  
                          <a href="doc_upgrading.html" title="Upgrade Guide">
          <i class="none"></i>
        Upgrade Guide</a>
            </li>
                
      <li>
  
                          <a href="changes-report.html" title="Changelog">
          <i class="none"></i>
        Changelog</a>
            </li>
                              <li class="nav-header">Test Server</li>
                              
      <li>
  
                          <a href="http://fhirtest.uhn.ca" class="externalLink" title="Public Test Server">
          <i class="none"></i>
        Public Test Server</a>
            </li>
                
      <li>
  
                          <a href="doc_vagrant.html" title="Vagrant (Private) Test Server">
          <i class="none"></i>
        Vagrant (Private) Test Server</a>
            </li>
                              <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="doc_intro.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                                                                                                                            
      <li>
  
                          <a href="doc_fhirobjects.html" title="The Data Model">
          <i class="icon-chevron-down"></i>
        The Data Model</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="doc_extensions.html" title="Profiles & Extensions">
          <i class="none"></i>
        Profiles & Extensions</a>
            </li>
                    
      <li>
  
                          <a href="doc_resource_references.html" title="Resource References">
          <i class="none"></i>
        Resource References</a>
            </li>
                    
      <li>
  
                          <a href="doc_tags.html" title="Tags">
          <i class="none"></i>
        Tags</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><i class="none"></i>Validation</a>
          </li>
              </ul>
        </li>
                                                            
      <li>
  
                          <a href="doc_rest_client.html" title="RESTful Client">
          <i class="icon-chevron-down"></i>
        RESTful Client</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="doc_rest_client_interceptor.html" title="Interceptors (client)">
          <i class="none"></i>
        Interceptors (client)</a>
            </li>
              </ul>
        </li>
                                                                                                                                    
      <li>
  
                          <a href="doc_rest_server.html" title="RESTful Server">
          <i class="icon-chevron-down"></i>
        RESTful Server</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="doc_rest_operations.html" title="RESTful Operations">
          <i class="none"></i>
        RESTful Operations</a>
            </li>
                    
      <li>
  
                          <a href="doc_narrative.html" title="Narrative Generator">
          <i class="none"></i>
        Narrative Generator</a>
            </li>
                    
      <li>
  
                          <a href="doc_cors.html" title="CORS Support">
          <i class="none"></i>
        CORS Support</a>
            </li>
                    
      <li>
  
                          <a href="doc_rest_server_interceptor.html" title="Interceptors (server)">
          <i class="none"></i>
        Interceptors (server)</a>
            </li>
                    
      <li>
  
                          <a href="doc_server_tester.html" title="Web Testing UI">
          <i class="none"></i>
        Web Testing UI</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="doc_logging.html" title="Logging">
          <i class="none"></i>
        Logging</a>
            </li>
                
      <li>
  
                          <a href="doc_tinder.html" title="Tinder Plugin">
          <i class="none"></i>
        Tinder Plugin</a>
            </li>
                              <li class="nav-header">Community</li>
                              
      <li>
  
                          <a href="https://groups.google.com/d/forum/hapi-fhir" class="externalLink" title="Google Group">
          <i class="none"></i>
        Google Group</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/jamesagnew/hapi-fhir/issues" class="externalLink" title="Issue Tracker">
          <i class="none"></i>
        Issue Tracker</a>
            </li>
                              <li class="nav-header">JavaDocs</li>
                              
      <li>
  
                          <a href="apidocs/index.html" title="Core API">
          <i class="none"></i>
        Core API</a>
            </li>
                
      <li>
  
                          <a href="apidocs-dstu/index.html" title="Model API (DSTU1)">
          <i class="none"></i>
        Model API (DSTU1)</a>
            </li>
                
      <li>
  
                          <a href="apidocs-dev/index.html" title="Model API (DEV)">
          <i class="none"></i>
        Model API (DEV)</a>
            </li>
                
      <li>
  
                          <a href=".https://github.com/jamesagnew/hapi-fhir" class="externalLink" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
                              <li class="nav-header">Reports</li>
                              
      <li>
  
                          <a href="team-list.html" title="Developers">
          <i class="none"></i>
        Developers</a>
            </li>
                
      <li>
  
                          <a href="surefire-report.html" title="Unit Test Report">
          <i class="none"></i>
        Unit Test Report</a>
            </li>
                
      <li>
  
                          <a href="findbugs.html" title="FindBugs">
          <i class="none"></i>
        FindBugs</a>
            </li>
                
      <li>
  
                          <a href="license.html" title="License">
          <i class="none"></i>
        License</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/jamesagnew/hapi-fhir" class="externalLink" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="hl7api.sourceforge.net/hapi-fhir/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                         <a href="https://github.com/jamesagnew/hapi-fhir" title="Hosted on GitHub" class="builtBy">
        <img class="builtBy"  alt="Hosted on GitHub" src="images/github-logo-mini.png"    />
      </a>
                                                                                                          <a href="http://maven.apache.org" title="Built with Maven 3" class="builtBy">
        <img class="builtBy"  alt="Built with Maven 3" src="images/maven-logo-mini.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            

	

		<!-- The body of the document contains a number of sections -->
		<div class="section">
<h2><a name="Resource_Validation"></a>Resource Validation</h2>

			
			
<ul>
<li><a href="#Resource_Validation">Resource Validation</a>
<ul>
<li><a href="#Background">Background</a></li>
<li><a href="#Preparation">Preparation</a></li>
<li><a href="#Validating_a_Resource">Validating a Resource</a></li>
<li><a href="#Validating_a_Set_of_Files">Validating a Set of Files</a></li></ul></li></ul>

			
<p>
				HAPI provides a built-in and configurable mechanism for validating resources.
				This mechanism is called the <i>FHIR Validator</i>.
			</p>

			
<div class="section">
<h3><a name="Background"></a>Background</h3>
				
				
<p>
					FHIR resource definitions are distributed with a set of XML schema files (XSD)
					as well as a set of XML Schematron (SCH) files. These two sets of files are
					complimentary to each other, meaning that in order to claim compliance to the
					FHIR specification, your resources must validate against both sets.
				</p>
				
<p>
					The two sets of files are included with HAPI, and it uses them to perform
					validation.
				</p>
				
			</div>
			
			
<div class="section">
<h3><a name="Preparation"></a>Preparation</h3>
				
				
<p>
					In order to use HAPI's Schematron support, a libaray called 
					<a class="externalLink" href="https://code.google.com/p/phloc-schematron/">Phloc-Schematron</a>
					is used, so this library must be added to your classpath (or Maven pom file).
					See <a href="./download.html">Downloads</a> for more information.
				</p>
				
			</div>
			
			
<div class="section">
<h3><a name="Validating_a_Resource"></a>Validating a Resource</h3>
				
				
<p>
					To validate a resource instance, a new validator instance is requested
					from the FHIR Context. This validator is then applied against
					a specific resource instance, as shown in the example below.
				</p>
				
					
					
				
<div class="source">
<pre>      // As always, you need a context
      FhirContext ctx = new FhirContext();

      // Create and populate a new patient object
      Patient p = new Patient();
      p.addName().addFamily(&quot;Smith&quot;).addGiven(&quot;John&quot;).addGiven(&quot;Q&quot;);
      p.addIdentifier(&quot;urn:foo:identifiers&quot;, &quot;12345&quot;);
      p.addTelecom().setSystem(ContactSystemEnum.PHONE).setValue(&quot;416 123-4567&quot;);

      // Request a validator and apply it
      FhirValidator val = ctx.newValidator();

      ValidationResult result = val.validateWithResult(p);
      if (result.isSuccessful()) {
         
         System.out.println(&quot;Validation passed&quot;);
         
      } else {
         // We failed validation!

         System.out.println(&quot;Validation failed&quot;);

         // The result contains an OperationOutcome outlining the failures
         String results = ctx.newXmlParser().setPrettyPrint(true).encodeResourceToString(result.getOperationOutcome());
         System.out.println(results);
      }
</pre></div>
						
			</div>

			
<div class="section">
<h3><a name="Validating_a_Set_of_Files"></a>Validating a Set of Files</h3>
				
				
<p>
					The following example shows how to load a set of resources from files
					on disk and validate each one.
				</p>
				
					
					
				
<div class="source">
<pre>      FhirContext ctx = new FhirContext();

      // Create a validator and configure it
      FhirValidator validator = ctx.newValidator();
      validator.setValidateAgainstStandardSchema(true);
      validator.setValidateAgainstStandardSchematron(true);

      // Get a list of files in a given directory
      String[] fileList = new File(&quot;/home/some/dir&quot;).list(new WildcardFileFilter(&quot;*.txt&quot;));
      for (String nextFile : fileList) {

         // For each file, load the contents into a string
         String nextFileContents = IOUtils.toString(new FileReader(nextFile));

         // Parse that string (this example assumes JSON encoding)
         IResource resource = ctx.newJsonParser().parseResource(nextFileContents);

         // Apply the validation. This will throw an exception on the first
         // validation failure
         ValidationResult result = validator.validateWithResult(resource);
         if (result.isSuccessful() == false) {
            throw new Exception(&quot;We failed!&quot;);
         }
         
      }

</pre></div>
						
			</div>

		</div>
		
	


                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2014
                        <a href="http://www.uhn.ca">University Health Network</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        <script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>
                </body >
</html>