map "http://fhir.hl7.org.au/fhir/rcpa/StructureMap/ColorectalMap" = "Colorectal --> DiagnosticReport Mapping"

uses "http://fhir.hl7.org.au/fhir/rcpa/StructureDefinition/Colorectal" as source

group for types Colorectal
  input source : Colorectal as source

    Colorectal : for source make  create("DiagnosticReport") as cdr,  cdr.status = "final",  cdr.code = cc("http://snomed.info/sct", "todo") then {
    Colorectal.subject : for source.subject : Reference 1..1 as v make cdr.subject = v
    Colorectal.requester : for source.requester : Reference 0..1 as v make  create("ProcedureRequest") as do,  cdr.basedOn = reference(do),  do.subject = reference(cdr),  do.requester as prr,  prr.agent = v
    Colorectal.performer : for source.performer : Reference 0..1 as v make  cdr.performer = v
    Colorectal.preAnalytic : for source.preAnalytic : code 0..1 as spa make  create("Observation") as tpa,  cdr.result = reference(tpa),  tpa.subject = reference(cdr),  tpa.status = "final",  tpa.code = cc("http://cap.org/protocols", "28592.1000043") then {
      Colorectal.preAnalytic.clinicalInformation : for spa.clinicalInformation as v make  create("ProcedureRequest") as do,  do.reasonCode as dr,  dr.text = v
      Colorectal.preAnalytic.operatingSurgeonDetails : for spa.operatingSurgeonDetails : Reference 0..1 as v make  create("Specimen") as sp,  cdr.specimen = reference(sp),  sp.subject = reference(cdr),  sp.collection as tc,  tc.collector = v
      Colorectal.preAnalytic.perforation : for spa.perforation : code 0..1 as v make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28289.1000043"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/present-absent-ns", v)
      Colorectal.preAnalytic.natureOfPerforation : for spa.natureOfPerforation : code 0..1 as v make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28296.1000043"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/perforation-type", v)
      Colorectal.preAnalytic.clinicalObstruction : for spa.clinicalObstruction : code 0..1 as v make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28292.1000043"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/present-absent-ns", v)
      Colorectal.preAnalytic.tumourLocation : for spa.tumourLocation : code 0..1 as v make  create("Observation") as obs,  tpa.related as tpar,  tpar.type = "has-member",  tpar.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "33725-3"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/crc-tumour-location", v)
      Colorectal.preAnalytic.synchronousTumours : for spa.synchronousTumours : code 0..1 as v make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28346.1000043"),  obs.value = v
      Colorectal.preAnalytic.distanceAnalVerge : for spa.distanceAnalVerge : code 0..1 as v make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "33748-5"),  obs.value = v
      Colorectal.preAnalytic.typeOfOperation : for spa.typeOfOperation : code 0..1 as sto make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "29306-8"),  obs.value = create("CodeableConcept") as tcc then {
        Colorectal.preAnalytic.typeOfOperation.code : for sto.code : code 0..1 as v make tcc.coding = c("http://snomed.info/sct", v)
        Colorectal.preAnalytic.typeOfOperation.other : for sto.other : code 0..1 as v make tcc.text = v
      }

      Colorectal.preAnalytic.anteriorResectionType : for spa.anteriorResectionType : code 0..1 as v make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28278.1000043", "Anterior resection type"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/hi-lo-ultralo", v)
      Colorectal.preAnalytic.preoperativeRadiotherapy : for spa.preoperativeRadiotherapy : code 0..1 as v make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "LN-RCPA-00063"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/yes-no-ns", v)
      Colorectal.preAnalytic.typeOfCourse : for spa.typeOfCourse : code 0..1 as v make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28286.1000043", "Type of course"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/course-type", v)
      Colorectal.preAnalytic.surgeonsOpinion : for spa.surgeonsOpinion : code 0..1 as v make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28295.1000043", "Surgeons opinion of residual cancer"),  obs.value = v
      Colorectal.preAnalytic.adjacentOrgans : for spa.adjacentOrgans : code 0..1 as v make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28336.1000043", "Adjacent organ involvement"),  obs.value = v
      Colorectal.preAnalytic.newPrimaryOrRecurrence : for spa.newPrimaryOrRecurrence : code 0..1 as v make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28337.1000043", "New primary cancer or recurrence"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/cancer-primary-or-recurrence", v)
      Colorectal.preAnalytic.RecurrenceDescription : for spa.RecurrenceDescription : code 0..1 as v make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://something", "sort-this-1"),  obs.value = v
      Colorectal.preAnalytic.pathologyAccessionNumber : for spa.pathologyAccessionNumber : code 0..1 as v make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://something", "sort-this-2"),  obs.value = v
      Colorectal.preAnalytic.otherRelevantDetails : for spa.otherRelevantDetails : code 0..1 as v make  create("Observation") as obs,  tpa.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28301.1000043", "Other details"),  obs.value = v
    }

    Colorectal.macro : for source.macro : code 0..1 as sma make  create("Observation") as tma,  cdr.result = reference(tma),  tma.subject = reference(cdr),  tma.status = "final",  tma.code = cc("http://cap.org/protocols", "27906.1000043", "Macroscopy") then {
      Colorectal.macro.specimenLength : for sma.specimenLength : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://snomed.info/sct", "384606002"),  obs.value = v
      Colorectal.macro.tumourSite : for sma.tumourSite : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "33725-3"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/crc-tumour-location", v)
      Colorectal.macro.maxTumourDiameter : for sma.maxTumourDiameter : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "21889-1"),  obs.value = v
      Colorectal.macro.distanceNearerProxOrDistal : for sma.distanceNearerProxOrDistal : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "81175-2"),  obs.value = v
      Colorectal.macro.distNonperitonCircumMargin : for sma.distNonperitonCircumMargin : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28358.1000043", "Distance of tumour to the nonperitonealised circumferential margin"),  obs.value = v
      Colorectal.macro.tumourPerforation : for sma.tumourPerforation : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "27963.1000043", "Tumour perforation"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/present-absent", v)
      Colorectal.macro.relToAntPeritonealReflection : for sma.relToAntPeritonealReflection : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28362.1000043", "Site of rectal tumour in relation to the anterior level of the peritoneal reflection"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/crc-rel-anterior-peritoneal-reflection", v)
      Colorectal.macro.intactnessOfMesorectum : for sma.intactnessOfMesorectum : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "33730-3"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/crc-intactness-of-mesorectum", v)
      Colorectal.macro.peritoneum : for sma.peritoneum : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28369.1000043", "Peritoneum"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/crc-peritoneum-invasion", v)
      Colorectal.macro.lymphNodes : for sma.lymphNodes : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://snomed.info/sct", "364108009"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/received-notreceived", v)
      Colorectal.macro.noLymphNodesPerCassette : for sma.noLymphNodesPerCassette : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://snomed.info/sct", "444025001"),  obs.value = v
      Colorectal.macro.polyps : for sma.polyps : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28376.1000043", "The presence or absence of polyps should be recorded"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/present-absent-na", v)
      Colorectal.macro.polypSummary : for sma.polypSummary : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28379.1000043", "The number, diameter and gross configuration of polyps should be summarised"),  obs.value = v
      Colorectal.macro.otherMacroComments : for sma.otherMacroComments : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "22634-0"),  obs.value = v
      Colorectal.macro.natureAndSiteOfBlocks : for sma.natureAndSiteOfBlocks : code 0..1 as v make  create("Observation") as obs,  tma.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "81178-6"),  obs.value = v
    }

    Colorectal.micro : for source.micro : code 0..1 as smi make  create("Observation") as tmi,  cdr.result = reference(tmi),  tmi.subject = reference(cdr),  tmi.status = "final",  tmi.code = cc("http://cap.org/protocols", "27973.1000043", "Microscopy") then {
      Colorectal.micro.tumourType : for smi.tumourType : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://snomed.info/sct", "371441004"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/crc-tumour-type", v)
      Colorectal.micro.histologicalGrade : for smi.histologicalGrade : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "33732-9"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/histological-grade", v)
      Colorectal.micro.maxDegreeLocalInvasion : for smi.maxDegreeLocalInvasion : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28534.1000043", "Maximum degree of local invasion into or through the bowel wall"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/crc-deg-inv-bowel-wall", v)
      Colorectal.micro.proximalOrDistalResectionMargins : for smi.proximalOrDistalResectionMargins : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28348.1000043", "Involvement of the proximal or distal resection (cut-end) margins"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/involved-notinvolved", v)
      Colorectal.micro.involvedMargins : for smi.involvedMargins : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "44699-7"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/distal-proximal", v)
      Colorectal.micro.marginsMicroClearance : for smi.marginsMicroClearance : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28396.1000043", "Microscopic Clearance"),  obs.value = v
      Colorectal.micro.nonperitonealisedCircumMargin : for smi.nonperitonealisedCircumMargin : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28354.1000043", "Status of the nonperitonealised circumferential margin (rectal tumours)"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/involved-notinvolved", v)
      Colorectal.micro.microClearanceRectum : for smi.microClearanceRectum : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28400.1000043", "Microscopic Clearance"),  obs.value = v
      Colorectal.micro.lymphNodeInvolvement : for smi.lymphNodeInvolvement : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "21892-5"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/present-absent-na", v)
      Colorectal.micro.lymphNodesDetails : for smi.lymphNodesDetails : code 0..1 as slnd make  create("Observation") as tlnd,  tmi.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(tlnd),  tlnd.subject = reference(cdr),  tlnd.status = "final",  tlnd.code = cc("http://cap.org/protocols", "28404.1000043", "Site(s) and numbers of lymph nodes") then {
        Colorectal.micro.lymphNodesDetails.site : for slnd.site : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "39111-0"),  obs.value = v
        Colorectal.micro.lymphNodesDetails.numPos : for slnd.numPos : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "21893-3"),  obs.value = v
        Colorectal.micro.lymphNodesDetails.numExamined : for slnd.numExamined : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "21894-1"),  obs.value = v
      }

      Colorectal.micro.extramuralTumourDeposits : for smi.extramuralTumourDeposits : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28392.1000043", "Isolated extra-mural tumour deposits"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/present-absent-na", v)
      Colorectal.micro.apicalNodeInvolvement : for smi.apicalNodeInvolvement : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28407.1000043", "Apical node involvement"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/present-absent-na", v)
      Colorectal.micro.venousSmallVesselInvasion : for smi.venousSmallVesselInvasion : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "33761-8"),  obs.value = v
      Colorectal.micro.intramuralVeinInvasion : for smi.intramuralVeinInvasion : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28412.1000043", "Intramural vein invasion"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/intramural-vein-invasion", v)
      Colorectal.micro.extramuralVeinInvasion : for smi.extramuralVeinInvasion : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28415.1000043", "Extramural vein invasion"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/extramural-vein-invasion", v)
      Colorectal.micro.smallVesselInvasion : for smi.smallVesselInvasion : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "33739-4"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/small-vessel-invasion", v)
      Colorectal.micro.perineuralInvasion : for smi.perineuralInvasion : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "33741-0"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/perineural-invasion", v)
      Colorectal.micro.histoConfDistMetastases : for smi.histoConfDistMetastases : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://snomed.info/sct", "399608002"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/present-absent-ns", v)
      Colorectal.micro.histoConfDistMetastasesSite : for smi.histoConfDistMetastasesSite : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "21920-4"),  obs.value = v
      Colorectal.micro.relCoexistPathabnorm : for smi.relCoexistPathabnorm : code 0..1 as scc make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://snomed.info/sct", "371498006"),  obs.value = create("CodeableConcept") as tcc then {
        Colorectal.micro.relCoexistPathabnorm.code : for scc.code : code 0..1 as v make tcc.coding = c("http://snomed.info/sct", v)
        Colorectal.micro.relCoexistPathabnorm.other : for scc.other : code 0..1 as v make tcc.text = v
      }

      Colorectal.micro.polypDetails : for smi.polypDetails : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "33745-1"),  obs.value = v
      Colorectal.micro.dysplasia : for smi.dysplasia : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28426.1000043", "Dysplasia"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/dysplasia", v)
      Colorectal.micro.otherAbnormality : for smi.otherAbnormality : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://test.what/here", "something"),  obs.value = v
      Colorectal.micro.microResidualTumourStatus : for smi.microResidualTumourStatus : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28425.1000043", "Microscopic residual tumour status (completeness of resection)"),  obs.value = v
      Colorectal.micro.neoadjuvantTherapy : for smi.neoadjuvantTherapy : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28123.1000043", "Response to neoadjuvant therapy"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/response-to-neoadjuvant-therapy", v)
      Colorectal.micro.microComments : for smi.microComments : code 0..1 as v make  create("Observation") as obs,  obs.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "22635-7"),  obs.value = v
    }

    Colorectal.ancillaryTests : for source.ancillaryTests : code 0..1 as sat make  create("Observation") as tat,  cdr.result = reference(tat),  tat.subject = reference(cdr),  tat.status = "final",  tat.code = cc("http://cap.org/protocols", "28156.1000043", "Ancillary test findings") then {
      Colorectal.ancillaryTests.mlh1 : for sat.mlh1 : code 0..1 as v make  create("Observation") as obs,  tat.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "50322-7"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/stain-type", v)
      Colorectal.ancillaryTests.pms2 : for sat.pms2 : code 0..1 as v make  create("Observation") as obs,  tat.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "50328-4"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/stain-type", v)
      Colorectal.ancillaryTests.msh2 : for sat.msh2 : code 0..1 as v make  create("Observation") as obs,  tat.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "50323-5"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/stain-type", v)
      Colorectal.ancillaryTests.msh6 : for sat.msh6 : code 0..1 as v make  create("Observation") as obs,  tat.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "50324-3"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/stain-type", v)
      Colorectal.ancillaryTests.comments : for sat.comments : code 0..1 as v make  create("Observation") as obs,  tat.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28436.1000043", "Mismatch repair enzyme comments"),  obs.value = v
      Colorectal.ancillaryTests.msi : for sat.msi : code 0..1 as smsi make  create("Observation") as tmsi,  tat.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(tmsi),  tmsi.subject = reference(cdr),  tmsi.status = "final",  tmsi.code = cc("http://cap.org/protocols", "28399.1000043", "Microsatellite instability (MSI)") then {
        Colorectal.ancillaryTests.msi.code : for smsi.code : code 0..1 as v make  create("Observation") as obs,  tmsi.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "43368-0"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/msi-options", v)
        Colorectal.ancillaryTests.msi.comments : for smsi.comments : code 0..1 as v make  create("Observation") as obs,  tmsi.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28453.1000043", "Microsatellite instability (MSI) comments"),  obs.value = v
        Colorectal.ancillaryTests.msi.labDetails : for smsi.labDetails : code 0..1 as v make  create("Observation") as obs,  tmsi.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28447.1000043", "MSI laboratory performing test and report number"),  obs.value = v
      }

      Colorectal.ancillaryTests.braf : for sat.braf : code 0..1 as sbraf make  create("Observation") as tbraf,  tat.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(tbraf),  tbraf.subject = reference(cdr),  tbraf.status = "final",  tbraf.code = cc("http://cap.org/protocols", "28454.1000043", "BRAF (V600E mutation)") then {
        Colorectal.ancillaryTests.braf.code : for sbraf.code : code 0..1 as v make  create("Observation") as obs,  tbraf.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "58483-9"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/mutated-wildtype", v)
        Colorectal.ancillaryTests.braf.comments : for sbraf.comments : code 0..1 as v make  create("Observation") as obs,  tbraf.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28460.1000043", "BRAF (V600E mutation) comments"),  obs.value = v
        Colorectal.ancillaryTests.braf.labDetails : for sbraf.labDetails : code 0..1 as v make  create("Observation") as obs,  tbraf.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28459.1000043", "BRAF (V600E mutation) laboratory performing test and report number"),  obs.value = v
      }

      Colorectal.ancillaryTests.kras : for sat.kras : code 0..1 as skras make  create("Observation") as tkras,  tat.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(tkras),  tkras.subject = reference(cdr),  tkras.status = "final",  tkras.code = cc("http://cap.org/protocols", "28461.1000043", "KRAS gene mutation (codons 12 and 13)") then {
        Colorectal.ancillaryTests.kras.code : for skras.code : code 0..1 as v make  create("Observation") as obs,  tkras.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "21703-4"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/mutated-wildtype", v)
        Colorectal.ancillaryTests.kras.comments : for skras.comments : code 0..1 as v make  create("Observation") as obs,  tkras.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28465.1000043", "KRAS gene mutation (codons 12 and 13) comments"),  obs.value = v
        Colorectal.ancillaryTests.kras.labDetails : for skras.labDetails : code 0..1 as v make  create("Observation") as obs,  tkras.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28466.1000043", "KRAS gene mutation (codons 12 and 13) laboratory performing test and report number"),  obs.value = v
      }

    }

    Colorectal.synthesisOverview : for source.synthesisOverview : code 0..1 as sso make  create("Observation") as tto,  cdr.result = reference(tto),  tto.subject = reference(cdr),  tto.status = "final",  tto.code = cc("http://cap.org/protocols", "28253.1000043", "Synthesis and Overview") then {
      Colorectal.synthesisOverview.tumourStageT : for sso.tumourStageT : code 0..1 as v make  create("Observation") as obs,  tto.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://snomed.info/sct", "78873005"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/crc-tumour-stage-t", v)
      Colorectal.synthesisOverview.tumourStageN : for sso.tumourStageN : code 0..1 as v make  create("Observation") as obs,  tto.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://snomed.info/sct", "277206009"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/crc-tumour-stage-n", v)
      Colorectal.synthesisOverview.tumourStageM : for sso.tumourStageM : code 0..1 as v make  create("Observation") as obs,  tto.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28552.1000043", "M"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/crc-tumour-stage-m", v)
      Colorectal.synthesisOverview.tumourStageGrouping : for sso.tumourStageGrouping : code 0..1 as v make  create("Observation") as obs,  tto.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "21902-2"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/crc-tumour-stage-grouping", v)
      Colorectal.synthesisOverview.tumourStagingSystem : for sso.tumourStagingSystem : code 0..1 as v make  create("Observation") as obs,  tto.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://snomed.info/sct", "443941007"),  obs.value = v
      Colorectal.synthesisOverview.diagnosticSummary : for sso.diagnosticSummary : code 0..1 as v make  create("Observation") as obs,  tto.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "22637-3"),  obs.value = v
      Colorectal.synthesisOverview.newPrimaryOrRecurrence : for sso.newPrimaryOrRecurrence : code 0..1 as v make  create("Observation") as obs,  tto.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28472.1000043", "New primary cancer or recurrence"),  obs.value = cc("http://fhir.hl7.org.au/fhir/rcpa/ValueSet/new-cancer-or-recurrence", v)
      Colorectal.synthesisOverview.newDescription : for sso.newDescription : code 0..1 as v make  create("Observation") as obs,  tto.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://cap.org/protocols", "28473.1000043", "Describe"),  obs.value = v
      Colorectal.synthesisOverview.overarchingComment : for sso.overarchingComment : code 0..1 as v make  create("Observation") as obs,  tto.related as xtmp,  xtmp.type = "has-member",  xtmp.target = reference(obs),  obs.subject = reference(cdr),  obs.status = "final",  obs.code = cc("http://loinc.org", "22638-1"),  obs.value = v
    }

  }


endgroup
