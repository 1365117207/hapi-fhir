<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>RestfulServer xref</title>
<link type="text/css" rel="stylesheet" href="../../../../../stylesheet.css" />
</head>
<body>
<div id="overview"><a href="../../../../../../apidocs/ca/uhn/fhir/rest/server/RestfulServer.html">View Javadoc</a></div><pre>
<a class="jxr_linenumber" name="L1" href="#L1">1</a>   <strong class="jxr_keyword">package</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.server;
<a class="jxr_linenumber" name="L2" href="#L2">2</a>   
<a class="jxr_linenumber" name="L3" href="#L3">3</a>   <em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="L4" href="#L4">4</a>   <em class="jxr_comment"> * #%L</em>
<a class="jxr_linenumber" name="L5" href="#L5">5</a>   <em class="jxr_comment"> * HAPI FHIR - Core Library</em>
<a class="jxr_linenumber" name="L6" href="#L6">6</a>   <em class="jxr_comment"> * %%</em>
<a class="jxr_linenumber" name="L7" href="#L7">7</a>   <em class="jxr_comment"> * Copyright (C) 2014 - 2015 University Health Network</em>
<a class="jxr_linenumber" name="L8" href="#L8">8</a>   <em class="jxr_comment"> * %%</em>
<a class="jxr_linenumber" name="L9" href="#L9">9</a>   <em class="jxr_comment"> * Licensed under the Apache License, Version 2.0 (the "License");</em>
<a class="jxr_linenumber" name="L10" href="#L10">10</a>  <em class="jxr_comment"> * you may not use this file except in compliance with the License.</em>
<a class="jxr_linenumber" name="L11" href="#L11">11</a>  <em class="jxr_comment"> * You may obtain a copy of the License at</em>
<a class="jxr_linenumber" name="L12" href="#L12">12</a>  <em class="jxr_comment"> * </em>
<a class="jxr_linenumber" name="L13" href="#L13">13</a>  <em class="jxr_comment"> *      <a href="http://www.apache.org/licenses/LICENSE-2." target="alexandria_uri">http://www.apache.org/licenses/LICENSE-2.</a>0</em>
<a class="jxr_linenumber" name="L14" href="#L14">14</a>  <em class="jxr_comment"> * </em>
<a class="jxr_linenumber" name="L15" href="#L15">15</a>  <em class="jxr_comment"> * Unless required by applicable law or agreed to in writing, software</em>
<a class="jxr_linenumber" name="L16" href="#L16">16</a>  <em class="jxr_comment"> * distributed under the License is distributed on an "AS IS" BASIS,</em>
<a class="jxr_linenumber" name="L17" href="#L17">17</a>  <em class="jxr_comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</em>
<a class="jxr_linenumber" name="L18" href="#L18">18</a>  <em class="jxr_comment"> * See the License for the specific language governing permissions and</em>
<a class="jxr_linenumber" name="L19" href="#L19">19</a>  <em class="jxr_comment"> * limitations under the License.</em>
<a class="jxr_linenumber" name="L20" href="#L20">20</a>  <em class="jxr_comment"> * #L%</em>
<a class="jxr_linenumber" name="L21" href="#L21">21</a>  <em class="jxr_comment"> */</em>
<a class="jxr_linenumber" name="L22" href="#L22">22</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> org.apache.commons.lang3.StringUtils.isBlank;
<a class="jxr_linenumber" name="L23" href="#L23">23</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> org.apache.commons.lang3.StringUtils.isNotBlank;
<a class="jxr_linenumber" name="L24" href="#L24">24</a>  
<a class="jxr_linenumber" name="L25" href="#L25">25</a>  <strong class="jxr_keyword">import</strong> java.io.IOException;
<a class="jxr_linenumber" name="L26" href="#L26">26</a>  <strong class="jxr_keyword">import</strong> java.lang.annotation.Annotation;
<a class="jxr_linenumber" name="L27" href="#L27">27</a>  <strong class="jxr_keyword">import</strong> java.lang.reflect.InvocationTargetException;
<a class="jxr_linenumber" name="L28" href="#L28">28</a>  <strong class="jxr_keyword">import</strong> java.lang.reflect.Method;
<a class="jxr_linenumber" name="L29" href="#L29">29</a>  <strong class="jxr_keyword">import</strong> java.lang.reflect.Modifier;
<a class="jxr_linenumber" name="L30" href="#L30">30</a>  <strong class="jxr_keyword">import</strong> java.util.ArrayList;
<a class="jxr_linenumber" name="L31" href="#L31">31</a>  <strong class="jxr_keyword">import</strong> java.util.Arrays;
<a class="jxr_linenumber" name="L32" href="#L32">32</a>  <strong class="jxr_keyword">import</strong> java.util.Collection;
<a class="jxr_linenumber" name="L33" href="#L33">33</a>  <strong class="jxr_keyword">import</strong> java.util.Collections;
<a class="jxr_linenumber" name="L34" href="#L34">34</a>  <strong class="jxr_keyword">import</strong> java.util.Enumeration;
<a class="jxr_linenumber" name="L35" href="#L35">35</a>  <strong class="jxr_keyword">import</strong> java.util.HashMap;
<a class="jxr_linenumber" name="L36" href="#L36">36</a>  <strong class="jxr_keyword">import</strong> java.util.HashSet;
<a class="jxr_linenumber" name="L37" href="#L37">37</a>  <strong class="jxr_keyword">import</strong> java.util.List;
<a class="jxr_linenumber" name="L38" href="#L38">38</a>  <strong class="jxr_keyword">import</strong> java.util.Map;
<a class="jxr_linenumber" name="L39" href="#L39">39</a>  <strong class="jxr_keyword">import</strong> java.util.Set;
<a class="jxr_linenumber" name="L40" href="#L40">40</a>  <strong class="jxr_keyword">import</strong> java.util.StringTokenizer;
<a class="jxr_linenumber" name="L41" href="#L41">41</a>  <strong class="jxr_keyword">import</strong> java.util.concurrent.locks.Lock;
<a class="jxr_linenumber" name="L42" href="#L42">42</a>  <strong class="jxr_keyword">import</strong> java.util.concurrent.locks.ReentrantLock;
<a class="jxr_linenumber" name="L43" href="#L43">43</a>  
<a class="jxr_linenumber" name="L44" href="#L44">44</a>  <strong class="jxr_keyword">import</strong> javax.servlet.ServletException;
<a class="jxr_linenumber" name="L45" href="#L45">45</a>  <strong class="jxr_keyword">import</strong> javax.servlet.UnavailableException;
<a class="jxr_linenumber" name="L46" href="#L46">46</a>  <strong class="jxr_keyword">import</strong> javax.servlet.http.HttpServlet;
<a class="jxr_linenumber" name="L47" href="#L47">47</a>  <strong class="jxr_keyword">import</strong> javax.servlet.http.HttpServletRequest;
<a class="jxr_linenumber" name="L48" href="#L48">48</a>  <strong class="jxr_keyword">import</strong> javax.servlet.http.HttpServletResponse;
<a class="jxr_linenumber" name="L49" href="#L49">49</a>  
<a class="jxr_linenumber" name="L50" href="#L50">50</a>  <strong class="jxr_keyword">import</strong> org.apache.commons.lang3.StringUtils;
<a class="jxr_linenumber" name="L51" href="#L51">51</a>  <strong class="jxr_keyword">import</strong> org.apache.commons.lang3.Validate;
<a class="jxr_linenumber" name="L52" href="#L52">52</a>  <strong class="jxr_keyword">import</strong> org.hl7.fhir.instance.model.api.IBaseResource;
<a class="jxr_linenumber" name="L53" href="#L53">53</a>  
<a class="jxr_linenumber" name="L54" href="#L54">54</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.context.ConfigurationException;
<a class="jxr_linenumber" name="L55" href="#L55">55</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.context.FhirContext;
<a class="jxr_linenumber" name="L56" href="#L56">56</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.context.ProvidedResourceScanner;
<a class="jxr_linenumber" name="L57" href="#L57">57</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.context.RuntimeResourceDefinition;
<a class="jxr_linenumber" name="L58" href="#L58">58</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.model.api.Bundle;
<a class="jxr_linenumber" name="L59" href="#L59">59</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.model.api.Include;
<a class="jxr_linenumber" name="L60" href="#L60">60</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.model.primitive.IdDt;
<a class="jxr_linenumber" name="L61" href="#L61">61</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.model.valueset.BundleTypeEnum;
<a class="jxr_linenumber" name="L62" href="#L62">62</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.annotation.Destroy;
<a class="jxr_linenumber" name="L63" href="#L63">63</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.annotation.IdParam;
<a class="jxr_linenumber" name="L64" href="#L64">64</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.annotation.Initialize;
<a class="jxr_linenumber" name="L65" href="#L65">65</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.api.RequestTypeEnum;
<a class="jxr_linenumber" name="L66" href="#L66">66</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.api.RestOperationTypeEnum;
<a class="jxr_linenumber" name="L67" href="#L67">67</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.api.SummaryEnum;
<a class="jxr_linenumber" name="L68" href="#L68">68</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.method.BaseMethodBinding;
<a class="jxr_linenumber" name="L69" href="#L69">69</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.method.ConformanceMethodBinding;
<a class="jxr_linenumber" name="L70" href="#L70">70</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.method.RequestDetails;
<a class="jxr_linenumber" name="L71" href="#L71">71</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.server.exceptions.AuthenticationException;
<a class="jxr_linenumber" name="L72" href="#L72">72</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.server.exceptions.BaseServerResponseException;
<a class="jxr_linenumber" name="L73" href="#L73">73</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.server.exceptions.InvalidRequestException;
<a class="jxr_linenumber" name="L74" href="#L74">74</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.server.exceptions.NotModifiedException;
<a class="jxr_linenumber" name="L75" href="#L75">75</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.server.interceptor.ExceptionHandlingInterceptor;
<a class="jxr_linenumber" name="L76" href="#L76">76</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.<strong class="jxr_keyword">rest</strong>.server.interceptor.IServerInterceptor;
<a class="jxr_linenumber" name="L77" href="#L77">77</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.util.ReflectionUtil;
<a class="jxr_linenumber" name="L78" href="#L78">78</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.util.UrlUtil;
<a class="jxr_linenumber" name="L79" href="#L79">79</a>  <strong class="jxr_keyword">import</strong> ca.uhn.fhir.util.VersionUtil;
<a class="jxr_linenumber" name="L80" href="#L80">80</a>  
<a class="jxr_linenumber" name="L81" href="#L81">81</a>  <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">class</strong> <a href="../../../../../ca/uhn/fhir/rest/server/RestfulServer.html">RestfulServer</a> <strong class="jxr_keyword">extends</strong> HttpServlet {
<a class="jxr_linenumber" name="L82" href="#L82">82</a>  
<a class="jxr_linenumber" name="L83" href="#L83">83</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> <a href="../../../../../ca/uhn/fhir/rest/server/interceptor/ExceptionHandlingInterceptor.html">ExceptionHandlingInterceptor</a> DEFAULT_EXCEPTION_HANDLER = <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/rest/server/interceptor/ExceptionHandlingInterceptor.html">ExceptionHandlingInterceptor</a>();
<a class="jxr_linenumber" name="L84" href="#L84">84</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> <strong class="jxr_keyword">long</strong> serialVersionUID = 1L;
<a class="jxr_linenumber" name="L85" href="#L85">85</a>  	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L86" href="#L86">86</a>  <em class="jxr_javadoccomment">	 * Default setting for {@link #setETagSupport(ETagSupportEnum) ETag Support}: {@link ETagSupportEnum#ENABLED}</em>
<a class="jxr_linenumber" name="L87" href="#L87">87</a>  <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L88" href="#L88">88</a>  	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> <a href="../../../../../ca/uhn/fhir/rest/server/ETagSupportEnum.html">ETagSupportEnum</a> DEFAULT_ETAG_SUPPORT = ETagSupportEnum.ENABLED;
<a class="jxr_linenumber" name="L89" href="#L89">89</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> org.slf4j.Logger ourLog = org.slf4j.LoggerFactory.getLogger(RestfulServer.<strong class="jxr_keyword">class</strong>);
<a class="jxr_linenumber" name="L90" href="#L90">90</a>  	<strong class="jxr_keyword">private</strong> <a href="../../../../../ca/uhn/fhir/rest/server/AddProfileTagEnum.html">AddProfileTagEnum</a> myAddProfileTag;
<a class="jxr_linenumber" name="L91" href="#L91">91</a>  	<strong class="jxr_keyword">private</strong> <a href="../../../../../ca/uhn/fhir/rest/server/BundleInclusionRule.html">BundleInclusionRule</a> myBundleInclusionRule = BundleInclusionRule.BASED_ON_INCLUDES;
<a class="jxr_linenumber" name="L92" href="#L92">92</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">boolean</strong> myDefaultPrettyPrint = false;
<a class="jxr_linenumber" name="L93" href="#L93">93</a>  	<strong class="jxr_keyword">private</strong> <a href="../../../../../ca/uhn/fhir/rest/server/EncodingEnum.html">EncodingEnum</a> myDefaultResponseEncoding = EncodingEnum.XML;
<a class="jxr_linenumber" name="L94" href="#L94">94</a>  	<strong class="jxr_keyword">private</strong> <a href="../../../../../ca/uhn/fhir/rest/server/ETagSupportEnum.html">ETagSupportEnum</a> myETagSupport = DEFAULT_ETAG_SUPPORT;
<a class="jxr_linenumber" name="L95" href="#L95">95</a>  	<strong class="jxr_keyword">private</strong> <a href="../../../../../ca/uhn/fhir/context/FhirContext.html">FhirContext</a> myFhirContext;
<a class="jxr_linenumber" name="L96" href="#L96">96</a>  	<strong class="jxr_keyword">private</strong> String myImplementationDescription;
<a class="jxr_linenumber" name="L97" href="#L97">97</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">final</strong> List&lt;IServerInterceptor&gt; myInterceptors = <strong class="jxr_keyword">new</strong> ArrayList&lt;IServerInterceptor&gt;();
<a class="jxr_linenumber" name="L98" href="#L98">98</a>  	<strong class="jxr_keyword">private</strong> <a href="../../../../../ca/uhn/fhir/rest/server/IPagingProvider.html">IPagingProvider</a> myPagingProvider;
<a class="jxr_linenumber" name="L99" href="#L99">99</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">final</strong> List&lt;Object&gt; myPlainProviders = <strong class="jxr_keyword">new</strong> ArrayList&lt;Object&gt;();
<a class="jxr_linenumber" name="L100" href="#L100">100</a> 	<strong class="jxr_keyword">private</strong> Map&lt;String, ResourceBinding&gt; myResourceNameToBinding = <strong class="jxr_keyword">new</strong> HashMap&lt;String, ResourceBinding&gt;();
<a class="jxr_linenumber" name="L101" href="#L101">101</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">final</strong> List&lt;IResourceProvider&gt; myResourceProviders = <strong class="jxr_keyword">new</strong> ArrayList&lt;IResourceProvider&gt;();
<a class="jxr_linenumber" name="L102" href="#L102">102</a> 	<strong class="jxr_keyword">private</strong> Map&lt;String,IResourceProvider&gt; myTypeToProvider = <strong class="jxr_keyword">new</strong> HashMap&lt;String, IResourceProvider&gt;();
<a class="jxr_linenumber" name="L103" href="#L103">103</a> 	<strong class="jxr_keyword">private</strong> <a href="../../../../../ca/uhn/fhir/rest/server/IServerAddressStrategy.html">IServerAddressStrategy</a> myServerAddressStrategy = <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/rest/server/IncomingRequestAddressStrategy.html">IncomingRequestAddressStrategy</a>();
<a class="jxr_linenumber" name="L104" href="#L104">104</a> 	<strong class="jxr_keyword">private</strong> <a href="../../../../../ca/uhn/fhir/rest/server/ResourceBinding.html">ResourceBinding</a> myServerBinding = <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/rest/server/ResourceBinding.html">ResourceBinding</a>();
<a class="jxr_linenumber" name="L105" href="#L105">105</a> 	<strong class="jxr_keyword">private</strong> BaseMethodBinding&lt;?&gt; myServerConformanceMethod;
<a class="jxr_linenumber" name="L106" href="#L106">106</a> 	<strong class="jxr_keyword">private</strong> Object myServerConformanceProvider;
<a class="jxr_linenumber" name="L107" href="#L107">107</a> 	<strong class="jxr_keyword">private</strong> String myServerName = <span class="jxr_string">"HAPI FHIR Server"</span>;
<a class="jxr_linenumber" name="L108" href="#L108">108</a> 	<em class="jxr_javadoccomment">/** This is configurable but by default we just use HAPI version */</em>
<a class="jxr_linenumber" name="L109" href="#L109">109</a> 	<strong class="jxr_keyword">private</strong> String myServerVersion = VersionUtil.getVersion();
<a class="jxr_linenumber" name="L110" href="#L110">110</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">boolean</strong> myStarted;
<a class="jxr_linenumber" name="L111" href="#L111">111</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">boolean</strong> myUseBrowserFriendlyContentTypes;
<a class="jxr_linenumber" name="L112" href="#L112">112</a> 	<strong class="jxr_keyword">private</strong> Lock myProviderRegistrationMutex = <strong class="jxr_keyword">new</strong> ReentrantLock();
<a class="jxr_linenumber" name="L113" href="#L113">113</a> 
<a class="jxr_linenumber" name="L114" href="#L114">114</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L115" href="#L115">115</a> <em class="jxr_javadoccomment">	 * Constructor. Note that if no {@link FhirContext} is passed in to the server (either through the constructor, or through {@link #setFhirContext(FhirContext)}) the server will determine which</em>
<a class="jxr_linenumber" name="L116" href="#L116">116</a> <em class="jxr_javadoccomment">	 * version of FHIR to support through classpath scanning. This is brittle, and it is highly recommended to explicitly specify a FHIR version.</em>
<a class="jxr_linenumber" name="L117" href="#L117">117</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L118" href="#L118">118</a> 	<strong class="jxr_keyword">public</strong> <a href="../../../../../ca/uhn/fhir/rest/server/RestfulServer.html">RestfulServer</a>() {
<a class="jxr_linenumber" name="L119" href="#L119">119</a> 		<strong class="jxr_keyword">this</strong>(<strong class="jxr_keyword">null</strong>);
<a class="jxr_linenumber" name="L120" href="#L120">120</a> 	}
<a class="jxr_linenumber" name="L121" href="#L121">121</a> 
<a class="jxr_linenumber" name="L122" href="#L122">122</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L123" href="#L123">123</a> <em class="jxr_javadoccomment">	 * Constructor</em>
<a class="jxr_linenumber" name="L124" href="#L124">124</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L125" href="#L125">125</a> 	<strong class="jxr_keyword">public</strong> <a href="../../../../../ca/uhn/fhir/rest/server/RestfulServer.html">RestfulServer</a>(<a href="../../../../../ca/uhn/fhir/context/FhirContext.html">FhirContext</a> theCtx) {
<a class="jxr_linenumber" name="L126" href="#L126">126</a> 		myFhirContext = theCtx;
<a class="jxr_linenumber" name="L127" href="#L127">127</a> 	}
<a class="jxr_linenumber" name="L128" href="#L128">128</a> 
<a class="jxr_linenumber" name="L129" href="#L129">129</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L130" href="#L130">130</a> <em class="jxr_javadoccomment">	 * This method is called prior to sending a response to incoming requests. It is used to add custom headers.</em>
<a class="jxr_linenumber" name="L131" href="#L131">131</a> <em class="jxr_javadoccomment">	 * &lt;p&gt;</em>
<a class="jxr_linenumber" name="L132" href="#L132">132</a> <em class="jxr_javadoccomment">	 * Use caution if overriding this method: it is recommended to call &lt;code&gt;super.addHeadersToResponse&lt;/code&gt; to avoid inadvertantly disabling functionality.</em>
<a class="jxr_linenumber" name="L133" href="#L133">133</a> <em class="jxr_javadoccomment">	 * &lt;/p&gt;</em>
<a class="jxr_linenumber" name="L134" href="#L134">134</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L135" href="#L135">135</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> addHeadersToResponse(HttpServletResponse theHttpResponse) {
<a class="jxr_linenumber" name="L136" href="#L136">136</a> 		theHttpResponse.addHeader(<span class="jxr_string">"X-Powered-By"</span>, <span class="jxr_string">"HAPI FHIR "</span> + VersionUtil.getVersion() + <span class="jxr_string">" RESTful Server"</span>);
<a class="jxr_linenumber" name="L137" href="#L137">137</a> 	}
<a class="jxr_linenumber" name="L138" href="#L138">138</a> 
<a class="jxr_linenumber" name="L139" href="#L139">139</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">void</strong> assertProviderIsValid(Object theNext) <strong class="jxr_keyword">throws</strong> ConfigurationException {
<a class="jxr_linenumber" name="L140" href="#L140">140</a> 		<strong class="jxr_keyword">if</strong> (Modifier.isPublic(theNext.getClass().getModifiers()) == false) {
<a class="jxr_linenumber" name="L141" href="#L141">141</a> 			<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/context/ConfigurationException.html">ConfigurationException</a>(<span class="jxr_string">"Can not use provider '"</span> + theNext.getClass() + <span class="jxr_string">"' - Class must be public"</span>);
<a class="jxr_linenumber" name="L142" href="#L142">142</a> 		}
<a class="jxr_linenumber" name="L143" href="#L143">143</a> 	}
<a class="jxr_linenumber" name="L144" href="#L144">144</a> 
<a class="jxr_linenumber" name="L145" href="#L145">145</a> 	@Override
<a class="jxr_linenumber" name="L146" href="#L146">146</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> destroy() {
<a class="jxr_linenumber" name="L147" href="#L147">147</a> 		<strong class="jxr_keyword">if</strong> (getResourceProviders() != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L148" href="#L148">148</a> 			<strong class="jxr_keyword">for</strong> (IResourceProvider iResourceProvider : getResourceProviders()) {
<a class="jxr_linenumber" name="L149" href="#L149">149</a> 				invokeDestroy(iResourceProvider);
<a class="jxr_linenumber" name="L150" href="#L150">150</a> 			}
<a class="jxr_linenumber" name="L151" href="#L151">151</a> 		}
<a class="jxr_linenumber" name="L152" href="#L152">152</a> 		<strong class="jxr_keyword">if</strong> (myServerConformanceProvider != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L153" href="#L153">153</a> 			invokeDestroy(myServerConformanceProvider);
<a class="jxr_linenumber" name="L154" href="#L154">154</a> 		}
<a class="jxr_linenumber" name="L155" href="#L155">155</a> 		<strong class="jxr_keyword">if</strong> (getPlainProviders() != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L156" href="#L156">156</a> 			<strong class="jxr_keyword">for</strong> (Object next : getPlainProviders()) {
<a class="jxr_linenumber" name="L157" href="#L157">157</a> 				invokeDestroy(next);
<a class="jxr_linenumber" name="L158" href="#L158">158</a> 			}
<a class="jxr_linenumber" name="L159" href="#L159">159</a> 		}
<a class="jxr_linenumber" name="L160" href="#L160">160</a> 	}
<a class="jxr_linenumber" name="L161" href="#L161">161</a> 
<a class="jxr_linenumber" name="L162" href="#L162">162</a> 	@Override
<a class="jxr_linenumber" name="L163" href="#L163">163</a> 	<strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">void</strong> doDelete(HttpServletRequest request, HttpServletResponse response) <strong class="jxr_keyword">throws</strong> ServletException, IOException {
<a class="jxr_linenumber" name="L164" href="#L164">164</a> 		handleRequest(RequestTypeEnum.DELETE, request, response);
<a class="jxr_linenumber" name="L165" href="#L165">165</a> 	}
<a class="jxr_linenumber" name="L166" href="#L166">166</a> 
<a class="jxr_linenumber" name="L167" href="#L167">167</a> 	@Override
<a class="jxr_linenumber" name="L168" href="#L168">168</a> 	<strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">void</strong> doGet(HttpServletRequest request, HttpServletResponse response) <strong class="jxr_keyword">throws</strong> ServletException, IOException {
<a class="jxr_linenumber" name="L169" href="#L169">169</a> 		handleRequest(RequestTypeEnum.GET, request, response);
<a class="jxr_linenumber" name="L170" href="#L170">170</a> 	}
<a class="jxr_linenumber" name="L171" href="#L171">171</a> 
<a class="jxr_linenumber" name="L172" href="#L172">172</a> 	@Override
<a class="jxr_linenumber" name="L173" href="#L173">173</a> 	<strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">void</strong> doOptions(HttpServletRequest theReq, HttpServletResponse theResp) <strong class="jxr_keyword">throws</strong> ServletException, IOException {
<a class="jxr_linenumber" name="L174" href="#L174">174</a> 		handleRequest(RequestTypeEnum.OPTIONS, theReq, theResp);
<a class="jxr_linenumber" name="L175" href="#L175">175</a> 	}
<a class="jxr_linenumber" name="L176" href="#L176">176</a> 
<a class="jxr_linenumber" name="L177" href="#L177">177</a> 	@Override
<a class="jxr_linenumber" name="L178" href="#L178">178</a> 	<strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">void</strong> doPost(HttpServletRequest request, HttpServletResponse response) <strong class="jxr_keyword">throws</strong> ServletException, IOException {
<a class="jxr_linenumber" name="L179" href="#L179">179</a> 		handleRequest(RequestTypeEnum.POST, request, response);
<a class="jxr_linenumber" name="L180" href="#L180">180</a> 	}
<a class="jxr_linenumber" name="L181" href="#L181">181</a> 
<a class="jxr_linenumber" name="L182" href="#L182">182</a> 	@Override
<a class="jxr_linenumber" name="L183" href="#L183">183</a> 	<strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">void</strong> doPut(HttpServletRequest request, HttpServletResponse response) <strong class="jxr_keyword">throws</strong> ServletException, IOException {
<a class="jxr_linenumber" name="L184" href="#L184">184</a> 		handleRequest(RequestTypeEnum.PUT, request, response);
<a class="jxr_linenumber" name="L185" href="#L185">185</a> 	}
<a class="jxr_linenumber" name="L186" href="#L186">186</a> 
<a class="jxr_linenumber" name="L187" href="#L187">187</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L188" href="#L188">188</a> <em class="jxr_javadoccomment">	 * Count length of URL string, but treating unescaped sequences (e.g. ' ') as their unescaped equivalent (%20)</em>
<a class="jxr_linenumber" name="L189" href="#L189">189</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L190" href="#L190">190</a> 	<strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">int</strong> escapedLength(String theServletPath) {
<a class="jxr_linenumber" name="L191" href="#L191">191</a> 		<strong class="jxr_keyword">int</strong> delta = 0;
<a class="jxr_linenumber" name="L192" href="#L192">192</a> 		<strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> i = 0; i &lt; theServletPath.length(); i++) {
<a class="jxr_linenumber" name="L193" href="#L193">193</a> 			<strong class="jxr_keyword">char</strong> next = theServletPath.charAt(i);
<a class="jxr_linenumber" name="L194" href="#L194">194</a> 			<strong class="jxr_keyword">if</strong> (next == ' ') {
<a class="jxr_linenumber" name="L195" href="#L195">195</a> 				delta = delta + 2;
<a class="jxr_linenumber" name="L196" href="#L196">196</a> 			}
<a class="jxr_linenumber" name="L197" href="#L197">197</a> 		}
<a class="jxr_linenumber" name="L198" href="#L198">198</a> 		<strong class="jxr_keyword">return</strong> theServletPath.length() + delta;
<a class="jxr_linenumber" name="L199" href="#L199">199</a> 	}
<a class="jxr_linenumber" name="L200" href="#L200">200</a> 
<a class="jxr_linenumber" name="L201" href="#L201">201</a> 	<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="L202" href="#L202">202</a> <em class="jxr_comment">	 * Remove registered RESTful methods for a Provider </em>
<a class="jxr_linenumber" name="L203" href="#L203">203</a> <em class="jxr_comment">	 * (and all superclasses) when it is being unregistered</em>
<a class="jxr_linenumber" name="L204" href="#L204">204</a> <em class="jxr_comment">	 */</em>
<a class="jxr_linenumber" name="L205" href="#L205">205</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">void</strong> removeResourceMethods (Object theProvider) <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L206" href="#L206">206</a> 		ourLog.info(<span class="jxr_string">"Removing RESTful methods for: {}"</span>, theProvider.getClass());
<a class="jxr_linenumber" name="L207" href="#L207">207</a> 		Class&lt;?&gt; clazz = theProvider.getClass();
<a class="jxr_linenumber" name="L208" href="#L208">208</a> 		Class&lt;?&gt; supertype = clazz.getSuperclass();
<a class="jxr_linenumber" name="L209" href="#L209">209</a> 		Collection&lt;String&gt; resourceNames = <strong class="jxr_keyword">new</strong> ArrayList&lt;String&gt;();
<a class="jxr_linenumber" name="L210" href="#L210">210</a> 		<strong class="jxr_keyword">while</strong> (!Object.<strong class="jxr_keyword">class</strong>.equals(supertype)) {
<a class="jxr_linenumber" name="L211" href="#L211">211</a> 			removeResourceMethods(theProvider, supertype, resourceNames);
<a class="jxr_linenumber" name="L212" href="#L212">212</a> 			supertype = supertype.getSuperclass();
<a class="jxr_linenumber" name="L213" href="#L213">213</a> 		}
<a class="jxr_linenumber" name="L214" href="#L214">214</a> 		removeResourceMethods(theProvider, clazz, resourceNames);
<a class="jxr_linenumber" name="L215" href="#L215">215</a> 		<strong class="jxr_keyword">for</strong> (String resourceName : resourceNames) {
<a class="jxr_linenumber" name="L216" href="#L216">216</a> 			myResourceNameToBinding.remove(resourceName);
<a class="jxr_linenumber" name="L217" href="#L217">217</a> 		}
<a class="jxr_linenumber" name="L218" href="#L218">218</a> 	}
<a class="jxr_linenumber" name="L219" href="#L219">219</a> 
<a class="jxr_linenumber" name="L220" href="#L220">220</a> 	<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="L221" href="#L221">221</a> <em class="jxr_comment">	 * Collect the set of RESTful methods for a single class</em>
<a class="jxr_linenumber" name="L222" href="#L222">222</a> <em class="jxr_comment">	 * when it is being unregistered</em>
<a class="jxr_linenumber" name="L223" href="#L223">223</a> <em class="jxr_comment">	 */</em>
<a class="jxr_linenumber" name="L224" href="#L224">224</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">void</strong> removeResourceMethods(Object theProvider, Class&lt;?&gt; clazz, Collection&lt;String&gt; resourceNames) <strong class="jxr_keyword">throws</strong> ConfigurationException {
<a class="jxr_linenumber" name="L225" href="#L225">225</a> 		<strong class="jxr_keyword">for</strong> (Method m : ReflectionUtil.getDeclaredMethods(clazz)) {
<a class="jxr_linenumber" name="L226" href="#L226">226</a> 			BaseMethodBinding&lt;?&gt; foundMethodBinding = BaseMethodBinding.bindMethod(m, getFhirContext(), theProvider);
<a class="jxr_linenumber" name="L227" href="#L227">227</a> 			<strong class="jxr_keyword">if</strong> (foundMethodBinding == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L228" href="#L228">228</a> 				<strong class="jxr_keyword">continue</strong>; <em class="jxr_comment">// not a bound method</em>
<a class="jxr_linenumber" name="L229" href="#L229">229</a> 			}
<a class="jxr_linenumber" name="L230" href="#L230">230</a> 			<strong class="jxr_keyword">if</strong> (foundMethodBinding instanceof ConformanceMethodBinding) {
<a class="jxr_linenumber" name="L231" href="#L231">231</a> 				myServerConformanceMethod = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L232" href="#L232">232</a> 				<strong class="jxr_keyword">continue</strong>;
<a class="jxr_linenumber" name="L233" href="#L233">233</a> 			}
<a class="jxr_linenumber" name="L234" href="#L234">234</a> 			String resourceName = foundMethodBinding.getResourceName();
<a class="jxr_linenumber" name="L235" href="#L235">235</a> 			<strong class="jxr_keyword">if</strong> (!resourceNames.contains(resourceName)) {
<a class="jxr_linenumber" name="L236" href="#L236">236</a> 				resourceNames.add(resourceName);
<a class="jxr_linenumber" name="L237" href="#L237">237</a> 			}
<a class="jxr_linenumber" name="L238" href="#L238">238</a> 		}
<a class="jxr_linenumber" name="L239" href="#L239">239</a> 	}
<a class="jxr_linenumber" name="L240" href="#L240">240</a> 
<a class="jxr_linenumber" name="L241" href="#L241">241</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">void</strong> findResourceMethods(Object theProvider) <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L242" href="#L242">242</a> 
<a class="jxr_linenumber" name="L243" href="#L243">243</a> 		ourLog.info(<span class="jxr_string">"Scanning type for RESTful methods: {}"</span>, theProvider.getClass());
<a class="jxr_linenumber" name="L244" href="#L244">244</a> 		<strong class="jxr_keyword">int</strong> count = 0;
<a class="jxr_linenumber" name="L245" href="#L245">245</a> 
<a class="jxr_linenumber" name="L246" href="#L246">246</a> 		Class&lt;?&gt; clazz = theProvider.getClass();
<a class="jxr_linenumber" name="L247" href="#L247">247</a> 		Class&lt;?&gt; supertype = clazz.getSuperclass();
<a class="jxr_linenumber" name="L248" href="#L248">248</a> 		<strong class="jxr_keyword">while</strong> (!Object.<strong class="jxr_keyword">class</strong>.equals(supertype)) {
<a class="jxr_linenumber" name="L249" href="#L249">249</a> 			count += findResourceMethods(theProvider, supertype);
<a class="jxr_linenumber" name="L250" href="#L250">250</a> 			supertype = supertype.getSuperclass();
<a class="jxr_linenumber" name="L251" href="#L251">251</a> 		}
<a class="jxr_linenumber" name="L252" href="#L252">252</a> 
<a class="jxr_linenumber" name="L253" href="#L253">253</a> 		count += findResourceMethods(theProvider, clazz);
<a class="jxr_linenumber" name="L254" href="#L254">254</a> 
<a class="jxr_linenumber" name="L255" href="#L255">255</a> 		<strong class="jxr_keyword">if</strong> (count == 0) {
<a class="jxr_linenumber" name="L256" href="#L256">256</a> 			<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/context/ConfigurationException.html">ConfigurationException</a>(<span class="jxr_string">"Did not find any annotated RESTful methods on provider class "</span> + theProvider.getClass().getCanonicalName());
<a class="jxr_linenumber" name="L257" href="#L257">257</a> 		}
<a class="jxr_linenumber" name="L258" href="#L258">258</a> 	}
<a class="jxr_linenumber" name="L259" href="#L259">259</a> 
<a class="jxr_linenumber" name="L260" href="#L260">260</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">int</strong> findResourceMethods(Object theProvider, Class&lt;?&gt; clazz) <strong class="jxr_keyword">throws</strong> ConfigurationException {
<a class="jxr_linenumber" name="L261" href="#L261">261</a> 		<strong class="jxr_keyword">int</strong> count = 0;
<a class="jxr_linenumber" name="L262" href="#L262">262</a> 
<a class="jxr_linenumber" name="L263" href="#L263">263</a> 		<strong class="jxr_keyword">for</strong> (Method m : ReflectionUtil.getDeclaredMethods(clazz)) {
<a class="jxr_linenumber" name="L264" href="#L264">264</a> 			BaseMethodBinding&lt;?&gt; foundMethodBinding = BaseMethodBinding.bindMethod(m, getFhirContext(), theProvider);
<a class="jxr_linenumber" name="L265" href="#L265">265</a> 			<strong class="jxr_keyword">if</strong> (foundMethodBinding == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L266" href="#L266">266</a> 				<strong class="jxr_keyword">continue</strong>;
<a class="jxr_linenumber" name="L267" href="#L267">267</a> 			}
<a class="jxr_linenumber" name="L268" href="#L268">268</a> 
<a class="jxr_linenumber" name="L269" href="#L269">269</a> 			count++;
<a class="jxr_linenumber" name="L270" href="#L270">270</a> 
<a class="jxr_linenumber" name="L271" href="#L271">271</a> 			<strong class="jxr_keyword">if</strong> (foundMethodBinding instanceof ConformanceMethodBinding) {
<a class="jxr_linenumber" name="L272" href="#L272">272</a> 				myServerConformanceMethod = foundMethodBinding;
<a class="jxr_linenumber" name="L273" href="#L273">273</a> 				<strong class="jxr_keyword">continue</strong>;
<a class="jxr_linenumber" name="L274" href="#L274">274</a> 			}
<a class="jxr_linenumber" name="L275" href="#L275">275</a> 
<a class="jxr_linenumber" name="L276" href="#L276">276</a> 			<strong class="jxr_keyword">if</strong> (!Modifier.isPublic(m.getModifiers())) {
<a class="jxr_linenumber" name="L277" href="#L277">277</a> 				<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/context/ConfigurationException.html">ConfigurationException</a>(<span class="jxr_string">"Method '"</span> + m.getName() + <span class="jxr_string">"' is not public, FHIR RESTful methods must be public"</span>);
<a class="jxr_linenumber" name="L278" href="#L278">278</a> 			} <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="L279" href="#L279">279</a> 				<strong class="jxr_keyword">if</strong> (Modifier.isStatic(m.getModifiers())) {
<a class="jxr_linenumber" name="L280" href="#L280">280</a> 					<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/context/ConfigurationException.html">ConfigurationException</a>(<span class="jxr_string">"Method '"</span> + m.getName() + <span class="jxr_string">"' is static, FHIR RESTful methods must not be static"</span>);
<a class="jxr_linenumber" name="L281" href="#L281">281</a> 				} <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="L282" href="#L282">282</a> 					ourLog.debug(<span class="jxr_string">"Scanning public method: {}#{}"</span>, theProvider.getClass(), m.getName());
<a class="jxr_linenumber" name="L283" href="#L283">283</a> 
<a class="jxr_linenumber" name="L284" href="#L284">284</a> 					String resourceName = foundMethodBinding.getResourceName();
<a class="jxr_linenumber" name="L285" href="#L285">285</a> 					ResourceBinding resourceBinding;
<a class="jxr_linenumber" name="L286" href="#L286">286</a> 					<strong class="jxr_keyword">if</strong> (resourceName == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L287" href="#L287">287</a> 						resourceBinding = myServerBinding;
<a class="jxr_linenumber" name="L288" href="#L288">288</a> 					} <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="L289" href="#L289">289</a> 						RuntimeResourceDefinition definition = getFhirContext().getResourceDefinition(resourceName);
<a class="jxr_linenumber" name="L290" href="#L290">290</a> 						<strong class="jxr_keyword">if</strong> (myResourceNameToBinding.containsKey(definition.getName())) {
<a class="jxr_linenumber" name="L291" href="#L291">291</a> 							resourceBinding = myResourceNameToBinding.get(definition.getName());
<a class="jxr_linenumber" name="L292" href="#L292">292</a> 						} <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="L293" href="#L293">293</a> 							resourceBinding = <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/rest/server/ResourceBinding.html">ResourceBinding</a>();
<a class="jxr_linenumber" name="L294" href="#L294">294</a> 							resourceBinding.setResourceName(resourceName);
<a class="jxr_linenumber" name="L295" href="#L295">295</a> 							myResourceNameToBinding.put(resourceName, resourceBinding);
<a class="jxr_linenumber" name="L296" href="#L296">296</a> 						}
<a class="jxr_linenumber" name="L297" href="#L297">297</a> 					}
<a class="jxr_linenumber" name="L298" href="#L298">298</a> 
<a class="jxr_linenumber" name="L299" href="#L299">299</a> 					List&lt;Class&lt;?&gt;&gt; allowableParams = foundMethodBinding.getAllowableParamAnnotations();
<a class="jxr_linenumber" name="L300" href="#L300">300</a> 					<strong class="jxr_keyword">if</strong> (allowableParams != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L301" href="#L301">301</a> 						<strong class="jxr_keyword">for</strong> (Annotation[] nextParamAnnotations : m.getParameterAnnotations()) {
<a class="jxr_linenumber" name="L302" href="#L302">302</a> 							<strong class="jxr_keyword">for</strong> (Annotation annotation : nextParamAnnotations) {
<a class="jxr_linenumber" name="L303" href="#L303">303</a> 								Package pack = annotation.annotationType().getPackage();
<a class="jxr_linenumber" name="L304" href="#L304">304</a> 								<strong class="jxr_keyword">if</strong> (pack.equals(IdParam.<strong class="jxr_keyword">class</strong>.getPackage())) {
<a class="jxr_linenumber" name="L305" href="#L305">305</a> 									<strong class="jxr_keyword">if</strong> (!allowableParams.contains(annotation.annotationType())) {
<a class="jxr_linenumber" name="L306" href="#L306">306</a> 										<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/context/ConfigurationException.html">ConfigurationException</a>(<span class="jxr_string">"Method["</span> + m.toString() + <span class="jxr_string">"] is not allowed to have a parameter annotated with "</span> + annotation);
<a class="jxr_linenumber" name="L307" href="#L307">307</a> 									}
<a class="jxr_linenumber" name="L308" href="#L308">308</a> 								}
<a class="jxr_linenumber" name="L309" href="#L309">309</a> 							}
<a class="jxr_linenumber" name="L310" href="#L310">310</a> 						}
<a class="jxr_linenumber" name="L311" href="#L311">311</a> 					}
<a class="jxr_linenumber" name="L312" href="#L312">312</a> 
<a class="jxr_linenumber" name="L313" href="#L313">313</a> 					resourceBinding.addMethod(foundMethodBinding);
<a class="jxr_linenumber" name="L314" href="#L314">314</a> 					ourLog.debug(<span class="jxr_string">" * Method: {}#{} is a handler"</span>, theProvider.getClass(), m.getName());
<a class="jxr_linenumber" name="L315" href="#L315">315</a> 				}
<a class="jxr_linenumber" name="L316" href="#L316">316</a> 			}
<a class="jxr_linenumber" name="L317" href="#L317">317</a> 		}
<a class="jxr_linenumber" name="L318" href="#L318">318</a> 
<a class="jxr_linenumber" name="L319" href="#L319">319</a> 		<strong class="jxr_keyword">return</strong> count;
<a class="jxr_linenumber" name="L320" href="#L320">320</a> 	}
<a class="jxr_linenumber" name="L321" href="#L321">321</a> 
<a class="jxr_linenumber" name="L322" href="#L322">322</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L323" href="#L323">323</a> <em class="jxr_javadoccomment">	 * Returns the setting for automatically adding profile tags</em>
<a class="jxr_linenumber" name="L324" href="#L324">324</a> <em class="jxr_javadoccomment">	 *</em>
<a class="jxr_linenumber" name="L325" href="#L325">325</a> <em class="jxr_javadoccomment">	 * @see #setAddProfileTag(AddProfileTagEnum)</em>
<a class="jxr_linenumber" name="L326" href="#L326">326</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L327" href="#L327">327</a> 	<strong class="jxr_keyword">public</strong> <a href="../../../../../ca/uhn/fhir/rest/server/AddProfileTagEnum.html">AddProfileTagEnum</a> getAddProfileTag() {
<a class="jxr_linenumber" name="L328" href="#L328">328</a> 		<strong class="jxr_keyword">return</strong> myAddProfileTag;
<a class="jxr_linenumber" name="L329" href="#L329">329</a> 	}
<a class="jxr_linenumber" name="L330" href="#L330">330</a> 
<a class="jxr_linenumber" name="L331" href="#L331">331</a> 	<strong class="jxr_keyword">public</strong> <a href="../../../../../ca/uhn/fhir/rest/server/BundleInclusionRule.html">BundleInclusionRule</a> getBundleInclusionRule() {
<a class="jxr_linenumber" name="L332" href="#L332">332</a> 		<strong class="jxr_keyword">return</strong> myBundleInclusionRule;
<a class="jxr_linenumber" name="L333" href="#L333">333</a> 	}
<a class="jxr_linenumber" name="L334" href="#L334">334</a> 
<a class="jxr_linenumber" name="L335" href="#L335">335</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L336" href="#L336">336</a> <em class="jxr_javadoccomment">	 * Returns the default encoding to return (XML/JSON) if an incoming request does not specify a preference (either with the &lt;code&gt;_format&lt;/code&gt; URL parameter, or with an &lt;code&gt;Accept&lt;/code&gt; header</em>
<a class="jxr_linenumber" name="L337" href="#L337">337</a> <em class="jxr_javadoccomment">	 * in the request. The default is {@link EncodingEnum#XML}. Will not return null.</em>
<a class="jxr_linenumber" name="L338" href="#L338">338</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L339" href="#L339">339</a> 	<strong class="jxr_keyword">public</strong> <a href="../../../../../ca/uhn/fhir/rest/server/EncodingEnum.html">EncodingEnum</a> getDefaultResponseEncoding() {
<a class="jxr_linenumber" name="L340" href="#L340">340</a> 		<strong class="jxr_keyword">return</strong> myDefaultResponseEncoding;
<a class="jxr_linenumber" name="L341" href="#L341">341</a> 	}
<a class="jxr_linenumber" name="L342" href="#L342">342</a> 
<a class="jxr_linenumber" name="L343" href="#L343">343</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L344" href="#L344">344</a> <em class="jxr_javadoccomment">	 * Returns the server support for ETags (will not be &lt;code&gt;null&lt;/code&gt;). Default is {@link #DEFAULT_ETAG_SUPPORT}</em>
<a class="jxr_linenumber" name="L345" href="#L345">345</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L346" href="#L346">346</a> 	<strong class="jxr_keyword">public</strong> <a href="../../../../../ca/uhn/fhir/rest/server/ETagSupportEnum.html">ETagSupportEnum</a> getETagSupport() {
<a class="jxr_linenumber" name="L347" href="#L347">347</a> 		<strong class="jxr_keyword">return</strong> myETagSupport;
<a class="jxr_linenumber" name="L348" href="#L348">348</a> 	}
<a class="jxr_linenumber" name="L349" href="#L349">349</a> 
<a class="jxr_linenumber" name="L350" href="#L350">350</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L351" href="#L351">351</a> <em class="jxr_javadoccomment">	 * Gets the {@link FhirContext} associated with this server. For efficient processing, resource providers and plain providers should generally use this context if one is needed, as opposed to</em>
<a class="jxr_linenumber" name="L352" href="#L352">352</a> <em class="jxr_javadoccomment">	 * creating their own.</em>
<a class="jxr_linenumber" name="L353" href="#L353">353</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L354" href="#L354">354</a> 	<strong class="jxr_keyword">public</strong> <a href="../../../../../ca/uhn/fhir/context/FhirContext.html">FhirContext</a> getFhirContext() {
<a class="jxr_linenumber" name="L355" href="#L355">355</a> 		<strong class="jxr_keyword">if</strong> (myFhirContext == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L356" href="#L356">356</a> 			myFhirContext = <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/context/FhirContext.html">FhirContext</a>();
<a class="jxr_linenumber" name="L357" href="#L357">357</a> 		}
<a class="jxr_linenumber" name="L358" href="#L358">358</a> 		<strong class="jxr_keyword">return</strong> myFhirContext;
<a class="jxr_linenumber" name="L359" href="#L359">359</a> 	}
<a class="jxr_linenumber" name="L360" href="#L360">360</a> 
<a class="jxr_linenumber" name="L361" href="#L361">361</a> 	<strong class="jxr_keyword">public</strong> String getImplementationDescription() {
<a class="jxr_linenumber" name="L362" href="#L362">362</a> 		<strong class="jxr_keyword">return</strong> myImplementationDescription;
<a class="jxr_linenumber" name="L363" href="#L363">363</a> 	}
<a class="jxr_linenumber" name="L364" href="#L364">364</a> 
<a class="jxr_linenumber" name="L365" href="#L365">365</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L366" href="#L366">366</a> <em class="jxr_javadoccomment">	 * Returns a ist of all registered server interceptors</em>
<a class="jxr_linenumber" name="L367" href="#L367">367</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L368" href="#L368">368</a> 	<strong class="jxr_keyword">public</strong> List&lt;IServerInterceptor&gt; getInterceptors() {
<a class="jxr_linenumber" name="L369" href="#L369">369</a> 		<strong class="jxr_keyword">return</strong> Collections.unmodifiableList(myInterceptors);
<a class="jxr_linenumber" name="L370" href="#L370">370</a> 	}
<a class="jxr_linenumber" name="L371" href="#L371">371</a> 
<a class="jxr_linenumber" name="L372" href="#L372">372</a> 	<strong class="jxr_keyword">public</strong> <a href="../../../../../ca/uhn/fhir/rest/server/IPagingProvider.html">IPagingProvider</a> getPagingProvider() {
<a class="jxr_linenumber" name="L373" href="#L373">373</a> 		<strong class="jxr_keyword">return</strong> myPagingProvider;
<a class="jxr_linenumber" name="L374" href="#L374">374</a> 	}
<a class="jxr_linenumber" name="L375" href="#L375">375</a> 
<a class="jxr_linenumber" name="L376" href="#L376">376</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L377" href="#L377">377</a> <em class="jxr_javadoccomment">	 * Provides the non-resource specific providers which implement method calls on this server</em>
<a class="jxr_linenumber" name="L378" href="#L378">378</a> <em class="jxr_javadoccomment">	 *</em>
<a class="jxr_linenumber" name="L379" href="#L379">379</a> <em class="jxr_javadoccomment">	 * @see #getResourceProviders()</em>
<a class="jxr_linenumber" name="L380" href="#L380">380</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L381" href="#L381">381</a> 	<strong class="jxr_keyword">public</strong> Collection&lt;Object&gt; getPlainProviders() {
<a class="jxr_linenumber" name="L382" href="#L382">382</a> 		<strong class="jxr_keyword">return</strong> myPlainProviders;
<a class="jxr_linenumber" name="L383" href="#L383">383</a> 	}
<a class="jxr_linenumber" name="L384" href="#L384">384</a> 
<a class="jxr_linenumber" name="L385" href="#L385">385</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L386" href="#L386">386</a> <em class="jxr_javadoccomment">	 * Allows users of RestfulServer to override the getRequestPath method to let them build their custom request path implementation</em>
<a class="jxr_linenumber" name="L387" href="#L387">387</a> <em class="jxr_javadoccomment">	 *</em>
<a class="jxr_linenumber" name="L388" href="#L388">388</a> <em class="jxr_javadoccomment">	 * @param requestFullPath</em>
<a class="jxr_linenumber" name="L389" href="#L389">389</a> <em class="jxr_javadoccomment">	 *           the full request path</em>
<a class="jxr_linenumber" name="L390" href="#L390">390</a> <em class="jxr_javadoccomment">	 * @param servletContextPath</em>
<a class="jxr_linenumber" name="L391" href="#L391">391</a> <em class="jxr_javadoccomment">	 *           the servelet context path</em>
<a class="jxr_linenumber" name="L392" href="#L392">392</a> <em class="jxr_javadoccomment">	 * @param servletPath</em>
<a class="jxr_linenumber" name="L393" href="#L393">393</a> <em class="jxr_javadoccomment">	 *           the servelet path</em>
<a class="jxr_linenumber" name="L394" href="#L394">394</a> <em class="jxr_javadoccomment">	 * @return created resource path</em>
<a class="jxr_linenumber" name="L395" href="#L395">395</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L396" href="#L396">396</a> 	<strong class="jxr_keyword">protected</strong> String getRequestPath(String requestFullPath, String servletContextPath, String servletPath) {
<a class="jxr_linenumber" name="L397" href="#L397">397</a> 		<strong class="jxr_keyword">return</strong> requestFullPath.substring(escapedLength(servletContextPath) + escapedLength(servletPath));
<a class="jxr_linenumber" name="L398" href="#L398">398</a> 	}
<a class="jxr_linenumber" name="L399" href="#L399">399</a> 
<a class="jxr_linenumber" name="L400" href="#L400">400</a> 	<strong class="jxr_keyword">public</strong> Collection&lt;ResourceBinding&gt; getResourceBindings() {
<a class="jxr_linenumber" name="L401" href="#L401">401</a> 		<strong class="jxr_keyword">return</strong> myResourceNameToBinding.values();
<a class="jxr_linenumber" name="L402" href="#L402">402</a> 	}
<a class="jxr_linenumber" name="L403" href="#L403">403</a> 
<a class="jxr_linenumber" name="L404" href="#L404">404</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L405" href="#L405">405</a> <em class="jxr_javadoccomment">	 * Provides the resource providers for this server</em>
<a class="jxr_linenumber" name="L406" href="#L406">406</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L407" href="#L407">407</a> 	<strong class="jxr_keyword">public</strong> Collection&lt;IResourceProvider&gt; getResourceProviders() {
<a class="jxr_linenumber" name="L408" href="#L408">408</a> 		<strong class="jxr_keyword">return</strong> myResourceProviders;
<a class="jxr_linenumber" name="L409" href="#L409">409</a> 	}
<a class="jxr_linenumber" name="L410" href="#L410">410</a> 
<a class="jxr_linenumber" name="L411" href="#L411">411</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L412" href="#L412">412</a> <em class="jxr_javadoccomment">	 * Get the server address strategy, which is used to determine what base URL to provide clients to refer to this server. Defaults to an instance of {@link IncomingRequestAddressStrategy}</em>
<a class="jxr_linenumber" name="L413" href="#L413">413</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L414" href="#L414">414</a> 	<strong class="jxr_keyword">public</strong> <a href="../../../../../ca/uhn/fhir/rest/server/IServerAddressStrategy.html">IServerAddressStrategy</a> getServerAddressStrategy() {
<a class="jxr_linenumber" name="L415" href="#L415">415</a> 		<strong class="jxr_keyword">return</strong> myServerAddressStrategy;
<a class="jxr_linenumber" name="L416" href="#L416">416</a> 	}
<a class="jxr_linenumber" name="L417" href="#L417">417</a> 
<a class="jxr_linenumber" name="L418" href="#L418">418</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L419" href="#L419">419</a> <em class="jxr_javadoccomment">	 * Returns the server base URL (with no trailing '/') for a given request</em>
<a class="jxr_linenumber" name="L420" href="#L420">420</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L421" href="#L421">421</a> 	<strong class="jxr_keyword">public</strong> String getServerBaseForRequest(HttpServletRequest theRequest) {
<a class="jxr_linenumber" name="L422" href="#L422">422</a> 		String fhirServerBase;
<a class="jxr_linenumber" name="L423" href="#L423">423</a> 		fhirServerBase = myServerAddressStrategy.determineServerBase(getServletContext(), theRequest);
<a class="jxr_linenumber" name="L424" href="#L424">424</a> 
<a class="jxr_linenumber" name="L425" href="#L425">425</a> 		<strong class="jxr_keyword">if</strong> (fhirServerBase.endsWith(<span class="jxr_string">"/"</span>)) {
<a class="jxr_linenumber" name="L426" href="#L426">426</a> 			fhirServerBase = fhirServerBase.substring(0, fhirServerBase.length() - 1);
<a class="jxr_linenumber" name="L427" href="#L427">427</a> 		}
<a class="jxr_linenumber" name="L428" href="#L428">428</a> 		<strong class="jxr_keyword">return</strong> fhirServerBase;
<a class="jxr_linenumber" name="L429" href="#L429">429</a> 	}
<a class="jxr_linenumber" name="L430" href="#L430">430</a> 
<a class="jxr_linenumber" name="L431" href="#L431">431</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L432" href="#L432">432</a> <em class="jxr_javadoccomment">	 * Returns the method bindings for this server which are not specific to any particular resource type. This method is internal to HAPI and developers generally do not need to interact with it. Use</em>
<a class="jxr_linenumber" name="L433" href="#L433">433</a> <em class="jxr_javadoccomment">	 * with caution, as it may change.</em>
<a class="jxr_linenumber" name="L434" href="#L434">434</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L435" href="#L435">435</a> 	<strong class="jxr_keyword">public</strong> List&lt;BaseMethodBinding&lt;?&gt;&gt; getServerBindings() {
<a class="jxr_linenumber" name="L436" href="#L436">436</a> 		<strong class="jxr_keyword">return</strong> myServerBinding.getMethodBindings();
<a class="jxr_linenumber" name="L437" href="#L437">437</a> 	}
<a class="jxr_linenumber" name="L438" href="#L438">438</a> 
<a class="jxr_linenumber" name="L439" href="#L439">439</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L440" href="#L440">440</a> <em class="jxr_javadoccomment">	 * Returns the server conformance provider, which is the provider that is used to generate the server's conformance (metadata) statement if one has been explicitly defined.</em>
<a class="jxr_linenumber" name="L441" href="#L441">441</a> <em class="jxr_javadoccomment">	 * &lt;p&gt;</em>
<a class="jxr_linenumber" name="L442" href="#L442">442</a> <em class="jxr_javadoccomment">	 * By default, the ServerConformanceProvider for the declared version of FHIR is used, but this can be changed, or set to &lt;code&gt;null&lt;/code&gt; to use the appropriate one for the given FHIR version.</em>
<a class="jxr_linenumber" name="L443" href="#L443">443</a> <em class="jxr_javadoccomment">	 * &lt;/p&gt;</em>
<a class="jxr_linenumber" name="L444" href="#L444">444</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L445" href="#L445">445</a> 	<strong class="jxr_keyword">public</strong> Object getServerConformanceProvider() {
<a class="jxr_linenumber" name="L446" href="#L446">446</a> 		<strong class="jxr_keyword">return</strong> myServerConformanceProvider;
<a class="jxr_linenumber" name="L447" href="#L447">447</a> 	}
<a class="jxr_linenumber" name="L448" href="#L448">448</a> 
<a class="jxr_linenumber" name="L449" href="#L449">449</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L450" href="#L450">450</a> <em class="jxr_javadoccomment">	 * Gets the server's name, as exported in conformance profiles exported by the server. This is informational only, but can be helpful to set with something appropriate.</em>
<a class="jxr_linenumber" name="L451" href="#L451">451</a> <em class="jxr_javadoccomment">	 *</em>
<a class="jxr_linenumber" name="L452" href="#L452">452</a> <em class="jxr_javadoccomment">	 * @see RestfulServer#setServerName(String)</em>
<a class="jxr_linenumber" name="L453" href="#L453">453</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L454" href="#L454">454</a> 	<strong class="jxr_keyword">public</strong> String getServerName() {
<a class="jxr_linenumber" name="L455" href="#L455">455</a> 		<strong class="jxr_keyword">return</strong> myServerName;
<a class="jxr_linenumber" name="L456" href="#L456">456</a> 	}
<a class="jxr_linenumber" name="L457" href="#L457">457</a> 
<a class="jxr_linenumber" name="L458" href="#L458">458</a> 	<strong class="jxr_keyword">public</strong> <a href="../../../../../ca/uhn/fhir/rest/server/IResourceProvider.html">IResourceProvider</a> getServerProfilesProvider() {
<a class="jxr_linenumber" name="L459" href="#L459">459</a> 		<strong class="jxr_keyword">return</strong> getFhirContext().getVersion().createServerProfilesProvider(<strong class="jxr_keyword">this</strong>);
<a class="jxr_linenumber" name="L460" href="#L460">460</a> 	}
<a class="jxr_linenumber" name="L461" href="#L461">461</a> 
<a class="jxr_linenumber" name="L462" href="#L462">462</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L463" href="#L463">463</a> <em class="jxr_javadoccomment">	 * Gets the server's version, as exported in conformance profiles exported by the server. This is informational only, but can be helpful to set with something appropriate.</em>
<a class="jxr_linenumber" name="L464" href="#L464">464</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L465" href="#L465">465</a> 	<strong class="jxr_keyword">public</strong> String getServerVersion() {
<a class="jxr_linenumber" name="L466" href="#L466">466</a> 		<strong class="jxr_keyword">return</strong> myServerVersion;
<a class="jxr_linenumber" name="L467" href="#L467">467</a> 	}
<a class="jxr_linenumber" name="L468" href="#L468">468</a> 
<a class="jxr_linenumber" name="L469" href="#L469">469</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">void</strong> handlePagingRequest(<a href="../../../../../ca/uhn/fhir/rest/method/RequestDetails.html">RequestDetails</a> theRequest, HttpServletResponse theResponse, String thePagingAction) <strong class="jxr_keyword">throws</strong> IOException {
<a class="jxr_linenumber" name="L470" href="#L470">470</a> 		IBundleProvider resultList = getPagingProvider().retrieveResultList(thePagingAction);
<a class="jxr_linenumber" name="L471" href="#L471">471</a> 		<strong class="jxr_keyword">if</strong> (resultList == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L472" href="#L472">472</a> 			ourLog.info(<span class="jxr_string">"Client requested unknown paging ID[{}]"</span>, thePagingAction);
<a class="jxr_linenumber" name="L473" href="#L473">473</a> 			theResponse.setStatus(Constants.STATUS_HTTP_410_GONE);
<a class="jxr_linenumber" name="L474" href="#L474">474</a> 			addHeadersToResponse(theResponse);
<a class="jxr_linenumber" name="L475" href="#L475">475</a> 			theResponse.setContentType(<span class="jxr_string">"text/plain"</span>);
<a class="jxr_linenumber" name="L476" href="#L476">476</a> 			theResponse.setCharacterEncoding(<span class="jxr_string">"UTF-8"</span>);
<a class="jxr_linenumber" name="L477" href="#L477">477</a> 			theResponse.getWriter().append(<span class="jxr_string">"Search ID["</span> + thePagingAction + <span class="jxr_string">"] does not exist and may have expired."</span>);
<a class="jxr_linenumber" name="L478" href="#L478">478</a> 			theResponse.getWriter().close();
<a class="jxr_linenumber" name="L479" href="#L479">479</a> 			<strong class="jxr_keyword">return</strong>;
<a class="jxr_linenumber" name="L480" href="#L480">480</a> 		}
<a class="jxr_linenumber" name="L481" href="#L481">481</a> 
<a class="jxr_linenumber" name="L482" href="#L482">482</a> 		Integer count = RestfulServerUtils.extractCountParameter(theRequest);
<a class="jxr_linenumber" name="L483" href="#L483">483</a> 		<strong class="jxr_keyword">if</strong> (count == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L484" href="#L484">484</a> 			count = getPagingProvider().getDefaultPageSize();
<a class="jxr_linenumber" name="L485" href="#L485">485</a> 		} <strong class="jxr_keyword">else</strong> <strong class="jxr_keyword">if</strong> (count &gt; getPagingProvider().getMaximumPageSize()) {
<a class="jxr_linenumber" name="L486" href="#L486">486</a> 			count = getPagingProvider().getMaximumPageSize();
<a class="jxr_linenumber" name="L487" href="#L487">487</a> 		}
<a class="jxr_linenumber" name="L488" href="#L488">488</a> 
<a class="jxr_linenumber" name="L489" href="#L489">489</a> 		Integer offsetI = RestfulServerUtils.tryToExtractNamedParameter(theRequest, Constants.PARAM_PAGINGOFFSET);
<a class="jxr_linenumber" name="L490" href="#L490">490</a> 		<strong class="jxr_keyword">if</strong> (offsetI == <strong class="jxr_keyword">null</strong> || offsetI &lt; 0) {
<a class="jxr_linenumber" name="L491" href="#L491">491</a> 			offsetI = 0;
<a class="jxr_linenumber" name="L492" href="#L492">492</a> 		}
<a class="jxr_linenumber" name="L493" href="#L493">493</a> 
<a class="jxr_linenumber" name="L494" href="#L494">494</a> 		<strong class="jxr_keyword">int</strong> start = Math.min(offsetI, resultList.size() - 1);
<a class="jxr_linenumber" name="L495" href="#L495">495</a> 
<a class="jxr_linenumber" name="L496" href="#L496">496</a> 		EncodingEnum responseEncoding = RestfulServerUtils.determineResponseEncodingNoDefault(theRequest.getServletRequest(), getDefaultResponseEncoding());
<a class="jxr_linenumber" name="L497" href="#L497">497</a> 		<strong class="jxr_keyword">boolean</strong> prettyPrint = RestfulServerUtils.prettyPrintResponse(<strong class="jxr_keyword">this</strong>, theRequest);
<a class="jxr_linenumber" name="L498" href="#L498">498</a> 		<strong class="jxr_keyword">boolean</strong> requestIsBrowser = requestIsBrowser(theRequest.getServletRequest());
<a class="jxr_linenumber" name="L499" href="#L499">499</a> 		Set&lt;SummaryEnum&gt; summaryMode = RestfulServerUtils.determineSummaryMode(theRequest);
<a class="jxr_linenumber" name="L500" href="#L500">500</a> 		<strong class="jxr_keyword">boolean</strong> respondGzip = theRequest.isRespondGzip();
<a class="jxr_linenumber" name="L501" href="#L501">501</a> 
<a class="jxr_linenumber" name="L502" href="#L502">502</a> 		IVersionSpecificBundleFactory bundleFactory = getFhirContext().newBundleFactory();
<a class="jxr_linenumber" name="L503" href="#L503">503</a> 
<a class="jxr_linenumber" name="L504" href="#L504">504</a> 		Set&lt;Include&gt; includes = <strong class="jxr_keyword">new</strong> HashSet&lt;Include&gt;();
<a class="jxr_linenumber" name="L505" href="#L505">505</a> 		String[] reqIncludes = theRequest.getServletRequest().getParameterValues(Constants.PARAM_INCLUDE);
<a class="jxr_linenumber" name="L506" href="#L506">506</a> 		<strong class="jxr_keyword">if</strong> (reqIncludes != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L507" href="#L507">507</a> 			<strong class="jxr_keyword">for</strong> (String nextInclude : reqIncludes) {
<a class="jxr_linenumber" name="L508" href="#L508">508</a> 				includes.add(<strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/model/api/Include.html">Include</a>(nextInclude));
<a class="jxr_linenumber" name="L509" href="#L509">509</a> 			}
<a class="jxr_linenumber" name="L510" href="#L510">510</a> 		}
<a class="jxr_linenumber" name="L511" href="#L511">511</a> 
<a class="jxr_linenumber" name="L512" href="#L512">512</a> 		String linkSelfBase = getServerAddressStrategy().determineServerBase(getServletContext(), theRequest.getServletRequest());
<a class="jxr_linenumber" name="L513" href="#L513">513</a> 		String linkSelf = linkSelfBase + theRequest.getCompleteUrl().substring(theRequest.getCompleteUrl().indexOf('?'));
<a class="jxr_linenumber" name="L514" href="#L514">514</a> 
<a class="jxr_linenumber" name="L515" href="#L515">515</a> 		BundleTypeEnum bundleType = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L516" href="#L516">516</a> 		String[] bundleTypeValues = theRequest.getParameters().get(Constants.PARAM_BUNDLETYPE);
<a class="jxr_linenumber" name="L517" href="#L517">517</a> 		<strong class="jxr_keyword">if</strong> (bundleTypeValues != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L518" href="#L518">518</a> 			bundleType = BundleTypeEnum.VALUESET_BINDER.fromCodeString(bundleTypeValues[0]);
<a class="jxr_linenumber" name="L519" href="#L519">519</a> 		}
<a class="jxr_linenumber" name="L520" href="#L520">520</a> 		
<a class="jxr_linenumber" name="L521" href="#L521">521</a> 		bundleFactory.initializeBundleFromBundleProvider(<strong class="jxr_keyword">this</strong>, resultList, responseEncoding, theRequest.getFhirServerBase(), linkSelf, prettyPrint, start, count, thePagingAction, bundleType, includes);
<a class="jxr_linenumber" name="L522" href="#L522">522</a> 
<a class="jxr_linenumber" name="L523" href="#L523">523</a> 		Bundle bundle = bundleFactory.getDstu1Bundle();
<a class="jxr_linenumber" name="L524" href="#L524">524</a> 		<strong class="jxr_keyword">if</strong> (bundle != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L525" href="#L525">525</a> 			<strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> i = getInterceptors().size() - 1; i &gt;= 0; i--) {
<a class="jxr_linenumber" name="L526" href="#L526">526</a> 				IServerInterceptor next = getInterceptors().get(i);
<a class="jxr_linenumber" name="L527" href="#L527">527</a> 				<strong class="jxr_keyword">boolean</strong> continueProcessing = next.outgoingResponse(theRequest, bundle, theRequest.getServletRequest(), theRequest.getServletResponse());
<a class="jxr_linenumber" name="L528" href="#L528">528</a> 				<strong class="jxr_keyword">if</strong> (!continueProcessing) {
<a class="jxr_linenumber" name="L529" href="#L529">529</a> 					ourLog.debug(<span class="jxr_string">"Interceptor {} returned false, not continuing processing"</span>);
<a class="jxr_linenumber" name="L530" href="#L530">530</a> 					<strong class="jxr_keyword">return</strong>;
<a class="jxr_linenumber" name="L531" href="#L531">531</a> 				}
<a class="jxr_linenumber" name="L532" href="#L532">532</a> 			}
<a class="jxr_linenumber" name="L533" href="#L533">533</a> 			RestfulServerUtils.streamResponseAsBundle(<strong class="jxr_keyword">this</strong>, theResponse, bundle, theRequest.getFhirServerBase(), summaryMode, respondGzip, requestIsBrowser, theRequest);
<a class="jxr_linenumber" name="L534" href="#L534">534</a> 		} <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="L535" href="#L535">535</a> 			IBaseResource resBundle = bundleFactory.getResourceBundle();
<a class="jxr_linenumber" name="L536" href="#L536">536</a> 			<strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> i = getInterceptors().size() - 1; i &gt;= 0; i--) {
<a class="jxr_linenumber" name="L537" href="#L537">537</a> 				IServerInterceptor next = getInterceptors().get(i);
<a class="jxr_linenumber" name="L538" href="#L538">538</a> 				<strong class="jxr_keyword">boolean</strong> continueProcessing = next.outgoingResponse(theRequest, resBundle, theRequest.getServletRequest(), theRequest.getServletResponse());
<a class="jxr_linenumber" name="L539" href="#L539">539</a> 				<strong class="jxr_keyword">if</strong> (!continueProcessing) {
<a class="jxr_linenumber" name="L540" href="#L540">540</a> 					ourLog.debug(<span class="jxr_string">"Interceptor {} returned false, not continuing processing"</span>);
<a class="jxr_linenumber" name="L541" href="#L541">541</a> 					<strong class="jxr_keyword">return</strong>;
<a class="jxr_linenumber" name="L542" href="#L542">542</a> 				}
<a class="jxr_linenumber" name="L543" href="#L543">543</a> 			}
<a class="jxr_linenumber" name="L544" href="#L544">544</a> 			RestfulServerUtils.streamResponseAsResource(<strong class="jxr_keyword">this</strong>, theResponse, resBundle, prettyPrint, summaryMode, Constants.STATUS_HTTP_200_OK, theRequest.isRespondGzip(), false, theRequest);
<a class="jxr_linenumber" name="L545" href="#L545">545</a> 		}
<a class="jxr_linenumber" name="L546" href="#L546">546</a> 	}
<a class="jxr_linenumber" name="L547" href="#L547">547</a> 
<a class="jxr_linenumber" name="L548" href="#L548">548</a> 	<strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">void</strong> handleRequest(<a href="../../../../../ca/uhn/fhir/rest/api/RequestTypeEnum.html">RequestTypeEnum</a> theRequestType, HttpServletRequest theRequest, HttpServletResponse theResponse) <strong class="jxr_keyword">throws</strong> ServletException, IOException {
<a class="jxr_linenumber" name="L549" href="#L549">549</a> 		String fhirServerBase = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L550" href="#L550">550</a> 		<strong class="jxr_keyword">boolean</strong> requestIsBrowser = requestIsBrowser(theRequest);
<a class="jxr_linenumber" name="L551" href="#L551">551</a> 		RequestDetails requestDetails = <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/rest/method/RequestDetails.html">RequestDetails</a>();
<a class="jxr_linenumber" name="L552" href="#L552">552</a> 		requestDetails.setServer(<strong class="jxr_keyword">this</strong>);
<a class="jxr_linenumber" name="L553" href="#L553">553</a> 		requestDetails.setRequestType(theRequestType);
<a class="jxr_linenumber" name="L554" href="#L554">554</a> 		requestDetails.setServletRequest(theRequest);
<a class="jxr_linenumber" name="L555" href="#L555">555</a> 		requestDetails.setServletResponse(theResponse);
<a class="jxr_linenumber" name="L556" href="#L556">556</a> 		<strong class="jxr_keyword">for</strong> (Enumeration&lt;String&gt; iter = theRequest.getHeaderNames(); iter.hasMoreElements(); ) {
<a class="jxr_linenumber" name="L557" href="#L557">557</a> 			String nextName = iter.nextElement();
<a class="jxr_linenumber" name="L558" href="#L558">558</a> 			<strong class="jxr_keyword">for</strong> (Enumeration&lt;String&gt; valueIter = theRequest.getHeaders(nextName); valueIter.hasMoreElements();) {
<a class="jxr_linenumber" name="L559" href="#L559">559</a> 				requestDetails.addHeader(nextName, valueIter.nextElement());
<a class="jxr_linenumber" name="L560" href="#L560">560</a> 			}
<a class="jxr_linenumber" name="L561" href="#L561">561</a> 		}
<a class="jxr_linenumber" name="L562" href="#L562">562</a> 
<a class="jxr_linenumber" name="L563" href="#L563">563</a> 		<strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L564" href="#L564">564</a> 
<a class="jxr_linenumber" name="L565" href="#L565">565</a> 			<strong class="jxr_keyword">for</strong> (IServerInterceptor next : myInterceptors) {
<a class="jxr_linenumber" name="L566" href="#L566">566</a> 				<strong class="jxr_keyword">boolean</strong> continueProcessing = next.incomingRequestPreProcessed(theRequest, theResponse);
<a class="jxr_linenumber" name="L567" href="#L567">567</a> 				<strong class="jxr_keyword">if</strong> (!continueProcessing) {
<a class="jxr_linenumber" name="L568" href="#L568">568</a> 					ourLog.debug(<span class="jxr_string">"Interceptor {} returned false, not continuing processing"</span>);
<a class="jxr_linenumber" name="L569" href="#L569">569</a> 					<strong class="jxr_keyword">return</strong>;
<a class="jxr_linenumber" name="L570" href="#L570">570</a> 				}
<a class="jxr_linenumber" name="L571" href="#L571">571</a> 			}
<a class="jxr_linenumber" name="L572" href="#L572">572</a> 
<a class="jxr_linenumber" name="L573" href="#L573">573</a> 			String requestFullPath = StringUtils.defaultString(theRequest.getRequestURI());
<a class="jxr_linenumber" name="L574" href="#L574">574</a> 			String servletPath = StringUtils.defaultString(theRequest.getServletPath());
<a class="jxr_linenumber" name="L575" href="#L575">575</a> 			StringBuffer requestUrl = theRequest.getRequestURL();
<a class="jxr_linenumber" name="L576" href="#L576">576</a> 			String servletContextPath = IncomingRequestAddressStrategy.determineServletContextPath(theRequest, <strong class="jxr_keyword">this</strong>);
<a class="jxr_linenumber" name="L577" href="#L577">577</a> 
<a class="jxr_linenumber" name="L578" href="#L578">578</a> 			<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="L579" href="#L579">579</a> <em class="jxr_comment">			 * Just for debugging..</em>
<a class="jxr_linenumber" name="L580" href="#L580">580</a> <em class="jxr_comment">			 */</em>
<a class="jxr_linenumber" name="L581" href="#L581">581</a> 			<strong class="jxr_keyword">if</strong> (ourLog.isTraceEnabled()) {
<a class="jxr_linenumber" name="L582" href="#L582">582</a> 				ourLog.trace(<span class="jxr_string">"Request FullPath: {}"</span>, requestFullPath);
<a class="jxr_linenumber" name="L583" href="#L583">583</a> 				ourLog.trace(<span class="jxr_string">"Servlet Path: {}"</span>, servletPath);
<a class="jxr_linenumber" name="L584" href="#L584">584</a> 				ourLog.trace(<span class="jxr_string">"Request Url: {}"</span>, requestUrl);
<a class="jxr_linenumber" name="L585" href="#L585">585</a> 				ourLog.trace(<span class="jxr_string">"Context Path: {}"</span>, servletContextPath);
<a class="jxr_linenumber" name="L586" href="#L586">586</a> 			}
<a class="jxr_linenumber" name="L587" href="#L587">587</a> 
<a class="jxr_linenumber" name="L588" href="#L588">588</a> 			
<a class="jxr_linenumber" name="L589" href="#L589">589</a> 			String requestPath = getRequestPath(requestFullPath, servletContextPath, servletPath);
<a class="jxr_linenumber" name="L590" href="#L590">590</a> 
<a class="jxr_linenumber" name="L591" href="#L591">591</a> 			<strong class="jxr_keyword">if</strong> (requestPath.length() &gt; 0 &amp;&amp; requestPath.charAt(0) == '/') {
<a class="jxr_linenumber" name="L592" href="#L592">592</a> 				requestPath = requestPath.substring(1);
<a class="jxr_linenumber" name="L593" href="#L593">593</a> 			}
<a class="jxr_linenumber" name="L594" href="#L594">594</a> 
<a class="jxr_linenumber" name="L595" href="#L595">595</a> 			fhirServerBase = getServerBaseForRequest(theRequest);
<a class="jxr_linenumber" name="L596" href="#L596">596</a> 
<a class="jxr_linenumber" name="L597" href="#L597">597</a> 			String completeUrl = StringUtils.isNotBlank(theRequest.getQueryString()) ? requestUrl + <span class="jxr_string">"?"</span> + theRequest.getQueryString() : requestUrl.toString();
<a class="jxr_linenumber" name="L598" href="#L598">598</a> 
<a class="jxr_linenumber" name="L599" href="#L599">599</a> 			Map&lt;String, String[]&gt; params = <strong class="jxr_keyword">new</strong> HashMap&lt;String, String[]&gt;(theRequest.getParameterMap());
<a class="jxr_linenumber" name="L600" href="#L600">600</a> 			requestDetails.setParameters(params);
<a class="jxr_linenumber" name="L601" href="#L601">601</a> 
<a class="jxr_linenumber" name="L602" href="#L602">602</a> 			IdDt id;
<a class="jxr_linenumber" name="L603" href="#L603">603</a> 			populateRequestDetailsFromRequestPath(requestDetails, requestPath);
<a class="jxr_linenumber" name="L604" href="#L604">604</a> 
<a class="jxr_linenumber" name="L605" href="#L605">605</a> 			<strong class="jxr_keyword">if</strong> (theRequestType == RequestTypeEnum.PUT) {
<a class="jxr_linenumber" name="L606" href="#L606">606</a> 				String contentLocation = theRequest.getHeader(Constants.HEADER_CONTENT_LOCATION);
<a class="jxr_linenumber" name="L607" href="#L607">607</a> 				<strong class="jxr_keyword">if</strong> (contentLocation != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L608" href="#L608">608</a> 					id = <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/model/primitive/IdDt.html">IdDt</a>(contentLocation);
<a class="jxr_linenumber" name="L609" href="#L609">609</a> 					requestDetails.setId(id);
<a class="jxr_linenumber" name="L610" href="#L610">610</a> 				}
<a class="jxr_linenumber" name="L611" href="#L611">611</a> 			}
<a class="jxr_linenumber" name="L612" href="#L612">612</a> 
<a class="jxr_linenumber" name="L613" href="#L613">613</a> 			String acceptEncoding = theRequest.getHeader(Constants.HEADER_ACCEPT_ENCODING);
<a class="jxr_linenumber" name="L614" href="#L614">614</a> 			<strong class="jxr_keyword">boolean</strong> respondGzip = false;
<a class="jxr_linenumber" name="L615" href="#L615">615</a> 			<strong class="jxr_keyword">if</strong> (acceptEncoding != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L616" href="#L616">616</a> 				String[] parts = acceptEncoding.trim().split(<span class="jxr_string">"&#92;&#92;s*,&#92;&#92;s*"</span>);
<a class="jxr_linenumber" name="L617" href="#L617">617</a> 				<strong class="jxr_keyword">for</strong> (String string : parts) {
<a class="jxr_linenumber" name="L618" href="#L618">618</a> 					<strong class="jxr_keyword">if</strong> (string.equals(<span class="jxr_string">"gzip"</span>)) {
<a class="jxr_linenumber" name="L619" href="#L619">619</a> 						respondGzip = <strong class="jxr_keyword">true</strong>;
<a class="jxr_linenumber" name="L620" href="#L620">620</a> 					}
<a class="jxr_linenumber" name="L621" href="#L621">621</a> 				}
<a class="jxr_linenumber" name="L622" href="#L622">622</a> 			}
<a class="jxr_linenumber" name="L623" href="#L623">623</a> 			requestDetails.setRespondGzip(respondGzip);
<a class="jxr_linenumber" name="L624" href="#L624">624</a> 			requestDetails.setRequestPath(requestPath);
<a class="jxr_linenumber" name="L625" href="#L625">625</a> 			requestDetails.setFhirServerBase(fhirServerBase);
<a class="jxr_linenumber" name="L626" href="#L626">626</a> 			requestDetails.setCompleteUrl(completeUrl);
<a class="jxr_linenumber" name="L627" href="#L627">627</a> 
<a class="jxr_linenumber" name="L628" href="#L628">628</a> 			String pagingAction = theRequest.getParameter(Constants.PARAM_PAGINGACTION);
<a class="jxr_linenumber" name="L629" href="#L629">629</a> 			<strong class="jxr_keyword">if</strong> (getPagingProvider() != <strong class="jxr_keyword">null</strong> &amp;&amp; isNotBlank(pagingAction)) {
<a class="jxr_linenumber" name="L630" href="#L630">630</a> 				requestDetails.setRestOperationType(RestOperationTypeEnum.GET_PAGE);
<a class="jxr_linenumber" name="L631" href="#L631">631</a> 				<strong class="jxr_keyword">if</strong> (theRequestType != RequestTypeEnum.GET) {
<a class="jxr_linenumber" name="L632" href="#L632">632</a> 					<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="L633" href="#L633">633</a> <em class="jxr_comment">					 * We reconstruct the link-self URL using the request parameters, and this would break if the parameters came in using a POST. We could probably work around that but why bother unless</em>
<a class="jxr_linenumber" name="L634" href="#L634">634</a> <em class="jxr_comment">					 * someone comes up with a reason for needing it.</em>
<a class="jxr_linenumber" name="L635" href="#L635">635</a> <em class="jxr_comment">					 */</em>
<a class="jxr_linenumber" name="L636" href="#L636">636</a> 					<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/rest/server/exceptions/InvalidRequestException.html">InvalidRequestException</a>(getFhirContext().getLocalizer().getMessage(RestfulServer.<strong class="jxr_keyword">class</strong>, <span class="jxr_string">"getPagesNonHttpGet"</span>));
<a class="jxr_linenumber" name="L637" href="#L637">637</a> 				}
<a class="jxr_linenumber" name="L638" href="#L638">638</a> 				handlePagingRequest(requestDetails, theResponse, pagingAction);
<a class="jxr_linenumber" name="L639" href="#L639">639</a> 				<strong class="jxr_keyword">return</strong>;
<a class="jxr_linenumber" name="L640" href="#L640">640</a> 			}
<a class="jxr_linenumber" name="L641" href="#L641">641</a> 
<a class="jxr_linenumber" name="L642" href="#L642">642</a> 			BaseMethodBinding&lt;?&gt; resourceMethod = determineResourceMethod(requestDetails, requestPath);
<a class="jxr_linenumber" name="L643" href="#L643">643</a> 
<a class="jxr_linenumber" name="L644" href="#L644">644</a> 			requestDetails.setRestOperationType(resourceMethod.getRestOperationType());
<a class="jxr_linenumber" name="L645" href="#L645">645</a> 
<a class="jxr_linenumber" name="L646" href="#L646">646</a> 			<em class="jxr_comment">// Handle server interceptors</em>
<a class="jxr_linenumber" name="L647" href="#L647">647</a> 			<strong class="jxr_keyword">for</strong> (IServerInterceptor next : myInterceptors) {
<a class="jxr_linenumber" name="L648" href="#L648">648</a> 				<strong class="jxr_keyword">boolean</strong> continueProcessing = next.incomingRequestPostProcessed(requestDetails, theRequest, theResponse);
<a class="jxr_linenumber" name="L649" href="#L649">649</a> 				<strong class="jxr_keyword">if</strong> (!continueProcessing) {
<a class="jxr_linenumber" name="L650" href="#L650">650</a> 					ourLog.debug(<span class="jxr_string">"Interceptor {} returned false, not continuing processing"</span>);
<a class="jxr_linenumber" name="L651" href="#L651">651</a> 					<strong class="jxr_keyword">return</strong>;
<a class="jxr_linenumber" name="L652" href="#L652">652</a> 				}
<a class="jxr_linenumber" name="L653" href="#L653">653</a> 			}
<a class="jxr_linenumber" name="L654" href="#L654">654</a> 
<a class="jxr_linenumber" name="L655" href="#L655">655</a> 			<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="L656" href="#L656">656</a> <em class="jxr_comment">			 * Actualy invoke the server method. This call is to a HAPI method binding, which is an object that wraps a specific implementing (user-supplied) method, but handles its input and provides</em>
<a class="jxr_linenumber" name="L657" href="#L657">657</a> <em class="jxr_comment">			 * its output back to the client.</em>
<a class="jxr_linenumber" name="L658" href="#L658">658</a> <em class="jxr_comment">			 * </em>
<a class="jxr_linenumber" name="L659" href="#L659">659</a> <em class="jxr_comment">			 * This is basically the end of processing for a successful request, since the method binding replies to the client and closes the response.</em>
<a class="jxr_linenumber" name="L660" href="#L660">660</a> <em class="jxr_comment">			 */</em>
<a class="jxr_linenumber" name="L661" href="#L661">661</a> 			resourceMethod.invokeServer(<strong class="jxr_keyword">this</strong>, requestDetails);
<a class="jxr_linenumber" name="L662" href="#L662">662</a> 
<a class="jxr_linenumber" name="L663" href="#L663">663</a> 		} <strong class="jxr_keyword">catch</strong> (NotModifiedException e) {
<a class="jxr_linenumber" name="L664" href="#L664">664</a> 
<a class="jxr_linenumber" name="L665" href="#L665">665</a> 			<strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> i = getInterceptors().size() - 1; i &gt;= 0; i--) {
<a class="jxr_linenumber" name="L666" href="#L666">666</a> 				IServerInterceptor next = getInterceptors().get(i);
<a class="jxr_linenumber" name="L667" href="#L667">667</a> 				<strong class="jxr_keyword">if</strong> (!next.handleException(requestDetails, e, theRequest, theResponse)) {
<a class="jxr_linenumber" name="L668" href="#L668">668</a> 					ourLog.debug(<span class="jxr_string">"Interceptor {} returned false, not continuing processing"</span>);
<a class="jxr_linenumber" name="L669" href="#L669">669</a> 					<strong class="jxr_keyword">return</strong>;
<a class="jxr_linenumber" name="L670" href="#L670">670</a> 				}
<a class="jxr_linenumber" name="L671" href="#L671">671</a> 			}
<a class="jxr_linenumber" name="L672" href="#L672">672</a> 			writeExceptionToResponse(theResponse, e);
<a class="jxr_linenumber" name="L673" href="#L673">673</a> 
<a class="jxr_linenumber" name="L674" href="#L674">674</a> 		} <strong class="jxr_keyword">catch</strong> (AuthenticationException e) {
<a class="jxr_linenumber" name="L675" href="#L675">675</a> 
<a class="jxr_linenumber" name="L676" href="#L676">676</a> 			<strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> i = getInterceptors().size() - 1; i &gt;= 0; i--) {
<a class="jxr_linenumber" name="L677" href="#L677">677</a> 				IServerInterceptor next = getInterceptors().get(i);
<a class="jxr_linenumber" name="L678" href="#L678">678</a> 				<strong class="jxr_keyword">if</strong> (!next.handleException(requestDetails, e, theRequest, theResponse)) {
<a class="jxr_linenumber" name="L679" href="#L679">679</a> 					ourLog.debug(<span class="jxr_string">"Interceptor {} returned false, not continuing processing"</span>);
<a class="jxr_linenumber" name="L680" href="#L680">680</a> 					<strong class="jxr_keyword">return</strong>;
<a class="jxr_linenumber" name="L681" href="#L681">681</a> 				}
<a class="jxr_linenumber" name="L682" href="#L682">682</a> 			}
<a class="jxr_linenumber" name="L683" href="#L683">683</a> 
<a class="jxr_linenumber" name="L684" href="#L684">684</a> 			<strong class="jxr_keyword">if</strong> (requestIsBrowser) {
<a class="jxr_linenumber" name="L685" href="#L685">685</a> 				<em class="jxr_comment">// if request is coming from a browser, prompt the user to enter login credentials</em>
<a class="jxr_linenumber" name="L686" href="#L686">686</a> 				theResponse.setHeader(<span class="jxr_string">"WWW-Authenticate"</span>, <span class="jxr_string">"BASIC realm=\&quot;FHIR\&quot;"</span>);
<a class="jxr_linenumber" name="L687" href="#L687">687</a> 			}
<a class="jxr_linenumber" name="L688" href="#L688">688</a> 			writeExceptionToResponse(theResponse, e);
<a class="jxr_linenumber" name="L689" href="#L689">689</a> 
<a class="jxr_linenumber" name="L690" href="#L690">690</a> 		} <strong class="jxr_keyword">catch</strong> (Throwable e) {
<a class="jxr_linenumber" name="L691" href="#L691">691</a> 
<a class="jxr_linenumber" name="L692" href="#L692">692</a> 			<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="L693" href="#L693">693</a> <em class="jxr_comment">			 * We have caught an exception during request processing. This might be because a handling method threw something they wanted to throw (e.g. UnprocessableEntityException because the request</em>
<a class="jxr_linenumber" name="L694" href="#L694">694</a> <em class="jxr_comment">			 * had business requirement problems) or it could be due to bugs (e.g. NullPointerException).</em>
<a class="jxr_linenumber" name="L695" href="#L695">695</a> <em class="jxr_comment">			 * </em>
<a class="jxr_linenumber" name="L696" href="#L696">696</a> <em class="jxr_comment">			 * First we let the interceptors have a crack at converting the exception into something HAPI can use (BaseServerResponseException)</em>
<a class="jxr_linenumber" name="L697" href="#L697">697</a> <em class="jxr_comment">			 */</em>
<a class="jxr_linenumber" name="L698" href="#L698">698</a> 			BaseServerResponseException exception = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L699" href="#L699">699</a> 			<strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> i = getInterceptors().size() - 1; i &gt;= 0; i--) {
<a class="jxr_linenumber" name="L700" href="#L700">700</a> 				IServerInterceptor next = getInterceptors().get(i);
<a class="jxr_linenumber" name="L701" href="#L701">701</a> 				exception = next.preProcessOutgoingException(requestDetails, e, theRequest);
<a class="jxr_linenumber" name="L702" href="#L702">702</a> 				<strong class="jxr_keyword">if</strong> (exception != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L703" href="#L703">703</a> 					ourLog.debug(<span class="jxr_string">"Interceptor {} returned false, not continuing processing"</span>);
<a class="jxr_linenumber" name="L704" href="#L704">704</a> 					<strong class="jxr_keyword">break</strong>;
<a class="jxr_linenumber" name="L705" href="#L705">705</a> 				}
<a class="jxr_linenumber" name="L706" href="#L706">706</a> 			}
<a class="jxr_linenumber" name="L707" href="#L707">707</a> 
<a class="jxr_linenumber" name="L708" href="#L708">708</a> 			<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="L709" href="#L709">709</a> <em class="jxr_comment">			 * If none of the interceptors converted the exception, default behaviour is to keep the exception as-is if it extends BaseServerResponseException, otherwise wrap it in an</em>
<a class="jxr_linenumber" name="L710" href="#L710">710</a> <em class="jxr_comment">			 * InternalErrorException.</em>
<a class="jxr_linenumber" name="L711" href="#L711">711</a> <em class="jxr_comment">			 */</em>
<a class="jxr_linenumber" name="L712" href="#L712">712</a> 			<strong class="jxr_keyword">if</strong> (exception == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L713" href="#L713">713</a> 				exception = DEFAULT_EXCEPTION_HANDLER.preProcessOutgoingException(requestDetails, e, theRequest);
<a class="jxr_linenumber" name="L714" href="#L714">714</a> 			}
<a class="jxr_linenumber" name="L715" href="#L715">715</a> 
<a class="jxr_linenumber" name="L716" href="#L716">716</a> 			<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="L717" href="#L717">717</a> <em class="jxr_comment">			 * Next, interceptors get a shot at handling the exception</em>
<a class="jxr_linenumber" name="L718" href="#L718">718</a> <em class="jxr_comment">			 */</em>
<a class="jxr_linenumber" name="L719" href="#L719">719</a> 			<strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> i = getInterceptors().size() - 1; i &gt;= 0; i--) {
<a class="jxr_linenumber" name="L720" href="#L720">720</a> 				IServerInterceptor next = getInterceptors().get(i);
<a class="jxr_linenumber" name="L721" href="#L721">721</a> 				<strong class="jxr_keyword">if</strong> (!next.handleException(requestDetails, exception, theRequest, theResponse)) {
<a class="jxr_linenumber" name="L722" href="#L722">722</a> 					ourLog.debug(<span class="jxr_string">"Interceptor {} returned false, not continuing processing"</span>);
<a class="jxr_linenumber" name="L723" href="#L723">723</a> 					<strong class="jxr_keyword">return</strong>;
<a class="jxr_linenumber" name="L724" href="#L724">724</a> 				}
<a class="jxr_linenumber" name="L725" href="#L725">725</a> 			}
<a class="jxr_linenumber" name="L726" href="#L726">726</a> 
<a class="jxr_linenumber" name="L727" href="#L727">727</a> 			<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="L728" href="#L728">728</a> <em class="jxr_comment">			 * If we're handling an exception, no summary mode should be applied</em>
<a class="jxr_linenumber" name="L729" href="#L729">729</a> <em class="jxr_comment">			 */</em>
<a class="jxr_linenumber" name="L730" href="#L730">730</a> 			requestDetails.getParameters().remove(Constants.PARAM_SUMMARY);
<a class="jxr_linenumber" name="L731" href="#L731">731</a> 			requestDetails.getParameters().remove(Constants.PARAM_ELEMENTS);
<a class="jxr_linenumber" name="L732" href="#L732">732</a> 			
<a class="jxr_linenumber" name="L733" href="#L733">733</a> 			<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="L734" href="#L734">734</a> <em class="jxr_comment">			 * If nobody handles it, default behaviour is to stream back the OperationOutcome to the client.</em>
<a class="jxr_linenumber" name="L735" href="#L735">735</a> <em class="jxr_comment">			 */</em>
<a class="jxr_linenumber" name="L736" href="#L736">736</a> 			DEFAULT_EXCEPTION_HANDLER.handleException(requestDetails, exception, theRequest, theResponse);
<a class="jxr_linenumber" name="L737" href="#L737">737</a> 
<a class="jxr_linenumber" name="L738" href="#L738">738</a> 		}
<a class="jxr_linenumber" name="L739" href="#L739">739</a> 	}
<a class="jxr_linenumber" name="L740" href="#L740">740</a> 
<a class="jxr_linenumber" name="L741" href="#L741">741</a> 	<strong class="jxr_keyword">public</strong> BaseMethodBinding&lt;?&gt; determineResourceMethod(<a href="../../../../../ca/uhn/fhir/rest/method/RequestDetails.html">RequestDetails</a> requestDetails, String requestPath) {
<a class="jxr_linenumber" name="L742" href="#L742">742</a> 		RequestTypeEnum requestType = requestDetails.getRequestType();
<a class="jxr_linenumber" name="L743" href="#L743">743</a> 		
<a class="jxr_linenumber" name="L744" href="#L744">744</a> 		ResourceBinding resourceBinding = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L745" href="#L745">745</a> 		BaseMethodBinding&lt;?&gt; resourceMethod = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L746" href="#L746">746</a> 		String resourceName = requestDetails.getResourceName();
<a class="jxr_linenumber" name="L747" href="#L747">747</a> 		<strong class="jxr_keyword">if</strong> (Constants.URL_TOKEN_METADATA.equals(resourceName) || requestType == RequestTypeEnum.OPTIONS) {
<a class="jxr_linenumber" name="L748" href="#L748">748</a> 			resourceMethod = myServerConformanceMethod;
<a class="jxr_linenumber" name="L749" href="#L749">749</a> 		} <strong class="jxr_keyword">else</strong> <strong class="jxr_keyword">if</strong> (resourceName == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L750" href="#L750">750</a> 			resourceBinding = myServerBinding;
<a class="jxr_linenumber" name="L751" href="#L751">751</a> 		} <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="L752" href="#L752">752</a> 			resourceBinding = myResourceNameToBinding.get(resourceName);
<a class="jxr_linenumber" name="L753" href="#L753">753</a> 			<strong class="jxr_keyword">if</strong> (resourceBinding == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L754" href="#L754">754</a> 				<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/rest/server/exceptions/InvalidRequestException.html">InvalidRequestException</a>(<span class="jxr_string">"Unknown resource type '"</span> + resourceName + <span class="jxr_string">"' - Server knows how to handle: "</span> + myResourceNameToBinding.keySet());
<a class="jxr_linenumber" name="L755" href="#L755">755</a> 			}
<a class="jxr_linenumber" name="L756" href="#L756">756</a> 		}
<a class="jxr_linenumber" name="L757" href="#L757">757</a> 
<a class="jxr_linenumber" name="L758" href="#L758">758</a> 		<strong class="jxr_keyword">if</strong> (resourceMethod == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L759" href="#L759">759</a> 			<strong class="jxr_keyword">if</strong> (resourceBinding != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L760" href="#L760">760</a> 				resourceMethod = resourceBinding.getMethod(requestDetails);
<a class="jxr_linenumber" name="L761" href="#L761">761</a> 			}
<a class="jxr_linenumber" name="L762" href="#L762">762</a> 		}
<a class="jxr_linenumber" name="L763" href="#L763">763</a> 		<strong class="jxr_keyword">if</strong> (resourceMethod == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L764" href="#L764">764</a> 			<strong class="jxr_keyword">if</strong> (isBlank(requestPath)) {
<a class="jxr_linenumber" name="L765" href="#L765">765</a> 				<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/rest/server/exceptions/InvalidRequestException.html">InvalidRequestException</a>(myFhirContext.getLocalizer().getMessage(RestfulServer.<strong class="jxr_keyword">class</strong>, <span class="jxr_string">"rootRequest"</span>));
<a class="jxr_linenumber" name="L766" href="#L766">766</a> 			} <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="L767" href="#L767">767</a> 				<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/rest/server/exceptions/InvalidRequestException.html">InvalidRequestException</a>(myFhirContext.getLocalizer().getMessage(RestfulServer.<strong class="jxr_keyword">class</strong>, <span class="jxr_string">"unknownMethod"</span>, requestType.name(), requestPath, requestDetails.getParameters().keySet()));
<a class="jxr_linenumber" name="L768" href="#L768">768</a> 			}
<a class="jxr_linenumber" name="L769" href="#L769">769</a> 		}
<a class="jxr_linenumber" name="L770" href="#L770">770</a> 		<strong class="jxr_keyword">return</strong> resourceMethod;
<a class="jxr_linenumber" name="L771" href="#L771">771</a> 	}
<a class="jxr_linenumber" name="L772" href="#L772">772</a> 
<a class="jxr_linenumber" name="L773" href="#L773">773</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> populateRequestDetailsFromRequestPath(<a href="../../../../../ca/uhn/fhir/rest/method/RequestDetails.html">RequestDetails</a> theRequestDetails, String theRequestPath) {
<a class="jxr_linenumber" name="L774" href="#L774">774</a> 		StringTokenizer tok = <strong class="jxr_keyword">new</strong> StringTokenizer(theRequestPath, <span class="jxr_string">"/"</span>);
<a class="jxr_linenumber" name="L775" href="#L775">775</a> 		String resourceName = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L776" href="#L776">776</a> 		
<a class="jxr_linenumber" name="L777" href="#L777">777</a> 		IdDt id = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L778" href="#L778">778</a> 		String operation = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L779" href="#L779">779</a> 		String compartment = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L780" href="#L780">780</a> 		<strong class="jxr_keyword">if</strong> (tok.hasMoreTokens()) {
<a class="jxr_linenumber" name="L781" href="#L781">781</a> 			resourceName = tok.nextToken();
<a class="jxr_linenumber" name="L782" href="#L782">782</a> 			<strong class="jxr_keyword">if</strong> (partIsOperation(resourceName)) {
<a class="jxr_linenumber" name="L783" href="#L783">783</a> 				operation = resourceName;
<a class="jxr_linenumber" name="L784" href="#L784">784</a> 				resourceName = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L785" href="#L785">785</a> 			}
<a class="jxr_linenumber" name="L786" href="#L786">786</a> 		}
<a class="jxr_linenumber" name="L787" href="#L787">787</a> 		theRequestDetails.setResourceName(resourceName);
<a class="jxr_linenumber" name="L788" href="#L788">788</a> 
<a class="jxr_linenumber" name="L789" href="#L789">789</a> 		<strong class="jxr_keyword">if</strong> (tok.hasMoreTokens()) {
<a class="jxr_linenumber" name="L790" href="#L790">790</a> 			String nextString = tok.nextToken();
<a class="jxr_linenumber" name="L791" href="#L791">791</a> 			<strong class="jxr_keyword">if</strong> (partIsOperation(nextString)) {
<a class="jxr_linenumber" name="L792" href="#L792">792</a> 				operation = nextString;
<a class="jxr_linenumber" name="L793" href="#L793">793</a> 			} <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="L794" href="#L794">794</a> 				id = <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/model/primitive/IdDt.html">IdDt</a>(resourceName, UrlUtil.unescape(nextString));
<a class="jxr_linenumber" name="L795" href="#L795">795</a> 			}
<a class="jxr_linenumber" name="L796" href="#L796">796</a> 		}
<a class="jxr_linenumber" name="L797" href="#L797">797</a> 
<a class="jxr_linenumber" name="L798" href="#L798">798</a> 		<strong class="jxr_keyword">if</strong> (tok.hasMoreTokens()) {
<a class="jxr_linenumber" name="L799" href="#L799">799</a> 			String nextString = tok.nextToken();
<a class="jxr_linenumber" name="L800" href="#L800">800</a> 			<strong class="jxr_keyword">if</strong> (nextString.equals(Constants.PARAM_HISTORY)) {
<a class="jxr_linenumber" name="L801" href="#L801">801</a> 				<strong class="jxr_keyword">if</strong> (tok.hasMoreTokens()) {
<a class="jxr_linenumber" name="L802" href="#L802">802</a> 					String versionString = tok.nextToken();
<a class="jxr_linenumber" name="L803" href="#L803">803</a> 					<strong class="jxr_keyword">if</strong> (id == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L804" href="#L804">804</a> 						<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/rest/server/exceptions/InvalidRequestException.html">InvalidRequestException</a>(<span class="jxr_string">"Don't know how to handle request path: "</span> + theRequestPath);
<a class="jxr_linenumber" name="L805" href="#L805">805</a> 					}
<a class="jxr_linenumber" name="L806" href="#L806">806</a> 					id = <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/model/primitive/IdDt.html">IdDt</a>(resourceName, id.getIdPart(), UrlUtil.unescape(versionString));
<a class="jxr_linenumber" name="L807" href="#L807">807</a> 				} <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="L808" href="#L808">808</a> 					operation = Constants.PARAM_HISTORY;
<a class="jxr_linenumber" name="L809" href="#L809">809</a> 				}
<a class="jxr_linenumber" name="L810" href="#L810">810</a> 			} <strong class="jxr_keyword">else</strong> <strong class="jxr_keyword">if</strong> (partIsOperation(nextString)) {
<a class="jxr_linenumber" name="L811" href="#L811">811</a> 				<strong class="jxr_keyword">if</strong> (operation != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L812" href="#L812">812</a> 					<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/rest/server/exceptions/InvalidRequestException.html">InvalidRequestException</a>(<span class="jxr_string">"URL Path contains two operations: "</span> + theRequestPath);
<a class="jxr_linenumber" name="L813" href="#L813">813</a> 				}
<a class="jxr_linenumber" name="L814" href="#L814">814</a> 				operation = nextString;
<a class="jxr_linenumber" name="L815" href="#L815">815</a> 			} <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="L816" href="#L816">816</a> 				compartment = nextString;
<a class="jxr_linenumber" name="L817" href="#L817">817</a> 			}
<a class="jxr_linenumber" name="L818" href="#L818">818</a> 		}
<a class="jxr_linenumber" name="L819" href="#L819">819</a> 
<a class="jxr_linenumber" name="L820" href="#L820">820</a> 		<em class="jxr_comment">// Secondary is for things like ..../_tags/_delete</em>
<a class="jxr_linenumber" name="L821" href="#L821">821</a> 		String secondaryOperation = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L822" href="#L822">822</a> 
<a class="jxr_linenumber" name="L823" href="#L823">823</a> 		<strong class="jxr_keyword">while</strong> (tok.hasMoreTokens()) {
<a class="jxr_linenumber" name="L824" href="#L824">824</a> 			String nextString = tok.nextToken();
<a class="jxr_linenumber" name="L825" href="#L825">825</a> 			<strong class="jxr_keyword">if</strong> (operation == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L826" href="#L826">826</a> 				operation = nextString;
<a class="jxr_linenumber" name="L827" href="#L827">827</a> 			} <strong class="jxr_keyword">else</strong> <strong class="jxr_keyword">if</strong> (secondaryOperation == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L828" href="#L828">828</a> 				secondaryOperation = nextString;
<a class="jxr_linenumber" name="L829" href="#L829">829</a> 			} <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="L830" href="#L830">830</a> 				<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/rest/server/exceptions/InvalidRequestException.html">InvalidRequestException</a>(<span class="jxr_string">"URL path has unexpected token '"</span> + nextString + <span class="jxr_string">"' at the end: "</span> + theRequestPath);
<a class="jxr_linenumber" name="L831" href="#L831">831</a> 			}
<a class="jxr_linenumber" name="L832" href="#L832">832</a> 		}
<a class="jxr_linenumber" name="L833" href="#L833">833</a> 
<a class="jxr_linenumber" name="L834" href="#L834">834</a> 		theRequestDetails.setId(id);
<a class="jxr_linenumber" name="L835" href="#L835">835</a> 		theRequestDetails.setOperation(operation);
<a class="jxr_linenumber" name="L836" href="#L836">836</a> 		theRequestDetails.setSecondaryOperation(secondaryOperation);
<a class="jxr_linenumber" name="L837" href="#L837">837</a> 		theRequestDetails.setCompartmentName(compartment);
<a class="jxr_linenumber" name="L838" href="#L838">838</a> 	}
<a class="jxr_linenumber" name="L839" href="#L839">839</a> 
<a class="jxr_linenumber" name="L840" href="#L840">840</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L841" href="#L841">841</a> <em class="jxr_javadoccomment">	 * Initializes the server. Note that this method is final to avoid accidentally introducing bugs in implementations, but subclasses may put initialization code in {@link #initialize()}, which is</em>
<a class="jxr_linenumber" name="L842" href="#L842">842</a> <em class="jxr_javadoccomment">	 * called immediately before beginning initialization of the restful server's internal init.</em>
<a class="jxr_linenumber" name="L843" href="#L843">843</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L844" href="#L844">844</a> 	@Override
<a class="jxr_linenumber" name="L845" href="#L845">845</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">final</strong> <strong class="jxr_keyword">void</strong> init() <strong class="jxr_keyword">throws</strong> ServletException {
<a class="jxr_linenumber" name="L846" href="#L846">846</a> 		myProviderRegistrationMutex.lock();
<a class="jxr_linenumber" name="L847" href="#L847">847</a> 		<strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L848" href="#L848">848</a> 			initialize();
<a class="jxr_linenumber" name="L849" href="#L849">849</a> 			
<a class="jxr_linenumber" name="L850" href="#L850">850</a> 			Object confProvider;
<a class="jxr_linenumber" name="L851" href="#L851">851</a> 			<strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L852" href="#L852">852</a> 				ourLog.info(<span class="jxr_string">"Initializing HAPI FHIR restful server running in "</span> + getFhirContext().getVersion().getVersion().name() + <span class="jxr_string">" mode"</span>);
<a class="jxr_linenumber" name="L853" href="#L853">853</a> 
<a class="jxr_linenumber" name="L854" href="#L854">854</a> 				ProvidedResourceScanner providedResourceScanner = <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/context/ProvidedResourceScanner.html">ProvidedResourceScanner</a>(getFhirContext());
<a class="jxr_linenumber" name="L855" href="#L855">855</a> 				providedResourceScanner.scanForProvidedResources(<strong class="jxr_keyword">this</strong>);
<a class="jxr_linenumber" name="L856" href="#L856">856</a> 
<a class="jxr_linenumber" name="L857" href="#L857">857</a> 				Collection&lt;IResourceProvider&gt; resourceProvider = getResourceProviders();
<a class="jxr_linenumber" name="L858" href="#L858">858</a> 				<em class="jxr_comment">// 'true' tells registerProviders() that </em>
<a class="jxr_linenumber" name="L859" href="#L859">859</a> 				<em class="jxr_comment">// this call is part of initialization</em>
<a class="jxr_linenumber" name="L860" href="#L860">860</a> 				registerProviders(resourceProvider, <strong class="jxr_keyword">true</strong>); 
<a class="jxr_linenumber" name="L861" href="#L861">861</a> 
<a class="jxr_linenumber" name="L862" href="#L862">862</a> 				Collection&lt;Object&gt; providers = getPlainProviders();
<a class="jxr_linenumber" name="L863" href="#L863">863</a> 				<em class="jxr_comment">// 'true' tells registerProviders() that </em>
<a class="jxr_linenumber" name="L864" href="#L864">864</a> 				<em class="jxr_comment">// this call is part of initialization</em>
<a class="jxr_linenumber" name="L865" href="#L865">865</a> 				registerProviders(providers, <strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L866" href="#L866">866</a> 
<a class="jxr_linenumber" name="L867" href="#L867">867</a> 				findResourceMethods(getServerProfilesProvider());
<a class="jxr_linenumber" name="L868" href="#L868">868</a> 
<a class="jxr_linenumber" name="L869" href="#L869">869</a> 				confProvider = getServerConformanceProvider();
<a class="jxr_linenumber" name="L870" href="#L870">870</a> 				<strong class="jxr_keyword">if</strong> (confProvider == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L871" href="#L871">871</a> 					confProvider = getFhirContext().getVersion().createServerConformanceProvider(<strong class="jxr_keyword">this</strong>);
<a class="jxr_linenumber" name="L872" href="#L872">872</a> 				}
<a class="jxr_linenumber" name="L873" href="#L873">873</a> <em class="jxr_comment">//				findSystemMethods(confProvider);</em>
<a class="jxr_linenumber" name="L874" href="#L874">874</a> 				findResourceMethods(confProvider);
<a class="jxr_linenumber" name="L875" href="#L875">875</a> 
<a class="jxr_linenumber" name="L876" href="#L876">876</a> 			} <strong class="jxr_keyword">catch</strong> (Exception ex) {
<a class="jxr_linenumber" name="L877" href="#L877">877</a> 				ourLog.error(<span class="jxr_string">"An error occurred while loading request handlers!"</span>, ex);
<a class="jxr_linenumber" name="L878" href="#L878">878</a> 				<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> ServletException(<span class="jxr_string">"Failed to initialize FHIR Restful server"</span>, ex);
<a class="jxr_linenumber" name="L879" href="#L879">879</a> 			}
<a class="jxr_linenumber" name="L880" href="#L880">880</a> 
<a class="jxr_linenumber" name="L881" href="#L881">881</a> 			ourLog.trace(<span class="jxr_string">"Invoking provider initialize methods"</span>);
<a class="jxr_linenumber" name="L882" href="#L882">882</a> 			<strong class="jxr_keyword">if</strong> (getResourceProviders() != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L883" href="#L883">883</a> 				<strong class="jxr_keyword">for</strong> (IResourceProvider iResourceProvider : getResourceProviders()) {
<a class="jxr_linenumber" name="L884" href="#L884">884</a> 					invokeInitialize(iResourceProvider);
<a class="jxr_linenumber" name="L885" href="#L885">885</a> 				}
<a class="jxr_linenumber" name="L886" href="#L886">886</a> 			}
<a class="jxr_linenumber" name="L887" href="#L887">887</a> 			<strong class="jxr_keyword">if</strong> (confProvider != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L888" href="#L888">888</a> 				invokeInitialize(confProvider);
<a class="jxr_linenumber" name="L889" href="#L889">889</a> 			}
<a class="jxr_linenumber" name="L890" href="#L890">890</a> 			<strong class="jxr_keyword">if</strong> (getPlainProviders() != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L891" href="#L891">891</a> 				<strong class="jxr_keyword">for</strong> (Object next : getPlainProviders()) {
<a class="jxr_linenumber" name="L892" href="#L892">892</a> 					invokeInitialize(next);
<a class="jxr_linenumber" name="L893" href="#L893">893</a> 				}
<a class="jxr_linenumber" name="L894" href="#L894">894</a> 			}
<a class="jxr_linenumber" name="L895" href="#L895">895</a> 			
<a class="jxr_linenumber" name="L896" href="#L896">896</a> 			myStarted = <strong class="jxr_keyword">true</strong>;
<a class="jxr_linenumber" name="L897" href="#L897">897</a> 			ourLog.info(<span class="jxr_string">"A FHIR has been lit on this server"</span>);
<a class="jxr_linenumber" name="L898" href="#L898">898</a> 		} <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L899" href="#L899">899</a> 			myProviderRegistrationMutex.unlock();
<a class="jxr_linenumber" name="L900" href="#L900">900</a> 		}
<a class="jxr_linenumber" name="L901" href="#L901">901</a> 	}
<a class="jxr_linenumber" name="L902" href="#L902">902</a> 
<a class="jxr_linenumber" name="L903" href="#L903">903</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L904" href="#L904">904</a> <em class="jxr_javadoccomment">	 * This method may be overridden by subclasses to do perform initialization that needs to be performed prior to the server being used.</em>
<a class="jxr_linenumber" name="L905" href="#L905">905</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="L906" href="#L906">906</a> <em class="jxr_javadoccomment">	 * @throws ServletException</em>
<a class="jxr_linenumber" name="L907" href="#L907">907</a> <em class="jxr_javadoccomment">	 *            If the initialization failed. Note that you should consider throwing {@link UnavailableException} (which extends {@link ServletException}), as this is a flag to the servlet container</em>
<a class="jxr_linenumber" name="L908" href="#L908">908</a> <em class="jxr_javadoccomment">	 *            that the servlet is not usable.</em>
<a class="jxr_linenumber" name="L909" href="#L909">909</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L910" href="#L910">910</a> 	<strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">void</strong> initialize() <strong class="jxr_keyword">throws</strong> ServletException {
<a class="jxr_linenumber" name="L911" href="#L911">911</a> 		<em class="jxr_comment">// nothing by default</em>
<a class="jxr_linenumber" name="L912" href="#L912">912</a> 	}
<a class="jxr_linenumber" name="L913" href="#L913">913</a> 
<a class="jxr_linenumber" name="L914" href="#L914">914</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L915" href="#L915">915</a> <em class="jxr_javadoccomment">	 * Register a single provider. This could be a Resource Provider </em>
<a class="jxr_linenumber" name="L916" href="#L916">916</a> <em class="jxr_javadoccomment">	 * or a "plain" provider not associated with any resource.</em>
<a class="jxr_linenumber" name="L917" href="#L917">917</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="L918" href="#L918">918</a> <em class="jxr_javadoccomment">	 * @param provider</em>
<a class="jxr_linenumber" name="L919" href="#L919">919</a> <em class="jxr_javadoccomment">	 * @throws Exception</em>
<a class="jxr_linenumber" name="L920" href="#L920">920</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L921" href="#L921">921</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> registerProvider (Object provider) <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L922" href="#L922">922</a> 		<strong class="jxr_keyword">if</strong> (provider != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L923" href="#L923">923</a> 			Collection&lt;Object&gt; providerList = <strong class="jxr_keyword">new</strong> ArrayList&lt;Object&gt;(1);
<a class="jxr_linenumber" name="L924" href="#L924">924</a> 			providerList.add(provider);
<a class="jxr_linenumber" name="L925" href="#L925">925</a> 			registerProviders(providerList);
<a class="jxr_linenumber" name="L926" href="#L926">926</a> 		}
<a class="jxr_linenumber" name="L927" href="#L927">927</a> 	}
<a class="jxr_linenumber" name="L928" href="#L928">928</a> 	
<a class="jxr_linenumber" name="L929" href="#L929">929</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L930" href="#L930">930</a> <em class="jxr_javadoccomment">	 * Register a group of providers. These could be Resource Providers,</em>
<a class="jxr_linenumber" name="L931" href="#L931">931</a> <em class="jxr_javadoccomment">	 * "plain" providers or a mixture of the two.</em>
<a class="jxr_linenumber" name="L932" href="#L932">932</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="L933" href="#L933">933</a> <em class="jxr_javadoccomment">	 * @param providers a {@code Collection} of providers. The parameter</em>
<a class="jxr_linenumber" name="L934" href="#L934">934</a> <em class="jxr_javadoccomment">	 * could be null or an empty {@code Collection} </em>
<a class="jxr_linenumber" name="L935" href="#L935">935</a> <em class="jxr_javadoccomment">	 * @throws Exception</em>
<a class="jxr_linenumber" name="L936" href="#L936">936</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L937" href="#L937">937</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> registerProviders (Collection&lt;? <strong class="jxr_keyword">extends</strong> Object&gt; providers) <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L938" href="#L938">938</a> 		myProviderRegistrationMutex.lock();
<a class="jxr_linenumber" name="L939" href="#L939">939</a> 		<strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L940" href="#L940">940</a> 			<strong class="jxr_keyword">if</strong> (!myStarted) {
<a class="jxr_linenumber" name="L941" href="#L941">941</a> 				<strong class="jxr_keyword">for</strong> (Object provider : providers) {
<a class="jxr_linenumber" name="L942" href="#L942">942</a> 					ourLog.info(<span class="jxr_string">"Registration of provider ["</span>+provider.getClass().getName()+<span class="jxr_string">"] will be delayed until FHIR server startup"</span>);
<a class="jxr_linenumber" name="L943" href="#L943">943</a> 					<strong class="jxr_keyword">if</strong> (provider instanceof IResourceProvider) {
<a class="jxr_linenumber" name="L944" href="#L944">944</a> 						myResourceProviders.add((IResourceProvider)provider);
<a class="jxr_linenumber" name="L945" href="#L945">945</a> 					} <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="L946" href="#L946">946</a> 						myPlainProviders.add(provider);
<a class="jxr_linenumber" name="L947" href="#L947">947</a> 					}
<a class="jxr_linenumber" name="L948" href="#L948">948</a> 				}
<a class="jxr_linenumber" name="L949" href="#L949">949</a> 				<strong class="jxr_keyword">return</strong>;
<a class="jxr_linenumber" name="L950" href="#L950">950</a> 			}
<a class="jxr_linenumber" name="L951" href="#L951">951</a> 		} <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L952" href="#L952">952</a> 			myProviderRegistrationMutex.unlock();
<a class="jxr_linenumber" name="L953" href="#L953">953</a> 		}
<a class="jxr_linenumber" name="L954" href="#L954">954</a> 		registerProviders(providers, false);
<a class="jxr_linenumber" name="L955" href="#L955">955</a> 	}
<a class="jxr_linenumber" name="L956" href="#L956">956</a> 	
<a class="jxr_linenumber" name="L957" href="#L957">957</a> 	<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="L958" href="#L958">958</a> <em class="jxr_comment">	 * Inner method to actually register providers </em>
<a class="jxr_linenumber" name="L959" href="#L959">959</a> <em class="jxr_comment">	 */</em>
<a class="jxr_linenumber" name="L960" href="#L960">960</a> 	<strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">void</strong> registerProviders (Collection&lt;? <strong class="jxr_keyword">extends</strong> Object&gt; providers, <strong class="jxr_keyword">boolean</strong> inInit) <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L961" href="#L961">961</a> 		List&lt;IResourceProvider&gt; newResourceProviders = <strong class="jxr_keyword">new</strong> ArrayList&lt;IResourceProvider&gt;();
<a class="jxr_linenumber" name="L962" href="#L962">962</a> 		List&lt;Object&gt; newPlainProviders = <strong class="jxr_keyword">new</strong> ArrayList&lt;Object&gt;();
<a class="jxr_linenumber" name="L963" href="#L963">963</a> 		ProvidedResourceScanner providedResourceScanner = <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/context/ProvidedResourceScanner.html">ProvidedResourceScanner</a>(getFhirContext());
<a class="jxr_linenumber" name="L964" href="#L964">964</a> 
<a class="jxr_linenumber" name="L965" href="#L965">965</a> 		<strong class="jxr_keyword">if</strong> (providers != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L966" href="#L966">966</a> 			<strong class="jxr_keyword">for</strong> (Object provider : providers) {
<a class="jxr_linenumber" name="L967" href="#L967">967</a> 				<strong class="jxr_keyword">if</strong> (provider instanceof IResourceProvider) {
<a class="jxr_linenumber" name="L968" href="#L968">968</a> 					IResourceProvider rsrcProvider = (IResourceProvider)provider;
<a class="jxr_linenumber" name="L969" href="#L969">969</a> 					Class&lt;? <strong class="jxr_keyword">extends</strong> IBaseResource&gt; resourceType = rsrcProvider.getResourceType();
<a class="jxr_linenumber" name="L970" href="#L970">970</a> 					<strong class="jxr_keyword">if</strong> (resourceType == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L971" href="#L971">971</a> 						<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> NullPointerException(<span class="jxr_string">"getResourceType() on class '"</span> + rsrcProvider.getClass().getCanonicalName() + <span class="jxr_string">"' returned null"</span>);
<a class="jxr_linenumber" name="L972" href="#L972">972</a> 					}
<a class="jxr_linenumber" name="L973" href="#L973">973</a> 					String resourceName = getFhirContext().getResourceDefinition(resourceType).getName();
<a class="jxr_linenumber" name="L974" href="#L974">974</a> 					<strong class="jxr_keyword">if</strong> (myTypeToProvider.containsKey(resourceName)) {
<a class="jxr_linenumber" name="L975" href="#L975">975</a> 						<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> ServletException(<span class="jxr_string">"Multiple resource providers return resource type["</span> + resourceName + <span class="jxr_string">"]: First["</span> + myTypeToProvider.get(resourceName).getClass().getCanonicalName() + <span class="jxr_string">"] and Second["</span> + rsrcProvider.getClass().getCanonicalName() + <span class="jxr_string">"]"</span>);
<a class="jxr_linenumber" name="L976" href="#L976">976</a> 					}
<a class="jxr_linenumber" name="L977" href="#L977">977</a> 					<strong class="jxr_keyword">if</strong> (!inInit) {
<a class="jxr_linenumber" name="L978" href="#L978">978</a> 						myResourceProviders.add(rsrcProvider);
<a class="jxr_linenumber" name="L979" href="#L979">979</a> 					}
<a class="jxr_linenumber" name="L980" href="#L980">980</a> 					myTypeToProvider.put(resourceName, rsrcProvider);
<a class="jxr_linenumber" name="L981" href="#L981">981</a> 					providedResourceScanner.scanForProvidedResources(rsrcProvider);
<a class="jxr_linenumber" name="L982" href="#L982">982</a> 					newResourceProviders.add(rsrcProvider);
<a class="jxr_linenumber" name="L983" href="#L983">983</a> 				} <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="L984" href="#L984">984</a> 					<strong class="jxr_keyword">if</strong> (!inInit) {
<a class="jxr_linenumber" name="L985" href="#L985">985</a> 						myPlainProviders.add(provider);
<a class="jxr_linenumber" name="L986" href="#L986">986</a> 					}
<a class="jxr_linenumber" name="L987" href="#L987">987</a> 					newPlainProviders.add(provider);
<a class="jxr_linenumber" name="L988" href="#L988">988</a> 				}
<a class="jxr_linenumber" name="L989" href="#L989">989</a> 				
<a class="jxr_linenumber" name="L990" href="#L990">990</a> 			}
<a class="jxr_linenumber" name="L991" href="#L991">991</a> 			<strong class="jxr_keyword">if</strong> (!newResourceProviders.isEmpty()) {
<a class="jxr_linenumber" name="L992" href="#L992">992</a> 				ourLog.info(<span class="jxr_string">"Added {} resource provider(s). Total {}"</span>, newResourceProviders.size(), myTypeToProvider.size());
<a class="jxr_linenumber" name="L993" href="#L993">993</a> 				<strong class="jxr_keyword">for</strong> (IResourceProvider provider : newResourceProviders) {
<a class="jxr_linenumber" name="L994" href="#L994">994</a> 					assertProviderIsValid(provider);
<a class="jxr_linenumber" name="L995" href="#L995">995</a> 					findResourceMethods(provider);
<a class="jxr_linenumber" name="L996" href="#L996">996</a> 				}
<a class="jxr_linenumber" name="L997" href="#L997">997</a> 			}
<a class="jxr_linenumber" name="L998" href="#L998">998</a> 			<strong class="jxr_keyword">if</strong> (!newPlainProviders.isEmpty()) {
<a class="jxr_linenumber" name="L999" href="#L999">999</a> 				ourLog.info(<span class="jxr_string">"Added {} plain provider(s). Total {}"</span>, newPlainProviders.size());
<a class="jxr_linenumber" name="L1000" href="#L1000">1000</a> 				<strong class="jxr_keyword">for</strong> (Object provider : newPlainProviders) {
<a class="jxr_linenumber" name="L1001" href="#L1001">1001</a> 					assertProviderIsValid(provider);
<a class="jxr_linenumber" name="L1002" href="#L1002">1002</a> 					findResourceMethods(provider);
<a class="jxr_linenumber" name="L1003" href="#L1003">1003</a> 				}
<a class="jxr_linenumber" name="L1004" href="#L1004">1004</a> 			}
<a class="jxr_linenumber" name="L1005" href="#L1005">1005</a> 			<strong class="jxr_keyword">if</strong> (!inInit) {
<a class="jxr_linenumber" name="L1006" href="#L1006">1006</a> 				ourLog.trace(<span class="jxr_string">"Invoking provider initialize methods"</span>);
<a class="jxr_linenumber" name="L1007" href="#L1007">1007</a> 				<strong class="jxr_keyword">if</strong> (!newResourceProviders.isEmpty()) {
<a class="jxr_linenumber" name="L1008" href="#L1008">1008</a> 					<strong class="jxr_keyword">for</strong> (IResourceProvider provider : newResourceProviders) {
<a class="jxr_linenumber" name="L1009" href="#L1009">1009</a> 						invokeInitialize(provider);
<a class="jxr_linenumber" name="L1010" href="#L1010">1010</a> 					}
<a class="jxr_linenumber" name="L1011" href="#L1011">1011</a> 				}
<a class="jxr_linenumber" name="L1012" href="#L1012">1012</a> 				<strong class="jxr_keyword">if</strong> (!newPlainProviders.isEmpty()) {
<a class="jxr_linenumber" name="L1013" href="#L1013">1013</a> 					<strong class="jxr_keyword">for</strong> (Object provider : newPlainProviders) {
<a class="jxr_linenumber" name="L1014" href="#L1014">1014</a> 						invokeInitialize(provider);
<a class="jxr_linenumber" name="L1015" href="#L1015">1015</a> 					}
<a class="jxr_linenumber" name="L1016" href="#L1016">1016</a> 				}
<a class="jxr_linenumber" name="L1017" href="#L1017">1017</a> 			}
<a class="jxr_linenumber" name="L1018" href="#L1018">1018</a> 		}
<a class="jxr_linenumber" name="L1019" href="#L1019">1019</a> 	}
<a class="jxr_linenumber" name="L1020" href="#L1020">1020</a> 	
<a class="jxr_linenumber" name="L1021" href="#L1021">1021</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1022" href="#L1022">1022</a> <em class="jxr_javadoccomment">	 * Unregister one provider (either a Resource provider or a plain provider)</em>
<a class="jxr_linenumber" name="L1023" href="#L1023">1023</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="L1024" href="#L1024">1024</a> <em class="jxr_javadoccomment">	 * @param provider</em>
<a class="jxr_linenumber" name="L1025" href="#L1025">1025</a> <em class="jxr_javadoccomment">	 * @throws Exception</em>
<a class="jxr_linenumber" name="L1026" href="#L1026">1026</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1027" href="#L1027">1027</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> unregisterProvider (Object provider) <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L1028" href="#L1028">1028</a> 		<strong class="jxr_keyword">if</strong> (provider != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L1029" href="#L1029">1029</a> 			Collection&lt;Object&gt; providerList = <strong class="jxr_keyword">new</strong> ArrayList&lt;Object&gt;(1);
<a class="jxr_linenumber" name="L1030" href="#L1030">1030</a> 			providerList.add(provider);
<a class="jxr_linenumber" name="L1031" href="#L1031">1031</a> 			unregisterProviders(providerList);
<a class="jxr_linenumber" name="L1032" href="#L1032">1032</a> 		}
<a class="jxr_linenumber" name="L1033" href="#L1033">1033</a> 	}
<a class="jxr_linenumber" name="L1034" href="#L1034">1034</a> 	
<a class="jxr_linenumber" name="L1035" href="#L1035">1035</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1036" href="#L1036">1036</a> <em class="jxr_javadoccomment">	 * Unregister a {@code Collection} of providers</em>
<a class="jxr_linenumber" name="L1037" href="#L1037">1037</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="L1038" href="#L1038">1038</a> <em class="jxr_javadoccomment">	 * @param providers</em>
<a class="jxr_linenumber" name="L1039" href="#L1039">1039</a> <em class="jxr_javadoccomment">	 * @throws Exception</em>
<a class="jxr_linenumber" name="L1040" href="#L1040">1040</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1041" href="#L1041">1041</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> unregisterProviders (Collection&lt;? <strong class="jxr_keyword">extends</strong> Object&gt; providers) <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L1042" href="#L1042">1042</a> 		ProvidedResourceScanner providedResourceScanner = <strong class="jxr_keyword">new</strong> <a href="../../../../../ca/uhn/fhir/context/ProvidedResourceScanner.html">ProvidedResourceScanner</a>(getFhirContext());
<a class="jxr_linenumber" name="L1043" href="#L1043">1043</a> 		<strong class="jxr_keyword">if</strong> (providers != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L1044" href="#L1044">1044</a> 			<strong class="jxr_keyword">for</strong> (Object provider : providers) {
<a class="jxr_linenumber" name="L1045" href="#L1045">1045</a> 				removeResourceMethods(provider);
<a class="jxr_linenumber" name="L1046" href="#L1046">1046</a> 				<strong class="jxr_keyword">if</strong> (provider instanceof IResourceProvider) {
<a class="jxr_linenumber" name="L1047" href="#L1047">1047</a> 					myResourceProviders.remove(provider);
<a class="jxr_linenumber" name="L1048" href="#L1048">1048</a> 					IResourceProvider rsrcProvider = (IResourceProvider)provider;
<a class="jxr_linenumber" name="L1049" href="#L1049">1049</a> 					Class&lt;? <strong class="jxr_keyword">extends</strong> IBaseResource&gt; resourceType = rsrcProvider.getResourceType();
<a class="jxr_linenumber" name="L1050" href="#L1050">1050</a> 					String resourceName = getFhirContext().getResourceDefinition(resourceType).getName();
<a class="jxr_linenumber" name="L1051" href="#L1051">1051</a> 					myTypeToProvider.remove(resourceName);
<a class="jxr_linenumber" name="L1052" href="#L1052">1052</a> 					providedResourceScanner.removeProvidedResources(rsrcProvider);
<a class="jxr_linenumber" name="L1053" href="#L1053">1053</a> 				} <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="L1054" href="#L1054">1054</a> 					myPlainProviders.remove(provider);
<a class="jxr_linenumber" name="L1055" href="#L1055">1055</a> 				}
<a class="jxr_linenumber" name="L1056" href="#L1056">1056</a> 				invokeDestroy(provider);
<a class="jxr_linenumber" name="L1057" href="#L1057">1057</a> 			}
<a class="jxr_linenumber" name="L1058" href="#L1058">1058</a> 		}
<a class="jxr_linenumber" name="L1059" href="#L1059">1059</a> 	}
<a class="jxr_linenumber" name="L1060" href="#L1060">1060</a> 
<a class="jxr_linenumber" name="L1061" href="#L1061">1061</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">void</strong> invokeDestroy(Object theProvider) {
<a class="jxr_linenumber" name="L1062" href="#L1062">1062</a> 		invokeDestroy(theProvider, theProvider.getClass());
<a class="jxr_linenumber" name="L1063" href="#L1063">1063</a> 	}
<a class="jxr_linenumber" name="L1064" href="#L1064">1064</a> 
<a class="jxr_linenumber" name="L1065" href="#L1065">1065</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">void</strong> invokeInitialize(Object theProvider) {
<a class="jxr_linenumber" name="L1066" href="#L1066">1066</a> 		invokeInitialize(theProvider, theProvider.getClass());
<a class="jxr_linenumber" name="L1067" href="#L1067">1067</a> 	}
<a class="jxr_linenumber" name="L1068" href="#L1068">1068</a> 
<a class="jxr_linenumber" name="L1069" href="#L1069">1069</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">void</strong> invokeDestroy(Object theProvider, Class&lt;?&gt; clazz) {
<a class="jxr_linenumber" name="L1070" href="#L1070">1070</a> 		<strong class="jxr_keyword">for</strong> (Method m : ReflectionUtil.getDeclaredMethods(clazz)) {
<a class="jxr_linenumber" name="L1071" href="#L1071">1071</a> 			Destroy destroy = m.getAnnotation(Destroy.<strong class="jxr_keyword">class</strong>);
<a class="jxr_linenumber" name="L1072" href="#L1072">1072</a> 			<strong class="jxr_keyword">if</strong> (destroy != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L1073" href="#L1073">1073</a> 				<strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L1074" href="#L1074">1074</a> 					m.invoke(theProvider);
<a class="jxr_linenumber" name="L1075" href="#L1075">1075</a> 				} <strong class="jxr_keyword">catch</strong> (IllegalAccessException e) {
<a class="jxr_linenumber" name="L1076" href="#L1076">1076</a> 					ourLog.error(<span class="jxr_string">"Exception occurred in destroy "</span>, e);
<a class="jxr_linenumber" name="L1077" href="#L1077">1077</a> 				} <strong class="jxr_keyword">catch</strong> (InvocationTargetException e) {
<a class="jxr_linenumber" name="L1078" href="#L1078">1078</a> 					ourLog.error(<span class="jxr_string">"Exception occurred in destroy "</span>, e);
<a class="jxr_linenumber" name="L1079" href="#L1079">1079</a> 				}
<a class="jxr_linenumber" name="L1080" href="#L1080">1080</a> 				<strong class="jxr_keyword">return</strong>;
<a class="jxr_linenumber" name="L1081" href="#L1081">1081</a> 			}
<a class="jxr_linenumber" name="L1082" href="#L1082">1082</a> 		}
<a class="jxr_linenumber" name="L1083" href="#L1083">1083</a> 
<a class="jxr_linenumber" name="L1084" href="#L1084">1084</a> 		Class&lt;?&gt; supertype = clazz.getSuperclass();
<a class="jxr_linenumber" name="L1085" href="#L1085">1085</a> 		<strong class="jxr_keyword">if</strong> (!Object.<strong class="jxr_keyword">class</strong>.equals(supertype)) {
<a class="jxr_linenumber" name="L1086" href="#L1086">1086</a> 			invokeDestroy(theProvider, supertype);
<a class="jxr_linenumber" name="L1087" href="#L1087">1087</a> 		}
<a class="jxr_linenumber" name="L1088" href="#L1088">1088</a> 	}
<a class="jxr_linenumber" name="L1089" href="#L1089">1089</a> 
<a class="jxr_linenumber" name="L1090" href="#L1090">1090</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">void</strong> invokeInitialize(Object theProvider, Class&lt;?&gt; clazz) {
<a class="jxr_linenumber" name="L1091" href="#L1091">1091</a> 		<strong class="jxr_keyword">for</strong> (Method m : ReflectionUtil.getDeclaredMethods(clazz)) {
<a class="jxr_linenumber" name="L1092" href="#L1092">1092</a> 			Initialize initialize = m.getAnnotation(Initialize.<strong class="jxr_keyword">class</strong>);
<a class="jxr_linenumber" name="L1093" href="#L1093">1093</a> 			<strong class="jxr_keyword">if</strong> (initialize != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L1094" href="#L1094">1094</a> 				<strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L1095" href="#L1095">1095</a> 					m.invoke(theProvider);
<a class="jxr_linenumber" name="L1096" href="#L1096">1096</a> 				} <strong class="jxr_keyword">catch</strong> (IllegalAccessException e) {
<a class="jxr_linenumber" name="L1097" href="#L1097">1097</a> 					ourLog.error(<span class="jxr_string">"Exception occurred in destroy "</span>, e);
<a class="jxr_linenumber" name="L1098" href="#L1098">1098</a> 				} <strong class="jxr_keyword">catch</strong> (InvocationTargetException e) {
<a class="jxr_linenumber" name="L1099" href="#L1099">1099</a> 					ourLog.error(<span class="jxr_string">"Exception occurred in destroy "</span>, e);
<a class="jxr_linenumber" name="L1100" href="#L1100">1100</a> 				}
<a class="jxr_linenumber" name="L1101" href="#L1101">1101</a> 				<strong class="jxr_keyword">return</strong>;
<a class="jxr_linenumber" name="L1102" href="#L1102">1102</a> 			}
<a class="jxr_linenumber" name="L1103" href="#L1103">1103</a> 		}
<a class="jxr_linenumber" name="L1104" href="#L1104">1104</a> 
<a class="jxr_linenumber" name="L1105" href="#L1105">1105</a> 		Class&lt;?&gt; supertype = clazz.getSuperclass();
<a class="jxr_linenumber" name="L1106" href="#L1106">1106</a> 		<strong class="jxr_keyword">if</strong> (!Object.<strong class="jxr_keyword">class</strong>.equals(supertype)) {
<a class="jxr_linenumber" name="L1107" href="#L1107">1107</a> 			invokeInitialize(theProvider, supertype);
<a class="jxr_linenumber" name="L1108" href="#L1108">1108</a> 		}
<a class="jxr_linenumber" name="L1109" href="#L1109">1109</a> 	}
<a class="jxr_linenumber" name="L1110" href="#L1110">1110</a> 
<a class="jxr_linenumber" name="L1111" href="#L1111">1111</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1112" href="#L1112">1112</a> <em class="jxr_javadoccomment">	 * Should the server "pretty print" responses by default (requesting clients can always override this default by supplying an &lt;code&gt;Accept&lt;/code&gt; header in the request, or a &lt;code&gt;_pretty&lt;/code&gt;</em>
<a class="jxr_linenumber" name="L1113" href="#L1113">1113</a> <em class="jxr_javadoccomment">	 * parameter in the request URL.</em>
<a class="jxr_linenumber" name="L1114" href="#L1114">1114</a> <em class="jxr_javadoccomment">	 * &lt;p&gt;</em>
<a class="jxr_linenumber" name="L1115" href="#L1115">1115</a> <em class="jxr_javadoccomment">	 * The default is &lt;code&gt;false&lt;/code&gt;</em>
<a class="jxr_linenumber" name="L1116" href="#L1116">1116</a> <em class="jxr_javadoccomment">	 * &lt;/p&gt;</em>
<a class="jxr_linenumber" name="L1117" href="#L1117">1117</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="L1118" href="#L1118">1118</a> <em class="jxr_javadoccomment">	 * @return Returns the default pretty print setting</em>
<a class="jxr_linenumber" name="L1119" href="#L1119">1119</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1120" href="#L1120">1120</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">boolean</strong> isDefaultPrettyPrint() {
<a class="jxr_linenumber" name="L1121" href="#L1121">1121</a> 		<strong class="jxr_keyword">return</strong> myDefaultPrettyPrint;
<a class="jxr_linenumber" name="L1122" href="#L1122">1122</a> 	}
<a class="jxr_linenumber" name="L1123" href="#L1123">1123</a> 
<a class="jxr_linenumber" name="L1124" href="#L1124">1124</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">boolean</strong> isUseBrowserFriendlyContentTypes() {
<a class="jxr_linenumber" name="L1125" href="#L1125">1125</a> 		<strong class="jxr_keyword">return</strong> myUseBrowserFriendlyContentTypes;
<a class="jxr_linenumber" name="L1126" href="#L1126">1126</a> 	}
<a class="jxr_linenumber" name="L1127" href="#L1127">1127</a> 
<a class="jxr_linenumber" name="L1128" href="#L1128">1128</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> registerInterceptor(<a href="../../../../../ca/uhn/fhir/rest/server/interceptor/IServerInterceptor.html">IServerInterceptor</a> theInterceptor) {
<a class="jxr_linenumber" name="L1129" href="#L1129">1129</a> 		Validate.notNull(theInterceptor, <span class="jxr_string">"Interceptor can not be null"</span>);
<a class="jxr_linenumber" name="L1130" href="#L1130">1130</a> 		myInterceptors.add(theInterceptor);
<a class="jxr_linenumber" name="L1131" href="#L1131">1131</a> 	}
<a class="jxr_linenumber" name="L1132" href="#L1132">1132</a> 
<a class="jxr_linenumber" name="L1133" href="#L1133">1133</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1134" href="#L1134">1134</a> <em class="jxr_javadoccomment">	 * Sets the profile tagging behaviour for the server. When set to a value other than {@link AddProfileTagEnum#NEVER} (which is the default), the server will automatically add a profile tag based on</em>
<a class="jxr_linenumber" name="L1135" href="#L1135">1135</a> <em class="jxr_javadoccomment">	 * the class of the resource(s) being returned.</em>
<a class="jxr_linenumber" name="L1136" href="#L1136">1136</a> <em class="jxr_javadoccomment">	 *</em>
<a class="jxr_linenumber" name="L1137" href="#L1137">1137</a> <em class="jxr_javadoccomment">	 * @param theAddProfileTag</em>
<a class="jxr_linenumber" name="L1138" href="#L1138">1138</a> <em class="jxr_javadoccomment">	 *           The behaviour enum (must not be null)</em>
<a class="jxr_linenumber" name="L1139" href="#L1139">1139</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1140" href="#L1140">1140</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setAddProfileTag(<a href="../../../../../ca/uhn/fhir/rest/server/AddProfileTagEnum.html">AddProfileTagEnum</a> theAddProfileTag) {
<a class="jxr_linenumber" name="L1141" href="#L1141">1141</a> 		Validate.notNull(theAddProfileTag, <span class="jxr_string">"theAddProfileTag must not be null"</span>);
<a class="jxr_linenumber" name="L1142" href="#L1142">1142</a> 		myAddProfileTag = theAddProfileTag;
<a class="jxr_linenumber" name="L1143" href="#L1143">1143</a> 	}
<a class="jxr_linenumber" name="L1144" href="#L1144">1144</a> 
<a class="jxr_linenumber" name="L1145" href="#L1145">1145</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1146" href="#L1146">1146</a> <em class="jxr_javadoccomment">	 * Set how bundle factory should decide whether referenced resources should be included in bundles</em>
<a class="jxr_linenumber" name="L1147" href="#L1147">1147</a> <em class="jxr_javadoccomment">	 *</em>
<a class="jxr_linenumber" name="L1148" href="#L1148">1148</a> <em class="jxr_javadoccomment">	 * @param theBundleInclusionRule</em>
<a class="jxr_linenumber" name="L1149" href="#L1149">1149</a> <em class="jxr_javadoccomment">	 *           - inclusion rule (@see BundleInclusionRule for behaviors)</em>
<a class="jxr_linenumber" name="L1150" href="#L1150">1150</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1151" href="#L1151">1151</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setBundleInclusionRule(<a href="../../../../../ca/uhn/fhir/rest/server/BundleInclusionRule.html">BundleInclusionRule</a> theBundleInclusionRule) {
<a class="jxr_linenumber" name="L1152" href="#L1152">1152</a> 		myBundleInclusionRule = theBundleInclusionRule;
<a class="jxr_linenumber" name="L1153" href="#L1153">1153</a> 	}
<a class="jxr_linenumber" name="L1154" href="#L1154">1154</a> 
<a class="jxr_linenumber" name="L1155" href="#L1155">1155</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1156" href="#L1156">1156</a> <em class="jxr_javadoccomment">	 * Should the server "pretty print" responses by default (requesting clients can always override this default by supplying an &lt;code&gt;Accept&lt;/code&gt; header in the request, or a &lt;code&gt;_pretty&lt;/code&gt;</em>
<a class="jxr_linenumber" name="L1157" href="#L1157">1157</a> <em class="jxr_javadoccomment">	 * parameter in the request URL.</em>
<a class="jxr_linenumber" name="L1158" href="#L1158">1158</a> <em class="jxr_javadoccomment">	 * &lt;p&gt;</em>
<a class="jxr_linenumber" name="L1159" href="#L1159">1159</a> <em class="jxr_javadoccomment">	 * The default is &lt;code&gt;false&lt;/code&gt;</em>
<a class="jxr_linenumber" name="L1160" href="#L1160">1160</a> <em class="jxr_javadoccomment">	 * &lt;/p&gt;</em>
<a class="jxr_linenumber" name="L1161" href="#L1161">1161</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="L1162" href="#L1162">1162</a> <em class="jxr_javadoccomment">	 * @param theDefaultPrettyPrint</em>
<a class="jxr_linenumber" name="L1163" href="#L1163">1163</a> <em class="jxr_javadoccomment">	 *           The default pretty print setting</em>
<a class="jxr_linenumber" name="L1164" href="#L1164">1164</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1165" href="#L1165">1165</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setDefaultPrettyPrint(<strong class="jxr_keyword">boolean</strong> theDefaultPrettyPrint) {
<a class="jxr_linenumber" name="L1166" href="#L1166">1166</a> 		myDefaultPrettyPrint = theDefaultPrettyPrint;
<a class="jxr_linenumber" name="L1167" href="#L1167">1167</a> 	}
<a class="jxr_linenumber" name="L1168" href="#L1168">1168</a> 
<a class="jxr_linenumber" name="L1169" href="#L1169">1169</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1170" href="#L1170">1170</a> <em class="jxr_javadoccomment">	 * Sets the default encoding to return (XML/JSON) if an incoming request does not specify a preference (either with the &lt;code&gt;_format&lt;/code&gt; URL parameter, or with an &lt;code&gt;Accept&lt;/code&gt; header in</em>
<a class="jxr_linenumber" name="L1171" href="#L1171">1171</a> <em class="jxr_javadoccomment">	 * the request. The default is {@link EncodingEnum#XML}.</em>
<a class="jxr_linenumber" name="L1172" href="#L1172">1172</a> <em class="jxr_javadoccomment">	 * &lt;p&gt;</em>
<a class="jxr_linenumber" name="L1173" href="#L1173">1173</a> <em class="jxr_javadoccomment">	 * Note when testing this feature: Some browsers will include "application/xml" in their Accept header, which means that the</em>
<a class="jxr_linenumber" name="L1174" href="#L1174">1174</a> <em class="jxr_javadoccomment">	 * &lt;/p&gt;</em>
<a class="jxr_linenumber" name="L1175" href="#L1175">1175</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1176" href="#L1176">1176</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setDefaultResponseEncoding(<a href="../../../../../ca/uhn/fhir/rest/server/EncodingEnum.html">EncodingEnum</a> theDefaultResponseEncoding) {
<a class="jxr_linenumber" name="L1177" href="#L1177">1177</a> 		Validate.notNull(theDefaultResponseEncoding, <span class="jxr_string">"theDefaultResponseEncoding can not be null"</span>);
<a class="jxr_linenumber" name="L1178" href="#L1178">1178</a> 		myDefaultResponseEncoding = theDefaultResponseEncoding;
<a class="jxr_linenumber" name="L1179" href="#L1179">1179</a> 	}
<a class="jxr_linenumber" name="L1180" href="#L1180">1180</a> 
<a class="jxr_linenumber" name="L1181" href="#L1181">1181</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1182" href="#L1182">1182</a> <em class="jxr_javadoccomment">	 * Sets (enables/disables) the server support for ETags. Must not be &lt;code&gt;null&lt;/code&gt;. Default is {@link #DEFAULT_ETAG_SUPPORT}</em>
<a class="jxr_linenumber" name="L1183" href="#L1183">1183</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="L1184" href="#L1184">1184</a> <em class="jxr_javadoccomment">	 * @param theETagSupport</em>
<a class="jxr_linenumber" name="L1185" href="#L1185">1185</a> <em class="jxr_javadoccomment">	 *           The ETag support mode</em>
<a class="jxr_linenumber" name="L1186" href="#L1186">1186</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1187" href="#L1187">1187</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setETagSupport(<a href="../../../../../ca/uhn/fhir/rest/server/ETagSupportEnum.html">ETagSupportEnum</a> theETagSupport) {
<a class="jxr_linenumber" name="L1188" href="#L1188">1188</a> 		<strong class="jxr_keyword">if</strong> (theETagSupport == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L1189" href="#L1189">1189</a> 			<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> NullPointerException(<span class="jxr_string">"theETagSupport can not be null"</span>);
<a class="jxr_linenumber" name="L1190" href="#L1190">1190</a> 		}
<a class="jxr_linenumber" name="L1191" href="#L1191">1191</a> 		myETagSupport = theETagSupport;
<a class="jxr_linenumber" name="L1192" href="#L1192">1192</a> 	}
<a class="jxr_linenumber" name="L1193" href="#L1193">1193</a> 
<a class="jxr_linenumber" name="L1194" href="#L1194">1194</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setFhirContext(<a href="../../../../../ca/uhn/fhir/context/FhirContext.html">FhirContext</a> theFhirContext) {
<a class="jxr_linenumber" name="L1195" href="#L1195">1195</a> 		Validate.notNull(theFhirContext, <span class="jxr_string">"FhirContext must not be null"</span>);
<a class="jxr_linenumber" name="L1196" href="#L1196">1196</a> 		myFhirContext = theFhirContext;
<a class="jxr_linenumber" name="L1197" href="#L1197">1197</a> 	}
<a class="jxr_linenumber" name="L1198" href="#L1198">1198</a> 
<a class="jxr_linenumber" name="L1199" href="#L1199">1199</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setImplementationDescription(String theImplementationDescription) {
<a class="jxr_linenumber" name="L1200" href="#L1200">1200</a> 		myImplementationDescription = theImplementationDescription;
<a class="jxr_linenumber" name="L1201" href="#L1201">1201</a> 	}
<a class="jxr_linenumber" name="L1202" href="#L1202">1202</a> 
<a class="jxr_linenumber" name="L1203" href="#L1203">1203</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1204" href="#L1204">1204</a> <em class="jxr_javadoccomment">	 * Sets (or clears) the list of interceptors</em>
<a class="jxr_linenumber" name="L1205" href="#L1205">1205</a> <em class="jxr_javadoccomment">	 *</em>
<a class="jxr_linenumber" name="L1206" href="#L1206">1206</a> <em class="jxr_javadoccomment">	 * @param theList</em>
<a class="jxr_linenumber" name="L1207" href="#L1207">1207</a> <em class="jxr_javadoccomment">	 *           The list of interceptors (may be null)</em>
<a class="jxr_linenumber" name="L1208" href="#L1208">1208</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1209" href="#L1209">1209</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setInterceptors(IServerInterceptor... theList) {
<a class="jxr_linenumber" name="L1210" href="#L1210">1210</a> 		myInterceptors.clear();
<a class="jxr_linenumber" name="L1211" href="#L1211">1211</a> 		<strong class="jxr_keyword">if</strong> (theList != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L1212" href="#L1212">1212</a> 			myInterceptors.addAll(Arrays.asList(theList));
<a class="jxr_linenumber" name="L1213" href="#L1213">1213</a> 		}
<a class="jxr_linenumber" name="L1214" href="#L1214">1214</a> 	}
<a class="jxr_linenumber" name="L1215" href="#L1215">1215</a> 
<a class="jxr_linenumber" name="L1216" href="#L1216">1216</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1217" href="#L1217">1217</a> <em class="jxr_javadoccomment">	 * Sets (or clears) the list of interceptors</em>
<a class="jxr_linenumber" name="L1218" href="#L1218">1218</a> <em class="jxr_javadoccomment">	 *</em>
<a class="jxr_linenumber" name="L1219" href="#L1219">1219</a> <em class="jxr_javadoccomment">	 * @param theList</em>
<a class="jxr_linenumber" name="L1220" href="#L1220">1220</a> <em class="jxr_javadoccomment">	 *           The list of interceptors (may be null)</em>
<a class="jxr_linenumber" name="L1221" href="#L1221">1221</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1222" href="#L1222">1222</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setInterceptors(List&lt;IServerInterceptor&gt; theList) {
<a class="jxr_linenumber" name="L1223" href="#L1223">1223</a> 		myInterceptors.clear();
<a class="jxr_linenumber" name="L1224" href="#L1224">1224</a> 		<strong class="jxr_keyword">if</strong> (theList != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L1225" href="#L1225">1225</a> 			myInterceptors.addAll(theList);
<a class="jxr_linenumber" name="L1226" href="#L1226">1226</a> 		}
<a class="jxr_linenumber" name="L1227" href="#L1227">1227</a> 	}
<a class="jxr_linenumber" name="L1228" href="#L1228">1228</a> 
<a class="jxr_linenumber" name="L1229" href="#L1229">1229</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1230" href="#L1230">1230</a> <em class="jxr_javadoccomment">	 * Sets the paging provider to use, or &lt;code&gt;null&lt;/code&gt; to use no paging (which is the default)</em>
<a class="jxr_linenumber" name="L1231" href="#L1231">1231</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1232" href="#L1232">1232</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setPagingProvider(<a href="../../../../../ca/uhn/fhir/rest/server/IPagingProvider.html">IPagingProvider</a> thePagingProvider) {
<a class="jxr_linenumber" name="L1233" href="#L1233">1233</a> 		myPagingProvider = thePagingProvider;
<a class="jxr_linenumber" name="L1234" href="#L1234">1234</a> 	}
<a class="jxr_linenumber" name="L1235" href="#L1235">1235</a> 
<a class="jxr_linenumber" name="L1236" href="#L1236">1236</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1237" href="#L1237">1237</a> <em class="jxr_javadoccomment">	 * Sets the non-resource specific providers which implement method calls on this server.</em>
<a class="jxr_linenumber" name="L1238" href="#L1238">1238</a> <em class="jxr_javadoccomment">	 *</em>
<a class="jxr_linenumber" name="L1239" href="#L1239">1239</a> <em class="jxr_javadoccomment">	 * @see #setResourceProviders(Collection)</em>
<a class="jxr_linenumber" name="L1240" href="#L1240">1240</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1241" href="#L1241">1241</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setPlainProviders(Collection&lt;Object&gt; theProviders) {
<a class="jxr_linenumber" name="L1242" href="#L1242">1242</a> 		myPlainProviders.clear();
<a class="jxr_linenumber" name="L1243" href="#L1243">1243</a> 		<strong class="jxr_keyword">if</strong> (theProviders != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L1244" href="#L1244">1244</a> 			myPlainProviders.addAll(theProviders);
<a class="jxr_linenumber" name="L1245" href="#L1245">1245</a> 		}
<a class="jxr_linenumber" name="L1246" href="#L1246">1246</a> 	}
<a class="jxr_linenumber" name="L1247" href="#L1247">1247</a> 
<a class="jxr_linenumber" name="L1248" href="#L1248">1248</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1249" href="#L1249">1249</a> <em class="jxr_javadoccomment">	 * Sets the non-resource specific providers which implement method calls on this server.</em>
<a class="jxr_linenumber" name="L1250" href="#L1250">1250</a> <em class="jxr_javadoccomment">	 *</em>
<a class="jxr_linenumber" name="L1251" href="#L1251">1251</a> <em class="jxr_javadoccomment">	 * @see #setResourceProviders(Collection)</em>
<a class="jxr_linenumber" name="L1252" href="#L1252">1252</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1253" href="#L1253">1253</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setPlainProviders(Object... theProv) {
<a class="jxr_linenumber" name="L1254" href="#L1254">1254</a> 		setPlainProviders(Arrays.asList(theProv));
<a class="jxr_linenumber" name="L1255" href="#L1255">1255</a> 	}
<a class="jxr_linenumber" name="L1256" href="#L1256">1256</a> 
<a class="jxr_linenumber" name="L1257" href="#L1257">1257</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1258" href="#L1258">1258</a> <em class="jxr_javadoccomment">	 * Sets the non-resource specific providers which implement method calls on this server</em>
<a class="jxr_linenumber" name="L1259" href="#L1259">1259</a> <em class="jxr_javadoccomment">	 *</em>
<a class="jxr_linenumber" name="L1260" href="#L1260">1260</a> <em class="jxr_javadoccomment">	 * @see #setResourceProviders(Collection)</em>
<a class="jxr_linenumber" name="L1261" href="#L1261">1261</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1262" href="#L1262">1262</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setProviders(Object... theProviders) {
<a class="jxr_linenumber" name="L1263" href="#L1263">1263</a> 		myPlainProviders.clear();
<a class="jxr_linenumber" name="L1264" href="#L1264">1264</a> 		<strong class="jxr_keyword">if</strong> (theProviders != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L1265" href="#L1265">1265</a> 			myPlainProviders.addAll(Arrays.asList(theProviders));
<a class="jxr_linenumber" name="L1266" href="#L1266">1266</a> 		}
<a class="jxr_linenumber" name="L1267" href="#L1267">1267</a> 	}
<a class="jxr_linenumber" name="L1268" href="#L1268">1268</a> 
<a class="jxr_linenumber" name="L1269" href="#L1269">1269</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1270" href="#L1270">1270</a> <em class="jxr_javadoccomment">	 * Sets the resource providers for this server</em>
<a class="jxr_linenumber" name="L1271" href="#L1271">1271</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1272" href="#L1272">1272</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setResourceProviders(Collection&lt;IResourceProvider&gt; theResourceProviders) {
<a class="jxr_linenumber" name="L1273" href="#L1273">1273</a> 		myResourceProviders.clear();
<a class="jxr_linenumber" name="L1274" href="#L1274">1274</a> 		<strong class="jxr_keyword">if</strong> (theResourceProviders != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L1275" href="#L1275">1275</a> 			myResourceProviders.addAll(theResourceProviders);
<a class="jxr_linenumber" name="L1276" href="#L1276">1276</a> 		}
<a class="jxr_linenumber" name="L1277" href="#L1277">1277</a> 	}
<a class="jxr_linenumber" name="L1278" href="#L1278">1278</a> 
<a class="jxr_linenumber" name="L1279" href="#L1279">1279</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1280" href="#L1280">1280</a> <em class="jxr_javadoccomment">	 * Sets the resource providers for this server</em>
<a class="jxr_linenumber" name="L1281" href="#L1281">1281</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1282" href="#L1282">1282</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setResourceProviders(IResourceProvider... theResourceProviders) {
<a class="jxr_linenumber" name="L1283" href="#L1283">1283</a> 		myResourceProviders.clear();
<a class="jxr_linenumber" name="L1284" href="#L1284">1284</a> 		<strong class="jxr_keyword">if</strong> (theResourceProviders != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L1285" href="#L1285">1285</a> 			myResourceProviders.addAll(Arrays.asList(theResourceProviders));
<a class="jxr_linenumber" name="L1286" href="#L1286">1286</a> 		}
<a class="jxr_linenumber" name="L1287" href="#L1287">1287</a> 	}
<a class="jxr_linenumber" name="L1288" href="#L1288">1288</a> 
<a class="jxr_linenumber" name="L1289" href="#L1289">1289</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1290" href="#L1290">1290</a> <em class="jxr_javadoccomment">	 * Provide a server address strategy, which is used to determine what base URL to provide clients to refer to this server. Defaults to an instance of {@link IncomingRequestAddressStrategy}</em>
<a class="jxr_linenumber" name="L1291" href="#L1291">1291</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1292" href="#L1292">1292</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setServerAddressStrategy(<a href="../../../../../ca/uhn/fhir/rest/server/IServerAddressStrategy.html">IServerAddressStrategy</a> theServerAddressStrategy) {
<a class="jxr_linenumber" name="L1293" href="#L1293">1293</a> 		Validate.notNull(theServerAddressStrategy, <span class="jxr_string">"Server address strategy can not be null"</span>);
<a class="jxr_linenumber" name="L1294" href="#L1294">1294</a> 		myServerAddressStrategy = theServerAddressStrategy;
<a class="jxr_linenumber" name="L1295" href="#L1295">1295</a> 	}
<a class="jxr_linenumber" name="L1296" href="#L1296">1296</a> 
<a class="jxr_linenumber" name="L1297" href="#L1297">1297</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1298" href="#L1298">1298</a> <em class="jxr_javadoccomment">	 * Returns the server conformance provider, which is the provider that is used to generate the server's conformance (metadata) statement.</em>
<a class="jxr_linenumber" name="L1299" href="#L1299">1299</a> <em class="jxr_javadoccomment">	 * &lt;p&gt;</em>
<a class="jxr_linenumber" name="L1300" href="#L1300">1300</a> <em class="jxr_javadoccomment">	 * By default, the ServerConformanceProvider implementation for the declared version of FHIR is used, but this can be changed, or set to &lt;code&gt;null&lt;/code&gt; if you do not wish to export a conformance</em>
<a class="jxr_linenumber" name="L1301" href="#L1301">1301</a> <em class="jxr_javadoccomment">	 * statement.</em>
<a class="jxr_linenumber" name="L1302" href="#L1302">1302</a> <em class="jxr_javadoccomment">	 * &lt;/p&gt;</em>
<a class="jxr_linenumber" name="L1303" href="#L1303">1303</a> <em class="jxr_javadoccomment">	 * Note that this method can only be called before the server is initialized.</em>
<a class="jxr_linenumber" name="L1304" href="#L1304">1304</a> <em class="jxr_javadoccomment">	 *</em>
<a class="jxr_linenumber" name="L1305" href="#L1305">1305</a> <em class="jxr_javadoccomment">	 * @throws IllegalStateException</em>
<a class="jxr_linenumber" name="L1306" href="#L1306">1306</a> <em class="jxr_javadoccomment">	 *            Note that this method can only be called prior to {@link #init() initialization} and will throw an {@link IllegalStateException} if called after that.</em>
<a class="jxr_linenumber" name="L1307" href="#L1307">1307</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1308" href="#L1308">1308</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setServerConformanceProvider(Object theServerConformanceProvider) {
<a class="jxr_linenumber" name="L1309" href="#L1309">1309</a> 		<strong class="jxr_keyword">if</strong> (myStarted) {
<a class="jxr_linenumber" name="L1310" href="#L1310">1310</a> 			<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> IllegalStateException(<span class="jxr_string">"Server is already started"</span>);
<a class="jxr_linenumber" name="L1311" href="#L1311">1311</a> 		}
<a class="jxr_linenumber" name="L1312" href="#L1312">1312</a> 
<a class="jxr_linenumber" name="L1313" href="#L1313">1313</a> 		<em class="jxr_comment">// call the setRestfulServer() method to point the Conformance</em>
<a class="jxr_linenumber" name="L1314" href="#L1314">1314</a> 		<em class="jxr_comment">// Provider to this server instance. This is done to avoid</em>
<a class="jxr_linenumber" name="L1315" href="#L1315">1315</a> 		<em class="jxr_comment">// passing the server into the constructor. Having that sort</em>
<a class="jxr_linenumber" name="L1316" href="#L1316">1316</a> 		<em class="jxr_comment">// of cross linkage causes reference cycles in Spring wiring </em>
<a class="jxr_linenumber" name="L1317" href="#L1317">1317</a> 		<strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L1318" href="#L1318">1318</a> 			Method setRestfulServer = theServerConformanceProvider.getClass().getMethod(<span class="jxr_string">"setRestfulServer"</span>, <strong class="jxr_keyword">new</strong> Class[]{RestfulServer.<strong class="jxr_keyword">class</strong>});
<a class="jxr_linenumber" name="L1319" href="#L1319">1319</a> 			<strong class="jxr_keyword">if</strong> (setRestfulServer != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L1320" href="#L1320">1320</a> 				setRestfulServer.invoke(theServerConformanceProvider, <strong class="jxr_keyword">new</strong> Object[]{<strong class="jxr_keyword">this</strong>});
<a class="jxr_linenumber" name="L1321" href="#L1321">1321</a> 			}
<a class="jxr_linenumber" name="L1322" href="#L1322">1322</a> 		} <strong class="jxr_keyword">catch</strong> (Exception e) {
<a class="jxr_linenumber" name="L1323" href="#L1323">1323</a> 			ourLog.warn(<span class="jxr_string">"Error calling IServerConformanceProvider.setRestfulServer"</span>, e);
<a class="jxr_linenumber" name="L1324" href="#L1324">1324</a> 		} 
<a class="jxr_linenumber" name="L1325" href="#L1325">1325</a> 		myServerConformanceProvider = theServerConformanceProvider;
<a class="jxr_linenumber" name="L1326" href="#L1326">1326</a> 	}
<a class="jxr_linenumber" name="L1327" href="#L1327">1327</a> 
<a class="jxr_linenumber" name="L1328" href="#L1328">1328</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1329" href="#L1329">1329</a> <em class="jxr_javadoccomment">	 * Sets the server's name, as exported in conformance profiles exported by the server. This is informational only, but can be helpful to set with something appropriate.</em>
<a class="jxr_linenumber" name="L1330" href="#L1330">1330</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1331" href="#L1331">1331</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setServerName(String theServerName) {
<a class="jxr_linenumber" name="L1332" href="#L1332">1332</a> 		myServerName = theServerName;
<a class="jxr_linenumber" name="L1333" href="#L1333">1333</a> 	}
<a class="jxr_linenumber" name="L1334" href="#L1334">1334</a> 
<a class="jxr_linenumber" name="L1335" href="#L1335">1335</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1336" href="#L1336">1336</a> <em class="jxr_javadoccomment">	 * Gets the server's version, as exported in conformance profiles exported by the server. This is informational only, but can be helpful to set with something appropriate.</em>
<a class="jxr_linenumber" name="L1337" href="#L1337">1337</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1338" href="#L1338">1338</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setServerVersion(String theServerVersion) {
<a class="jxr_linenumber" name="L1339" href="#L1339">1339</a> 		myServerVersion = theServerVersion;
<a class="jxr_linenumber" name="L1340" href="#L1340">1340</a> 	}
<a class="jxr_linenumber" name="L1341" href="#L1341">1341</a> 
<a class="jxr_linenumber" name="L1342" href="#L1342">1342</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L1343" href="#L1343">1343</a> <em class="jxr_javadoccomment">	 * If set to &lt;code&gt;true&lt;/code&gt; (default is false), the server will use browser friendly content-types (instead of standard FHIR ones) when it detects that the request is coming from a browser</em>
<a class="jxr_linenumber" name="L1344" href="#L1344">1344</a> <em class="jxr_javadoccomment">	 * instead of a FHIR</em>
<a class="jxr_linenumber" name="L1345" href="#L1345">1345</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L1346" href="#L1346">1346</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setUseBrowserFriendlyContentTypes(<strong class="jxr_keyword">boolean</strong> theUseBrowserFriendlyContentTypes) {
<a class="jxr_linenumber" name="L1347" href="#L1347">1347</a> 		myUseBrowserFriendlyContentTypes = theUseBrowserFriendlyContentTypes;
<a class="jxr_linenumber" name="L1348" href="#L1348">1348</a> 	}
<a class="jxr_linenumber" name="L1349" href="#L1349">1349</a> 
<a class="jxr_linenumber" name="L1350" href="#L1350">1350</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> unregisterInterceptor(<a href="../../../../../ca/uhn/fhir/rest/server/interceptor/IServerInterceptor.html">IServerInterceptor</a> theInterceptor) {
<a class="jxr_linenumber" name="L1351" href="#L1351">1351</a> 		Validate.notNull(theInterceptor, <span class="jxr_string">"Interceptor can not be null"</span>);
<a class="jxr_linenumber" name="L1352" href="#L1352">1352</a> 		myInterceptors.remove(theInterceptor);
<a class="jxr_linenumber" name="L1353" href="#L1353">1353</a> 	}
<a class="jxr_linenumber" name="L1354" href="#L1354">1354</a> 
<a class="jxr_linenumber" name="L1355" href="#L1355">1355</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">void</strong> writeExceptionToResponse(HttpServletResponse theResponse, <a href="../../../../../ca/uhn/fhir/rest/server/exceptions/BaseServerResponseException.html">BaseServerResponseException</a> theException) <strong class="jxr_keyword">throws</strong> IOException {
<a class="jxr_linenumber" name="L1356" href="#L1356">1356</a> 		theResponse.setStatus(theException.getStatusCode());
<a class="jxr_linenumber" name="L1357" href="#L1357">1357</a> 		addHeadersToResponse(theResponse);
<a class="jxr_linenumber" name="L1358" href="#L1358">1358</a> 		theResponse.setContentType(<span class="jxr_string">"text/plain"</span>);
<a class="jxr_linenumber" name="L1359" href="#L1359">1359</a> 		theResponse.setCharacterEncoding(<span class="jxr_string">"UTF-8"</span>);
<a class="jxr_linenumber" name="L1360" href="#L1360">1360</a> 		theResponse.getWriter().write(theException.getMessage());
<a class="jxr_linenumber" name="L1361" href="#L1361">1361</a> 	}
<a class="jxr_linenumber" name="L1362" href="#L1362">1362</a> 
<a class="jxr_linenumber" name="L1363" href="#L1363">1363</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">boolean</strong> partIsOperation(String nextString) {
<a class="jxr_linenumber" name="L1364" href="#L1364">1364</a> 		<strong class="jxr_keyword">return</strong> nextString.length() &gt; 0 &amp;&amp; (nextString.charAt(0) == '_' || nextString.charAt(0) == '$');
<a class="jxr_linenumber" name="L1365" href="#L1365">1365</a> 	}
<a class="jxr_linenumber" name="L1366" href="#L1366">1366</a> 
<a class="jxr_linenumber" name="L1367" href="#L1367">1367</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">boolean</strong> requestIsBrowser(HttpServletRequest theRequest) {
<a class="jxr_linenumber" name="L1368" href="#L1368">1368</a> 		String userAgent = theRequest.getHeader(<span class="jxr_string">"User-Agent"</span>);
<a class="jxr_linenumber" name="L1369" href="#L1369">1369</a> 		<strong class="jxr_keyword">return</strong> userAgent != <strong class="jxr_keyword">null</strong> &amp;&amp; userAgent.contains(<span class="jxr_string">"Mozilla"</span>);
<a class="jxr_linenumber" name="L1370" href="#L1370">1370</a> 	}
<a class="jxr_linenumber" name="L1371" href="#L1371">1371</a> 
<a class="jxr_linenumber" name="L1372" href="#L1372">1372</a> }
</pre>
<hr/>
<div id="footer">Copyright &#169; 2014&#x2013;2015 <a href="http://www.uhn.ca">University Health Network</a>. All rights reserved.</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>
                </body >
</html>